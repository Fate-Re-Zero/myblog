<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Docker容器镜像一、Docker容器镜像操作2.1 查看本地容器镜像2.1.1 使用docker images命令查看12345# docker imagesREPOSITORY   TAG       IMAGE ID       CREATED        SIZEbash         latest    5557e073f11c   2 weeks ago    13MBnginx">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker核心概念容器镜像">
<meta property="og:url" content="https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/index.html">
<meta property="og:site_name" content="祥祥要起飞">
<meta property="og:description" content="Docker容器镜像一、Docker容器镜像操作2.1 查看本地容器镜像2.1.1 使用docker images命令查看12345# docker imagesREPOSITORY   TAG       IMAGE ID       CREATED        SIZEbash         latest    5557e073f11c   2 weeks ago    13MBnginx">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220124162022990.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220124162116338.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220124162200273.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220124162312918.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220125080435098.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220125082226414.png">
<meta property="article:published_time" content="2023-07-29T00:48:22.000Z">
<meta property="article:modified_time" content="2025-04-23T15:26:55.795Z">
<meta property="article:author" content="祥祥要起飞">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220124162022990.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Docker核心概念容器镜像</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="祥祥要起飞" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2023/07/28/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&text=Docker核心概念容器镜像"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&is_video=false&description=Docker核心概念容器镜像"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Docker核心概念容器镜像&body=Check out this article: https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&name=Docker核心概念容器镜像&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"><span class="toc-number">1.</span> <span class="toc-text">Docker容器镜像</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">一、Docker容器镜像操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 查看本地容器镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E4%BD%BF%E7%94%A8docker-images%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 使用docker images命令查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E4%BD%BF%E7%94%A8docker-image%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 使用docker image命令查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-%E6%9F%A5%E7%9C%8Bdocker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.3 查看docker容器镜像本地存储位置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%90%9C%E7%B4%A2Docker-Hub%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 搜索Docker Hub容器镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%90%9C%E7%B4%A2"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 命令行搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-Docker-Hub-Web%E7%95%8C%E9%9D%A2%E6%90%9C%E7%B4%A2"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 Docker Hub Web界面搜索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Docker-%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Docker 容器镜像下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A0%E9%99%A4%E6%96%B9%E6%B3%95"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 Docker容器镜像删除方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text">二、Docker容器镜像介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Docker-Image"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 Docker Image</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 联合文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%9A%E4%B9%89"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.2.1 联合文件系统定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E5%9B%BE%E8%A7%A3"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2.2 图解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Docker-Overlay2"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 Docker Overlay2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E6%A6%82%E5%BF%B5"><span class="toc-number">3.3.1.</span> <span class="toc-text">2.3.1 概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E6%9F%A5%E7%9C%8BDocker-Host%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.3.2 查看Docker Host存储驱动方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E4%BA%86%E8%A7%A3images%E5%88%86%E5%B1%82"><span class="toc-number">3.3.3.</span> <span class="toc-text">2.3.3 了解images分层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Docker%E5%AE%B9%E5%99%A8%E4%B8%8E%E9%95%9C%E5%83%8F"><span class="toc-number">3.4.</span> <span class="toc-text">2.4 Docker容器与镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%AE%B9%E5%99%A8%E5%86%85%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">3.5.</span> <span class="toc-text">2.5 容器内写文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">三、Docker容器镜像操作命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-docker-commit"><span class="toc-number">4.1.</span> <span class="toc-text">3.1  docker commit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-docker-save"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 docker save</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-docker-load"><span class="toc-number">4.3.</span> <span class="toc-text">3.3 docker load</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-docker-export"><span class="toc-number">4.4.</span> <span class="toc-text">3.4 docker export</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-docker-import"><span class="toc-number">4.5.</span> <span class="toc-text">3.5 docker import</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Docker核心概念容器镜像
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">祥祥要起飞</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-07-29T00:48:22.000Z" itemprop="datePublished">2023-07-29</time>
        
      
    </div>


      <div class="posteye">
    <i class="fas fa-eye"></i>
    <span id="/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/" class="leancloud-visitors" data-flag-title="Docker核心概念容器镜像" style="display: inline;">
        <span class="leancloud-visitors-count"></span>
    </span>
</div>
      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Docker/" rel="tag">Docker</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="Docker容器镜像"><a href="#Docker容器镜像" class="headerlink" title="Docker容器镜像"></a>Docker容器镜像</h1><h1 id="一、Docker容器镜像操作"><a href="#一、Docker容器镜像操作" class="headerlink" title="一、Docker容器镜像操作"></a>一、Docker容器镜像操作</h1><h2 id="2-1-查看本地容器镜像"><a href="#2-1-查看本地容器镜像" class="headerlink" title="2.1 查看本地容器镜像"></a>2.1 查看本地容器镜像</h2><h3 id="2-1-1-使用docker-images命令查看"><a href="#2-1-1-使用docker-images命令查看" class="headerlink" title="2.1.1 使用docker images命令查看"></a>2.1.1 使用docker images命令查看</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">bash         latest    <span class="number">5557</span>e073f11c   <span class="number">2</span> weeks ago    <span class="number">13</span>MB</span><br><span class="line">nginx        latest    <span class="number">605</span>c77e624dd   <span class="number">3</span> weeks ago    <span class="number">141</span>MB</span><br><span class="line">centos       latest    <span class="number">5</span>d0da3dc9764   <span class="number">4</span> months ago   <span class="number">231</span>MB</span><br></pre></td></tr></table></figure>



<h3 id="2-1-2-使用docker-image命令查看"><a href="#2-1-2-使用docker-image命令查看" class="headerlink" title="2.1.2 使用docker image命令查看"></a>2.1.2 使用docker image命令查看</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker image list</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">bash         latest    <span class="number">5557</span>e073f11c   <span class="number">2</span> weeks ago    <span class="number">13</span>MB</span><br><span class="line">nginx        latest    <span class="number">605</span>c77e624dd   <span class="number">3</span> weeks ago    <span class="number">141</span>MB</span><br><span class="line">centos       latest    <span class="number">5</span>d0da3dc9764   <span class="number">4</span> months ago   <span class="number">231</span>MB</span><br></pre></td></tr></table></figure>



<h3 id="2-1-3-查看docker容器镜像本地存储位置"><a href="#2-1-3-查看docker容器镜像本地存储位置" class="headerlink" title="2.1.3 查看docker容器镜像本地存储位置"></a>2.1.3 查看docker容器镜像本地存储位置</h3><blockquote>
<p>考虑到docker容器镜像会占用本地存储空间，建议搭建其它存储系统挂载到本地以便解决占用大量本地存储的问题。</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /var/lib/docker</span></span><br><span class="line">buildkit  containers  image  network  overlay2  plugins  runtimes  swarm  tmp  trust  volumes</span><br></pre></td></tr></table></figure>





<h2 id="2-2-搜索Docker-Hub容器镜像"><a href="#2-2-搜索Docker-Hub容器镜像" class="headerlink" title="2.2 搜索Docker Hub容器镜像"></a>2.2 搜索Docker Hub容器镜像</h2><h3 id="2-2-1-命令行搜索"><a href="#2-2-1-命令行搜索" class="headerlink" title="2.2.1 命令行搜索"></a>2.2.1 命令行搜索</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker search centos</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">输出</span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">centos                            The official build of CentOS.                   <span class="number">6987</span>      [<span class="type">OK</span>]</span><br><span class="line">ansible/centos7<span class="literal">-ansible</span>           Ansible on Centos7                              <span class="number">135</span>                  [<span class="type">OK</span>]</span><br><span class="line">consol/centos<span class="literal">-xfce</span><span class="literal">-vnc</span>            Centos container with <span class="string">&quot;headless&quot;</span> VNC session…   <span class="number">135</span>                  [<span class="type">OK</span>]</span><br><span class="line">jdeathe/centos<span class="literal">-ssh</span>                OpenSSH / Supervisor / EPEL/IUS/SCL Repos - …   <span class="number">121</span>                  [<span class="type">OK</span>]</span><br></pre></td></tr></table></figure>





<h3 id="2-2-2-Docker-Hub-Web界面搜索"><a href="#2-2-2-Docker-Hub-Web界面搜索" class="headerlink" title="2.2.2 Docker Hub Web界面搜索"></a>2.2.2 Docker Hub Web界面搜索</h3><p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220124162022990.png" alt="image-20220124162022990"></p>
<p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220124162116338.png" alt="image-20220124162116338"></p>
<p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220124162200273.png" alt="image-20220124162200273"></p>
<p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220124162312918.png" alt="image-20220124162312918"></p>
<h2 id="2-3-Docker-容器镜像下载"><a href="#2-3-Docker-容器镜像下载" class="headerlink" title="2.3 Docker 容器镜像下载"></a>2.3 Docker 容器镜像下载</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker pull centos</span></span><br></pre></td></tr></table></figure>



<h2 id="2-4-Docker容器镜像删除方法"><a href="#2-4-Docker容器镜像删除方法" class="headerlink" title="2.4 Docker容器镜像删除方法"></a>2.4 Docker容器镜像删除方法</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">bash         latest    <span class="number">5557</span>e073f11c   <span class="number">2</span> weeks ago    <span class="number">13</span>MB</span><br><span class="line">nginx        latest    <span class="number">605</span>c77e624dd   <span class="number">3</span> weeks ago    <span class="number">141</span>MB</span><br><span class="line">centos       latest    <span class="number">5</span>d0da3dc9764   <span class="number">4</span> months ago   <span class="number">231</span>MB</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker rmi centos</span></span><br><span class="line">Untagged: centos:latest</span><br><span class="line">Untagged: centos@sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177</span><br><span class="line">Deleted: sha256:<span class="number">5</span>d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6</span><br><span class="line">Deleted: sha256:<span class="number">74</span>ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">centos       latest    <span class="number">5</span>d0da3dc9764   <span class="number">4</span> months ago   <span class="number">231</span>MB</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker rmi 5d0da3dc9764</span></span><br></pre></td></tr></table></figure>





<h1 id="二、Docker容器镜像介绍"><a href="#二、Docker容器镜像介绍" class="headerlink" title="二、Docker容器镜像介绍"></a>二、Docker容器镜像介绍</h1><h2 id="2-1-Docker-Image"><a href="#2-1-Docker-Image" class="headerlink" title="2.1 Docker Image"></a>2.1 Docker Image</h2><ul>
<li>Docker 镜像是只读的容器模板，是Docker容器基础</li>
<li>为Docker容器提供了静态文件系统运行环境（rootfs）</li>
<li>是容器的静止状态</li>
<li>容器是镜像的运行状态</li>
</ul>
<h2 id="2-2-联合文件系统"><a href="#2-2-联合文件系统" class="headerlink" title="2.2 联合文件系统"></a>2.2 联合文件系统</h2><h3 id="2-2-1-联合文件系统定义"><a href="#2-2-1-联合文件系统定义" class="headerlink" title="2.2.1 联合文件系统定义"></a>2.2.1 联合文件系统定义</h3><ul>
<li>联合文件系统(union filesystem)</li>
<li>联合文件系统是实现联合挂载技术的文件系统</li>
<li>联合挂载技术可以实现在一个挂载点同时挂载多个文件系统，将挂载点的原目录与被挂载内容进行整合，使得最终可见的文件系统包含整合之后的各层文件和目录</li>
</ul>
<h3 id="2-2-2-图解"><a href="#2-2-2-图解" class="headerlink" title="2.2.2 图解"></a>2.2.2 图解</h3><p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220125080435098.png" alt="image-20220125080435098"></p>
<h2 id="2-3-Docker-Overlay2"><a href="#2-3-Docker-Overlay2" class="headerlink" title="2.3 Docker Overlay2"></a>2.3 Docker Overlay2</h2><p>容器文件系统有多种存储驱动实现方式：aufs，devicemapper，overlay，overlay2 等，本次以overlay2为例进行说明。</p>
<h3 id="2-3-1-概念"><a href="#2-3-1-概念" class="headerlink" title="2.3.1 概念"></a>2.3.1 概念</h3><ul>
<li>registry/repository： registry 是 repository 的集合，repository 是镜像的集合。</li>
<li>image：image 是存储镜像相关的元数据，包括镜像的架构，镜像默认配置信息，镜像的容器配置信息等等。它是“逻辑”上的概念，并无物理上的镜像文件与之对应。</li>
<li>layer：layer(镜像层) 组成了镜像，单个 layer 可以被多个镜像共享。</li>
</ul>
<p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F.assets/image-20220125082226414.png" alt="image-20220125082226414"></p>
<h3 id="2-3-2-查看Docker-Host存储驱动方式"><a href="#2-3-2-查看Docker-Host存储驱动方式" class="headerlink" title="2.3.2 查看Docker Host存储驱动方式"></a>2.3.2 查看Docker Host存储驱动方式</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker info | grep overlay</span></span><br><span class="line"> Storage Driver: overlay2</span><br></pre></td></tr></table></figure>





<h3 id="2-3-3-了解images分层"><a href="#2-3-3-了解images分层" class="headerlink" title="2.3.3 了解images分层"></a>2.3.3 了解images分层</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker pull nginx</span></span><br><span class="line"><span class="keyword">Using</span> default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">a2abf6c4d29d: Pull complete</span><br><span class="line">a9edb18cadd1: Pull complete</span><br><span class="line"><span class="number">589</span>b7251471a: Pull complete</span><br><span class="line"><span class="number">186</span>b1aaa4aa6: Pull complete</span><br><span class="line">b4df32aa5a72: Pull complete</span><br><span class="line">a0bcbecc962e: Pull complete</span><br><span class="line">Digest: sha256:<span class="number">0</span>d17b565c37bcbd895e9d92315a05c1c3c9a29f762b011a10c54a66cd53c9b31</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br></pre></td></tr></table></figure>



<p>可以看到上述下载的镜像分为6层，如何找到这6层存储在Docker Host哪个位置呢？</p>
<p>首先查看nginx镜像</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx        latest    <span class="number">605</span>c77e624dd   <span class="number">3</span> weeks ago    <span class="number">141</span>MB</span><br></pre></td></tr></table></figure>



<p>通过其Image ID 605c77e624dd 就可以找到存储位置</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /var/lib/docker/image/overlay2/</span></span><br><span class="line">distribution  imagedb  layerdb  repositories.json</span><br></pre></td></tr></table></figure>



<p>这个目录是查找的入口，非常重要。它存储了镜像管理的元数据。</p>
<ul>
<li>repositories.json 记录了 repo 与镜像 ID 的映射关系</li>
<li>imagedb 记录了镜像架构，操作系统，构建镜像的容器 ID 和配置以及 rootfs 等信息</li>
<li>layerdb 记录了每层镜像层的元数据。</li>
</ul>
<p>通过短 ID 查找 repositories.json 文件，找到镜像 nginx 的长 ID，通过长 ID 在 imagedb 中找到该镜像的元数据：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /var/lib/docker/image/overlay2/repositories.json | grep 605c77e624dd</span></span><br><span class="line">&#123;<span class="string">&quot;Repositories&quot;</span>:<span class="string">&quot;nginx&quot;</span>:&#123;<span class="string">&quot;nginx:latest&quot;</span>:<span class="string">&quot;sha256:605c77e624ddb75e6110f997c58876baa13f8754486b461117934b24a9dc3a85&quot;</span>,<span class="string">&quot;nginx@sha256:0d17b565c37bcbd895e9d92315a05c1c3c9a29f762b011a10c54a66cd53c9b31&quot;</span>:<span class="string">&quot;sha256:605c77e624ddb75e6110f997c58876baa13f8754486b461117934b24a9dc3a85&quot;</span>&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /var/lib/docker/image/overlay2/imagedb/content/sha256/605c77e624ddb75e6110f997c58876baa13f8754486b461117934b24a9dc3a85</span></span><br><span class="line">......</span><br><span class="line"><span class="string">&quot;os&quot;</span>:<span class="string">&quot;linux&quot;</span>,<span class="string">&quot;rootfs&quot;</span>:&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;layers&quot;</span>,<span class="string">&quot;diff_ids&quot;</span>:[<span class="string">&quot;sha256:2edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f&quot;</span>,<span class="string">&quot;sha256:e379e8aedd4d72bb4c529a4ca07a4e4d230b5a1d3f7a61bc80179e8f02421ad8&quot;</span>,<span class="string">&quot;sha256:b8d6e692a25e11b0d32c5c3dd544b71b1085ddc1fddad08e68cbd7fda7f70221&quot;</span>,<span class="string">&quot;sha256:f1db227348d0a5e0b99b15a096d930d1a69db7474a1847acbc31f05e4ef8df8c&quot;</span>,<span class="string">&quot;sha256:32ce5f6a5106cc637d09a98289782edf47c32cb082dc475dd47cbf19a4f866da&quot;</span>,<span class="string">&quot;sha256:d874fd2bc83bb3322b566df739681fbd2248c58d3369cb25908d68e7ed6040a6&quot;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure>



<p>这里仅保留我们想要的元数据 rootfs。在 rootfs 中看到 layers 有6层，这6层即对应镜像的6层镜像层。并且，自上而下分别映射到容器的底层到顶层。找到了镜像的6层，接下来的问题是每层的文件内容在哪里呢？</p>
<p>layerdb 元数据会给我们想要的信息，通过底层 diff-id: 2edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f 我们查到最底层镜像层的 cache_id，通过 cache_id 即可查找到镜像层的文件内容：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /var/lib/docker/image/overlay2/layerdb/sha256/2edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f</span></span><br><span class="line">cache<span class="literal">-id</span>  <span class="built_in">diff</span>  size  tar<span class="operator">-split</span>.json.gz</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /var/lib/docker/image/overlay2/layerdb/sha256/2edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f/cache-id</span></span><br><span class="line"><span class="number">85</span>c4c5ecdac6c0d197f899dac227b9d493911a9a5820eac501bb5e9ae361f4c7</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /var/lib/docker/image/overlay2/layerdb/sha256/2edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f/diff</span></span><br><span class="line">sha256:<span class="number">2</span>edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f</span><br></pre></td></tr></table></figure>



<p>使用 cacheID 查找文件内容</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /var/lib/docker/overlay2/85c4c5ecdac6c0d197f899dac227b9d493911a9a5820eac501bb5e9ae361f4c7</span></span><br><span class="line">committed  <span class="built_in">diff</span>  link</span><br><span class="line"><span class="comment"># ls /var/lib/docker/overlay2/85c4c5ecdac6c0d197f899dac227b9d493911a9a5820eac501bb5e9ae361f4c7/diff</span></span><br><span class="line">bin   dev  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  etc  lib   media  opt  root  sbin  sys  usr</span><br></pre></td></tr></table></figure>



<p>上示例中，镜像元数据和镜像层内容是分开存储的。因此通过 cache-id 我们需要到 /var/lib/docker/overlay2 目录下查看镜像层内容，它就存在 diff 目录下，其中 link 存储的是镜像层对应的短 ID，后面会看到它的用场。</p>
<p>找到了镜像层的最底层，接着查找镜像层的“中间层”，发现在 layerdb 目录下没有 diff-id e379e8aedd4d72bb4c529a4ca07a4e4d230b5a1d3f7a61bc80179e8f02421ad8的镜像层：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /var/lib/docker/image/overlay2/layerdb/sha256/e379e8aedd4d72bb4c529a4ca07a4e4d230b5a1d3f7a61bc80179e8f02421ad8</span></span><br><span class="line"><span class="built_in">ls</span>: 无法访问/var/lib/docker/image/overlay2/layerdb/sha256/e379e8aedd4d72bb4c529a4ca07a4e4d230b5a1d3f7a61bc80179e8f02421ad8: 没有那个文件或目录</span><br></pre></td></tr></table></figure>



<p>这是因为 docker 引入了内容寻址机制，该机制会根据文件内容来索引镜像和镜像层。docker 利用 rootfs 中的 diff_id 计算出内容寻址的 chainID，通过 chainID 获取 layer 相关信息，最终索引到镜像层文件内容。</p>
<p>对于最底层镜像层其 diff_id 即是 chainID。因此我们可以查找到它的文件内容。除最底层外，chainID 需通过公式 chainID(n) = SHA256(chain(n-1) diffID(n)) 计算得到，计算“中间层” chainID：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo -n &quot;sha256:2edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f sha256:e379e8aedd4d72bb4c529a4ca07a4e4d230b5a1d3f7a61bc80179e8f02421ad8&quot; | sha256sum -</span></span><br><span class="line"><span class="number">780238</span>f18c540007376dd5e904f583896a69fe620876cabc06977a3af4ba4fb5  -</span><br></pre></td></tr></table></figure>



<p>根据 “中间层” chainID 查找文件内容：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /var/lib/docker/image/overlay2/layerdb/sha256/780238f18c540007376dd5e904f583896a69fe620876cabc06977a3af4ba4fb5</span></span><br><span class="line">cache<span class="literal">-id</span>  <span class="built_in">diff</span>  parent  size  tar<span class="operator">-split</span>.json.gz</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /var/lib/docker/image/overlay2/layerdb/sha256/780238f18c540007376dd5e904f583896a69fe620876cabc06977a3af4ba4fb5/cache-id</span></span><br><span class="line"><span class="number">57</span>e1f1b11e26f748161b7fccbf2ba6b24c2f98dc8a821729f0be215ad267498c</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /var/lib/docker/image/overlay2/layerdb/sha256/780238f18c540007376dd5e904f583896a69fe620876cabc06977a3af4ba4fb5/diff</span></span><br><span class="line">sha256:e379e8aedd4d72bb4c529a4ca07a4e4d230b5a1d3f7a61bc80179e8f02421ad8</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /var/lib/docker/image/overlay2/layerdb/sha256/780238f18c540007376dd5e904f583896a69fe620876cabc06977a3af4ba4fb5/parent</span></span><br><span class="line">sha256:<span class="number">2</span>edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">镜像层文件内容</span><br><span class="line"><span class="comment"># ls /var/lib/docker/overlay2/57e1f1b11e26f748161b7fccbf2ba6b24c2f98dc8a821729f0be215ad267498c</span></span><br><span class="line">committed  <span class="built_in">diff</span>  link  lower  work</span><br><span class="line"><span class="comment"># ls /var/lib/docker/overlay2/57e1f1b11e26f748161b7fccbf2ba6b24c2f98dc8a821729f0be215ad267498c/diff/</span></span><br><span class="line">docker<span class="literal">-entrypoint</span>.d  etc  lib  tmp  usr  var</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">镜像层文件内容短 ID</span><br><span class="line"><span class="comment"># cat /var/lib/docker/overlay2/57e1f1b11e26f748161b7fccbf2ba6b24c2f98dc8a821729f0be215ad267498c/link</span></span><br><span class="line"><span class="number">24</span>GM2IZVPTUROAG7AWJO5ZWE6B</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">“父”镜像层文件内容短 ID</span><br><span class="line"><span class="comment"># cat /var/lib/docker/overlay2/57e1f1b11e26f748161b7fccbf2ba6b24c2f98dc8a821729f0be215ad267498c/lower</span></span><br><span class="line">l/SICZO4QNVZEVOIJ4HDXVDKNYA2</span><br></pre></td></tr></table></figure>



<p>找到最底层文件内容和“中间层”文件内容，再去找最顶层文件内容就变的不难了</p>
<h2 id="2-4-Docker容器与镜像"><a href="#2-4-Docker容器与镜像" class="headerlink" title="2.4 Docker容器与镜像"></a>2.4 Docker容器与镜像</h2><p>通过 docker run 命令启动一个镜像为 nginx的容器：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -d nginx:latest</span></span><br><span class="line"><span class="number">3272831107</span>a3499afe8160b0cd423e2ac4223522f1995b7be3504a1d3d272878</span><br><span class="line"><span class="comment"># docker ps | grep nginx</span></span><br><span class="line"><span class="number">3272831107</span>a3   nginx:latest   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">11</span> seconds ago   Up <span class="number">9</span> seconds   <span class="number">80</span>/tcp    angry_beaver</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount | grep overlay</span></span><br><span class="line">overlay on /var/lib/docker/overlay2/b3f5c8b42ac055c715216e376cfe44571f618a876f481533ec1434aa0bc4f8ed/merged <span class="built_in">type</span> overlay (rw,relatime,seclabel,lowerdir=/var/lib/docker/overlay2/l/MS2X66BYF6UZ7EKUWMZJKCF4HO:/var/lib/docker/overlay2/l/ODJROQUGY3WQMOGQ3BLYZGIAG4:/var/lib/docker/overlay2/l/Q5LOBFJRH5M7M5CMSWW5L4VYOY:/var/lib/docker/overlay2/l/ZR35FN2E3WEARZV4HLRU373FT7:/var/lib/docker/overlay2/l/NSM2PTAT6TIT2H6G3HFNGZJH5N:/var/lib/docker/overlay2/l/<span class="number">24</span>GM2IZVPTUROAG7AWJO5ZWE6B:/var/lib/docker/overlay2/l/SICZO4QNVZEVOIJ4HDXVDKNYA2,upperdir=/var/lib/docker/overlay2/b3f5c8b42ac055c715216e376cfe44571f618a876f481533ec1434aa0bc4f8ed/<span class="built_in">diff</span>,workdir=/var/lib/docker/overla <span class="number">2</span>/b3f5c8b42ac055c715216e376cfe44571f618a876f481533ec1434aa0bc4f8ed/work)</span><br></pre></td></tr></table></figure>



<p>可以看到，启动容器会 mount 一个 overlay 的联合文件系统到容器内。这个文件系统由三层组成：</p>
<ul>
<li>lowerdir：只读层，即为镜像的镜像层。</li>
<li>upperdir：读写层，该层是容器的读写层，对容器的读写操作将反映在读写层。</li>
<li>workdir： overlayfs 的内部层，用于实现从只读层到读写层的 copy_up 操作。</li>
<li>merge：容器内作为同一视图联合挂载点的目录。</li>
</ul>
<p>这里需要着重介绍的是容器的 lowerdir 镜像只读层，查看只读层的短 ID：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lowerdir=/var/lib/docker/overlay2/l/MS2X66BYF6UZ7EKUWMZJKCF4HO</span><br><span class="line">/var/lib/docker/overlay2/l/ODJROQUGY3WQMOGQ3BLYZGIAG4</span><br><span class="line">/var/lib/docker/overlay2/l/Q5LOBFJRH5M7M5CMSWW5L4VYOY</span><br><span class="line">/var/lib/docker/overlay2/l/ZR35FN2E3WEARZV4HLRU373FT7</span><br><span class="line">/var/lib/docker/overlay2/l/NSM2PTAT6TIT2H6G3HFNGZJH5N</span><br><span class="line">/var/lib/docker/overlay2/l/<span class="number">24</span>GM2IZVPTUROAG7AWJO5ZWE6B</span><br><span class="line">/var/lib/docker/overlay2/l/SICZO4QNVZEVOIJ4HDXVDKNYA2</span><br></pre></td></tr></table></figure>



<p>镜像层只有6层这里的短 ID 却有7个？<br>在 /var/lib/docker/overlay2/l 目录下我们找到了答案：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /var/lib/docker/overlay2/l</span></span><br><span class="line"><span class="comment"># pwd</span></span><br><span class="line">/var/lib/docker/overlay2/l</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line"><span class="number">24</span>GM2IZVPTUROAG7AWJO5ZWE6B  LZEAXJGRW6HKBBGGB2N4CWMSVJ  R2XTGODAA67NQJM44MIKMDUF4W</span><br><span class="line"><span class="number">5</span>OI5WMJ2FP7QI7IFWDMHLBRDDN  MS2X66BYF6UZ7EKUWMZJKCF4HO  SICZO4QNVZEVOIJ4HDXVDKNYA2</span><br><span class="line"><span class="number">644</span>ISPHLTBSSC2KLP6BGHHHZPR  NSM2PTAT6TIT2H6G3HFNGZJH5N  ZR35FN2E3WEARZV4HLRU373FT7</span><br><span class="line"><span class="number">6</span>CQUILQSJNVTMFFV3ABCCOGOYG  ODJROQUGY3WQMOGQ3BLYZGIAG4</span><br><span class="line">BQENAYC44O2ZCZFT5URMH5OADK  Q5LOBFJRH5M7M5CMSWW5L4VYOY</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls -l MS2X66BYF6UZ7EKUWMZJKCF4HO/</span></span><br><span class="line">总用量 <span class="number">0</span></span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">4</span> root root <span class="number">43</span> <span class="number">1</span>月  <span class="number">25</span> <span class="number">01</span>:<span class="number">27</span> dev</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">2</span> root root <span class="number">66</span> <span class="number">1</span>月  <span class="number">25</span> <span class="number">01</span>:<span class="number">27</span> etc</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">l</span>]<span class="comment"># ls -l ODJROQUGY3WQMOGQ3BLYZGIAG4/</span></span><br><span class="line">总用量 <span class="number">0</span></span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">2</span> root root <span class="number">41</span> <span class="number">12</span>月 <span class="number">30</span> <span class="number">03</span>:<span class="number">28</span> docker<span class="literal">-entrypoint</span>.d</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">l</span>]<span class="comment"># ls -l Q5LOBFJRH5M7M5CMSWW5L4VYOY/</span></span><br><span class="line">总用量 <span class="number">0</span></span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">2</span> root root <span class="number">41</span> <span class="number">12</span>月 <span class="number">30</span> <span class="number">03</span>:<span class="number">28</span> docker<span class="literal">-entrypoint</span>.d</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">l</span>]<span class="comment"># ls -l ZR35FN2E3WEARZV4HLRU373FT7/</span></span><br><span class="line">总用量 <span class="number">0</span></span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">2</span> root root <span class="number">45</span> <span class="number">12</span>月 <span class="number">30</span> <span class="number">03</span>:<span class="number">28</span> docker<span class="literal">-entrypoint</span>.d</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">l</span>]<span class="comment"># ls -l NSM2PTAT6TIT2H6G3HFNGZJH5N/</span></span><br><span class="line">总用量 <span class="number">4</span></span><br><span class="line"><span class="literal">-rwxrwxr</span><span class="literal">-x</span>. <span class="number">1</span> root root <span class="number">1202</span> <span class="number">12</span>月 <span class="number">30</span> <span class="number">03</span>:<span class="number">28</span> docker<span class="literal">-entrypoint</span>.sh</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">l</span>]<span class="comment"># ls -l 24GM2IZVPTUROAG7AWJO5ZWE6B/</span></span><br><span class="line">总用量 <span class="number">4</span></span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">30</span> <span class="number">03</span>:<span class="number">28</span> docker<span class="literal">-entrypoint</span>.d</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">18</span> root root <span class="number">4096</span> <span class="number">12</span>月 <span class="number">30</span> <span class="number">03</span>:<span class="number">28</span> etc</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">4</span> root root   <span class="number">45</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> lib</span><br><span class="line">drwxrwxrwt.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">30</span> <span class="number">03</span>:<span class="number">28</span> tmp</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">7</span> root root   <span class="number">66</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> usr</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">5</span> root root   <span class="number">41</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> var</span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="type">l</span>]<span class="comment"># ls -l SICZO4QNVZEVOIJ4HDXVDKNYA2/</span></span><br><span class="line">总用量 <span class="number">12</span></span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root <span class="number">4096</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> bin</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">12</span> <span class="number">01</span>:<span class="number">25</span> boot</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> dev</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">30</span> root root <span class="number">4096</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> etc</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">12</span> <span class="number">01</span>:<span class="number">25</span> home</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">8</span> root root   <span class="number">96</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> lib</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root   <span class="number">34</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> lib64</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> media</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> mnt</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> opt</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">12</span> <span class="number">01</span>:<span class="number">25</span> proc</span><br><span class="line">drwx------.  <span class="number">2</span> root root   <span class="number">37</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> root</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">3</span> root root   <span class="number">30</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> run</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root <span class="number">4096</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> sbin</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> srv</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">12</span> <span class="number">01</span>:<span class="number">25</span> sys</span><br><span class="line">drwxrwxrwt.  <span class="number">2</span> root root    <span class="number">6</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> tmp</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">11</span> root root  <span class="number">120</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> usr</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>. <span class="number">11</span> root root  <span class="number">139</span> <span class="number">12</span>月 <span class="number">20</span> <span class="number">08</span>:<span class="number">00</span> var</span><br></pre></td></tr></table></figure>



<p>镜像层ODJROQUGY3WQMOGQ3BLYZGIAG4/Q5LOBFJRH5M7M5CMSWW5L4VYOY/ZR35FN2E3WEARZV4HLRU373FT7/NSM2PTAT6TIT2H6G3HFNGZJH5N/24GM2IZVPTUROAG7AWJO5ZWE6B/SICZO4QNVZEVOIJ4HDXVDKNYA2 分别对应镜像的6层镜像层文件内容，它们分别映射到镜像层的 diff 目录。而 MS2X66BYF6UZ7EKUWMZJKCF4HO映射的是容器的初始化层 init，该层内容是和容器配置相关的文件内容，它是只读的。</p>
<p>启动了容器，docker 将镜像的内容 mount 到容器中。那么，如果在容器内写文件会对镜像有什么影响呢？</p>
<h2 id="2-5-容器内写文件"><a href="#2-5-容器内写文件" class="headerlink" title="2.5 容器内写文件"></a>2.5 容器内写文件</h2><p>不难理解，镜像层是只读的，在容器中写文件其实是将文件写入到 overlay 的可读写层。</p>
<p>这里有几个 case 可以测试：</p>
<ul>
<li>读写层不存在该文件，只读层存在。</li>
<li>读写层存在该文件，只读层不存在。</li>
<li>读写层和只读层都不存在该文件。</li>
</ul>
<p>我们简单构建一种读写层和只读层都不存在的场景：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -it centos:latest bash</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">355</span><span class="type">e99982248</span> /]<span class="comment"># touch lixiang.txt</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">355</span><span class="type">e99982248</span> /]<span class="comment"># ls</span></span><br><span class="line">bin  etc   lib    lost+found  mnt      opt   root  sbin  sys  usr</span><br><span class="line">dev  home  lib64  media       lixiang.txt  proc  run   srv   tmp  var</span><br></pre></td></tr></table></figure>



<p>查看读写层是否有该文件：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">查看镜像是否有变化</span><br><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">ubuntu       latest    d13c942271d6   <span class="number">2</span> weeks ago    <span class="number">72.8</span>MB</span><br><span class="line">bash         latest    <span class="number">5557</span>e073f11c   <span class="number">2</span> weeks ago    <span class="number">13</span>MB</span><br><span class="line">nginx        latest    <span class="number">605</span>c77e624dd   <span class="number">3</span> weeks ago    <span class="number">141</span>MB</span><br><span class="line">centos       latest    <span class="number">5</span>d0da3dc9764   <span class="number">4</span> months ago   <span class="number">231</span>MB</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cat /var/lib/docker/image/overlay2/repositories.json | grep 5d0da3dc9764</span></span><br><span class="line">&#123;<span class="string">&quot;Repositories&quot;</span>&#123;<span class="string">&quot;centos:latest&quot;</span>:<span class="string">&quot;sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6&quot;</span>,<span class="string">&quot;centos@sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177&quot;</span>:<span class="string">&quot;sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6&quot;</span>&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cat /var/lib/docker/image/overlay2/imagedb/content/sha256/5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6</span></span><br><span class="line">&#123;<span class="string">&quot;os&quot;</span>:<span class="string">&quot;linux&quot;</span>,<span class="string">&quot;rootfs&quot;</span>:&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;layers&quot;</span>,<span class="string">&quot;diff_ids&quot;</span>:[<span class="string">&quot;sha256:74ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59&quot;</span>]&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ls </span></span><br><span class="line">/var/lib/docker/image/overlay2/layerdb/sha256/<span class="number">74</span>ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59:</span><br><span class="line">cache<span class="literal">-id</span>  <span class="built_in">diff</span>  size  tar<span class="operator">-split</span>.json.gz</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cat /var/lib/docker/image/overlay2/layerdb/sha256/74ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59/cache-id</span></span><br><span class="line">b17bc5c5103514923a30983c48f909e06f366b7aa1e85f112b67abb3ef5cd0cb</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># cat /var/lib/docker/image/overlay2/layerdb/sha256/74ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59/diff</span></span><br><span class="line">sha256:<span class="number">74</span>ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ls /var/lib/docker/overlay2/b17bc5c5103514923a30983c48f909e06f366b7aa1e85f112b67abb3ef5cd0cb</span></span><br><span class="line">committed  <span class="built_in">diff</span>  link</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ls /var/lib/docker/overlay2/b17bc5c5103514923a30983c48f909e06f366b7aa1e85f112b67abb3ef5cd0cb/diff/</span></span><br><span class="line">bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看容器是否有变化</span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># mount | grep overlay</span></span><br><span class="line"><span class="built_in">type</span> overlay (rw,relatime,seclabel,lowerdir=/var/lib/docker/overlay2/l/R2W2LEMDPRIUFYDVSLIQSCYTGX:/var/lib/docker/overlay2/l/R2XTGODAA67NQJM44MIKMDUF4W,upperdir=/var/lib/docker overlay2/<span class="number">7</span>f0b54c748171872ce564305e394547555cb1182abf802c2262384be3dc78a8f/<span class="built_in">diff</span>,workdir=/var/lib/docker/overlay2/<span class="number">7</span>f0b54c748171872ce564305e394547555cb1182abf802c2262384be3dc78a8f/work)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ls -l /var/lib/docker/overlay2/l/</span></span><br><span class="line">总用量 <span class="number">0</span></span><br><span class="line"></span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root <span class="number">77</span> <span class="number">1</span>月  <span class="number">25</span> <span class="number">01</span>:<span class="number">41</span> R2W2LEMDPRIUFYDVSLIQSCYTGX -&gt; ../<span class="number">7</span>f0b54c748171872ce564305e394547555cb1182abf802c2262384be3dc78a8f<span class="literal">-init</span>/<span class="built_in">diff</span></span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root <span class="number">72</span> <span class="number">1</span>月  <span class="number">25</span> <span class="number">00</span>:<span class="number">29</span> R2XTGODAA67NQJM44MIKMDUF4W -&gt; ../b17bc5c5103514923a30983c48f909e06f366b7aa1e85f112b67abb3ef5cd0cb/<span class="built_in">diff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ls /var/lib/docker/overlay2/7f0b54c748171872ce564305e394547555cb1182abf802c2262384be3dc78a8f/diff</span></span><br><span class="line">lixiang.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">localhost</span> ~]<span class="comment"># ls /var/lib/docker/overlay2/7f0b54c748171872ce564305e394547555cb1182abf802c2262384be3dc78a8f/merged/</span></span><br><span class="line">bin  etc   lib    lost+found  mnt      opt   root  sbin  sys  usr</span><br><span class="line">dev  home  lib64  media       lixiang.txt  proc  run   srv   tmp  var</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="三、Docker容器镜像操作命令"><a href="#三、Docker容器镜像操作命令" class="headerlink" title="三、Docker容器镜像操作命令"></a>三、Docker容器镜像操作命令</h1><h2 id="3-1-docker-commit"><a href="#3-1-docker-commit" class="headerlink" title="3.1  docker commit"></a>3.1  docker commit</h2><p>上节提到容器内写文件会反映在 overlay 的可读写层，那么读写层的文件内容可以做成镜像吗？</p>
<p>可以。docker 通过 commit 和 build 操作实现镜像的构建。commit 将容器提交为一个镜像，build 在一个镜像的基础上构建镜像。</p>
<p>使用 commit 将上节的容器提交为一个镜像：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="number">355</span><span class="type">e99982248</span> /]<span class="comment">#   ctrl+p+q</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE           COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line"><span class="number">355</span>e99982248   centos:latest   <span class="string">&quot;bash&quot;</span>                   <span class="number">21</span> minutes ago   Up <span class="number">21</span> minutes             fervent_perlman</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker commit 355e99982248</span></span><br><span class="line">sha256:<span class="number">8965</span>dcf23201ed42d4904e2f10854d301ad93b34bea73f384440692e006943de</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">&lt;none&gt;       &lt;none&gt;    <span class="number">8965</span>dcf23201   About a minute ago   <span class="number">231</span>MB</span><br></pre></td></tr></table></figure>





<p>image 短 ID 8965dcf23201 即为容器提交的镜像，查看镜像的 imagedb 元数据：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat  /var/lib/docker/image/overlay2/imagedb/content/sha256/8965dcf23201ed42d4904e2f10854d301ad93b34bea73f384440692e006943de</span></span><br><span class="line">......</span><br><span class="line"><span class="string">&quot;os&quot;</span>:<span class="string">&quot;linux&quot;</span>,<span class="string">&quot;rootfs&quot;</span>:&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;layers&quot;</span>,<span class="string">&quot;diff_ids&quot;</span>:[<span class="string">&quot;sha256:74ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59&quot;</span>,<span class="string">&quot;sha256:551c3089b186b4027e949910981ff1ba54114610f2aab9359d28694c18b0203b&quot;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure>



<p>可以看到镜像层自上而下的前1个镜像层 diff_id 和 centos 镜像层 diff_id 是一样的，说明每层镜像层可以被多个镜像共享。而多出来的一层镜像层内容即是上节我们写入文件的内容：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo -n &quot;sha256:74ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59 sha256:551c3089b186b4027e949910981ff1ba54114610f2aab9359d28694c18b0203b&quot; | sha256sum -</span></span><br><span class="line"><span class="number">92</span>f7208b1cc0b5cc8fe214a4b0178aa4962b58af8ec535ee7211f335b1e0ed3b  -</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /var/lib/docker/image/overlay2/layerdb/sha256/92f7208b1cc0b5cc8fe214a4b0178aa4962b58af8ec535ee7211f335b1e0ed3b</span></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="number">92</span><span class="type">f7208b1cc0b5cc8fe214a4b0178aa4962b58af8ec535ee7211f335b1e0ed3b</span>]<span class="comment"># ls</span></span><br><span class="line">cache<span class="literal">-id</span>  <span class="built_in">diff</span>  parent  size  tar<span class="operator">-split</span>.json.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="number">92</span><span class="type">f7208b1cc0b5cc8fe214a4b0178aa4962b58af8ec535ee7211f335b1e0ed3b</span>]<span class="comment"># cat cache-id</span></span><br><span class="line"><span class="number">250</span>dc0b4f2c5f27952241a55cd4c286bfaaf8af4b77c9d0a38976df4c147cb95</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="number">92</span><span class="type">f7208b1cc0b5cc8fe214a4b0178aa4962b58af8ec535ee7211f335b1e0ed3b</span>]<span class="comment"># ls /var/lib/docker/overlay2/250dc0b4f2c5f27952241a55cd4c286bfaaf8af4b77c9d0a38976df4c147cb95</span></span><br><span class="line"><span class="built_in">diff</span>  link  lower  work</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="number">192</span> <span class="number">92</span><span class="type">f7208b1cc0b5cc8fe214a4b0178aa4962b58af8ec535ee7211f335b1e0ed3b</span>]<span class="comment"># ls /var/lib/docker/overlay2/250dc0b4f2c5f27952241a55cd4c286bfaaf8af4b77c9d0a38976df4c147cb95/diff</span></span><br><span class="line">lixiang.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-2-docker-save"><a href="#3-2-docker-save" class="headerlink" title="3.2 docker save"></a>3.2 docker save</h2><blockquote>
<p>导出容器镜像，方便分享。</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker save -o centos.tar centos:latest  </span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls</span></span><br><span class="line"></span><br><span class="line">centos.tar  </span><br></pre></td></tr></table></figure>





<h2 id="3-3-docker-load"><a href="#3-3-docker-load" class="headerlink" title="3.3 docker load"></a>3.3 docker load</h2><blockquote>
<p>把他人分享的容器镜像导入到本地，这通常是容器镜像分发方式之一。</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker load -i centos.tar</span></span><br></pre></td></tr></table></figure>





<h2 id="3-4-docker-export"><a href="#3-4-docker-export" class="headerlink" title="3.4 docker export"></a>3.4 docker export</h2><blockquote>
<p>把正在运行的容器导出</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE           COMMAND                  CREATED       STATUS       PORTS     NAMES</span><br><span class="line"><span class="number">355</span>e99982248   centos:latest   <span class="string">&quot;bash&quot;</span>                   <span class="number">7</span> hours ago   Up <span class="number">7</span> hours             fervent_perlman</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker export -o centos7.tar 355e99982248</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls</span></span><br><span class="line">centos7.tar</span><br></pre></td></tr></table></figure>


<h2 id="3-5-docker-import"><a href="#3-5-docker-import" class="headerlink" title="3.5 docker import"></a>3.5 docker import</h2><blockquote>
<p>导入使用docker export导入的容器做为本地容器镜像。</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls</span></span><br><span class="line">centos7.tar </span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker import centos7.tar centos7:v1</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">centos7      v1        <span class="number">3639</span>f9a13231   <span class="number">17</span> seconds ago       <span class="number">231</span>MB</span><br></pre></td></tr></table></figure>


<p>通过docker save与docker load及docker export与docker import分享容器镜像都是非常麻烦的，有没有更方便的方式分享容器镜像呢？</p>

  </div>
</article>





    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>  
    <div id="vcomments" class="blog-post-comments"></div>
    <script>        
        new Valine({
            el: '#vcomments',
            visitor: true,
            appId: 'gqmHGHyrnzRPUSxqADLhUzlT-gzGzoHsz',
            appKey: 'q8uQ7rKeukTuQ3L35peaOhkC',
            placeholder: '好哥哥，说几句吧！',
            avatar: 'retro'
        })
    </script>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"><span class="toc-number">1.</span> <span class="toc-text">Docker容器镜像</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">一、Docker容器镜像操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 查看本地容器镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E4%BD%BF%E7%94%A8docker-images%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 使用docker images命令查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E4%BD%BF%E7%94%A8docker-image%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 使用docker image命令查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-%E6%9F%A5%E7%9C%8Bdocker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.3 查看docker容器镜像本地存储位置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%90%9C%E7%B4%A2Docker-Hub%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 搜索Docker Hub容器镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%90%9C%E7%B4%A2"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 命令行搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-Docker-Hub-Web%E7%95%8C%E9%9D%A2%E6%90%9C%E7%B4%A2"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 Docker Hub Web界面搜索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Docker-%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Docker 容器镜像下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%88%A0%E9%99%A4%E6%96%B9%E6%B3%95"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 Docker容器镜像删除方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text">二、Docker容器镜像介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Docker-Image"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 Docker Image</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 联合文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%9A%E4%B9%89"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.2.1 联合文件系统定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E5%9B%BE%E8%A7%A3"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2.2 图解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Docker-Overlay2"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 Docker Overlay2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E6%A6%82%E5%BF%B5"><span class="toc-number">3.3.1.</span> <span class="toc-text">2.3.1 概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E6%9F%A5%E7%9C%8BDocker-Host%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.3.2 查看Docker Host存储驱动方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E4%BA%86%E8%A7%A3images%E5%88%86%E5%B1%82"><span class="toc-number">3.3.3.</span> <span class="toc-text">2.3.3 了解images分层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Docker%E5%AE%B9%E5%99%A8%E4%B8%8E%E9%95%9C%E5%83%8F"><span class="toc-number">3.4.</span> <span class="toc-text">2.4 Docker容器与镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%AE%B9%E5%99%A8%E5%86%85%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">3.5.</span> <span class="toc-text">2.5 容器内写文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">三、Docker容器镜像操作命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-docker-commit"><span class="toc-number">4.1.</span> <span class="toc-text">3.1  docker commit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-docker-save"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 docker save</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-docker-load"><span class="toc-number">4.3.</span> <span class="toc-text">3.3 docker load</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-docker-export"><span class="toc-number">4.4.</span> <span class="toc-text">3.4 docker export</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-docker-import"><span class="toc-number">4.5.</span> <span class="toc-text">3.5 docker import</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&text=Docker核心概念容器镜像"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&is_video=false&description=Docker核心概念容器镜像"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Docker核心概念容器镜像&body=Check out this article: https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&title=Docker核心概念容器镜像"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://fate-re-zero.github.io/2023/07/29/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/&name=Docker核心概念容器镜像&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">2025 祥祥要起飞</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>


<script src="/lib/particles/particles.min.js"></script>


<script src="/lib/typing/typing.min.js"></script>


<script src="/js/main.js"></script>


<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


