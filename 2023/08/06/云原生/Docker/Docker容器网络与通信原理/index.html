<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="一、Docker容器默认网络模型1.1 原理图 1.2 名词解释 docker0 是一个二层网络设备，即网桥 通过网桥可以将Linux支持的不同的端口连接起来 实现类交换机多对多的通信   veth pair 虚拟以太网（Ethernet）设备 成对出现,用于解决网络命名空间之间的隔离 一端连接Container network namespace，另一端连接host network namesp">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker容器网络与通信原理">
<meta property="og:url" content="https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/index.html">
<meta property="og:site_name" content="祥祥要起飞">
<meta property="og:description" content="一、Docker容器默认网络模型1.1 原理图 1.2 名词解释 docker0 是一个二层网络设备，即网桥 通过网桥可以将Linux支持的不同的端口连接起来 实现类交换机多对多的通信   veth pair 虚拟以太网（Ethernet）设备 成对出现,用于解决网络命名空间之间的隔离 一端连接Container network namespace，另一端连接host network namesp">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220208180516669.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220208190823162.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220208191400324.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220209120452509.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker容器网络与通信原理深度解析.assets/image-20220209152555577.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220209230459054.png">
<meta property="article:published_time" content="2023-08-06T00:48:22.000Z">
<meta property="article:modified_time" content="2025-04-23T15:49:18.417Z">
<meta property="article:author" content="祥祥要起飞">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fate-re-zero.github.io/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220208180516669.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Docker容器网络与通信原理</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="祥祥要起飞" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2023/08/09/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E6%9C%BA%E5%88%B6/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2023/08/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Dockerfile%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E6%8A%80%E6%9C%AF/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&text=Docker容器网络与通信原理"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&is_video=false&description=Docker容器网络与通信原理"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Docker容器网络与通信原理&body=Check out this article: https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&name=Docker容器网络与通信原理&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">一、Docker容器默认网络模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 原理图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 名词解释</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">二、Docker容器默认网络模型工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%AE%B9%E5%99%A8%E8%AE%BF%E9%97%AE%E5%A4%96%E7%BD%91"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 容器访问外网</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%A4%96%E7%BD%91%E8%AE%BF%E9%97%AE%E5%AE%B9%E5%99%A8"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 外网访问容器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Docker%E5%AE%B9%E5%99%A8%E5%9B%9B%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">三、Docker容器四种网络模型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Docker%E5%AE%B9%E5%99%A8%E5%9B%9B%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">4.</span> <span class="toc-text">四、Docker容器四种网络模型应用案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%9F%A5%E7%9C%8B%E5%B7%B2%E6%9C%89%E7%9A%84%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 查看已有的网络模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%88%9B%E5%BB%BA%E6%8C%87%E5%AE%9A%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 创建指定类型的网络模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-bridge"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1 bridge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-host"><span class="toc-number">4.2.2.</span> <span class="toc-text">4.2.2 host</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-none"><span class="toc-number">4.2.3.</span> <span class="toc-text">4.2.3 none</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-%E8%81%94%E7%9B%9F%E7%BD%91%E7%BB%9C"><span class="toc-number">4.2.4.</span> <span class="toc-text">4.2.4 联盟网络</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E8%B7%A8Docker-Host%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">五、跨Docker Host容器间通信实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E8%B7%A8Docker-Host%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1%E5%BF%85%E8%A6%81%E6%80%A7"><span class="toc-number">5.1.</span> <span class="toc-text">5.1  跨Docker Host容器间通信必要性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E8%B7%A8Docker-Host%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 跨Docker Host容器间通信实现方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-Docker%E5%8E%9F%E7%94%9F%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.1.</span> <span class="toc-text">5.2.1 Docker原生方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.2.</span> <span class="toc-text">5.2.2 第三方方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-1-%E9%9A%A7%E9%81%93%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.2.1.</span> <span class="toc-text">5.2.2.1 隧道方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-2-%E8%B7%AF%E7%94%B1%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.2.2.</span> <span class="toc-text">5.2.2.2 路由方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-Flannel"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 Flannel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-overlay-network%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.3.1.</span> <span class="toc-text">5.3.1 overlay network介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-Flannel%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.3.2.</span> <span class="toc-text">5.3.2 Flannel介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-Flannel%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">5.3.3.</span> <span class="toc-text">5.3.3 Flannel工作原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-ETCD"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 ETCD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-ETCD%E9%83%A8%E7%BD%B2"><span class="toc-number">5.5.</span> <span class="toc-text">5.5 ETCD部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-1-%E4%B8%BB%E6%9C%BA%E5%90%8D%E7%A7%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">5.5.1.</span> <span class="toc-text">5.5.1  主机名称配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-2-%E4%B8%BB%E6%9C%BAIP%E5%9C%B0%E5%9D%80%E9%85%8D%E7%BD%AE"><span class="toc-number">5.5.2.</span> <span class="toc-text">5.5.2 主机IP地址配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-3-%E4%B8%BB%E6%9C%BA%E5%90%8D%E4%B8%8EIP%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90"><span class="toc-number">5.5.3.</span> <span class="toc-text">5.5.3 主机名与IP地址解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-4-%E5%BC%80%E5%90%AF%E5%86%85%E6%A0%B8%E8%BD%AC%E5%8F%91"><span class="toc-number">5.5.4.</span> <span class="toc-text">5.5.4 开启内核转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-5-etcd%E5%AE%89%E8%A3%85"><span class="toc-number">5.5.5.</span> <span class="toc-text">5.5.5 etcd安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-6-etcd%E9%85%8D%E7%BD%AE"><span class="toc-number">5.5.6.</span> <span class="toc-text">5.5.6 etcd配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-7-%E5%90%AF%E5%8A%A8etcd%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.5.7.</span> <span class="toc-text">5.5.7 启动etcd服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-8-%E6%A3%80%E6%9F%A5%E7%AB%AF%E5%8F%A3%E7%8A%B6%E6%80%81"><span class="toc-number">5.5.8.</span> <span class="toc-text">5.5.8 检查端口状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-9-%E6%A3%80%E6%9F%A5etcd%E9%9B%86%E7%BE%A4%E6%98%AF%E5%90%A6%E5%81%A5%E5%BA%B7"><span class="toc-number">5.5.9.</span> <span class="toc-text">5.5.9 检查etcd集群是否健康</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-Flannel%E9%83%A8%E7%BD%B2"><span class="toc-number">5.6.</span> <span class="toc-text">5.6 Flannel部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-1-Flannel%E5%AE%89%E8%A3%85"><span class="toc-number">5.6.1.</span> <span class="toc-text">5.6.1 Flannel安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-2-%E4%BF%AE%E6%94%B9Flannel%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.6.2.</span> <span class="toc-text">5.6.2 修改Flannel配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-3-%E9%85%8D%E7%BD%AEetcd%E4%B8%AD%E5%85%B3%E4%BA%8Eflannel%E7%9A%84key"><span class="toc-number">5.6.3.</span> <span class="toc-text">5.6.3 配置etcd中关于flannel的key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-4-%E5%90%AF%E5%8A%A8Flannel%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.6.4.</span> <span class="toc-text">5.6.4 启动Flannel服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-5-%E6%9F%A5%E7%9C%8B%E5%90%84node%E4%B8%ADflannel%E4%BA%A7%E7%94%9F%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">5.6.5.</span> <span class="toc-text">5.6.5 查看各node中flannel产生的配置信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-Docker%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">5.7.</span> <span class="toc-text">5.7 Docker网络配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-8-%E8%B7%A8Docker-Host%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1%E9%AA%8C%E8%AF%81"><span class="toc-number">5.8.</span> <span class="toc-text">5.8 跨Docker Host容器间通信验证</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Docker容器网络与通信原理
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">祥祥要起飞</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-08-06T00:48:22.000Z" itemprop="datePublished">2023-08-06</time>
        
      
    </div>


      <div class="posteye">
    <i class="fas fa-eye"></i>
    <span id="/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/" class="leancloud-visitors" data-flag-title="Docker容器网络与通信原理" style="display: inline;">
        <span class="leancloud-visitors-count"></span>
    </span>
</div>
      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Docker/" rel="tag">Docker</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="一、Docker容器默认网络模型"><a href="#一、Docker容器默认网络模型" class="headerlink" title="一、Docker容器默认网络模型"></a>一、Docker容器默认网络模型</h1><h2 id="1-1-原理图"><a href="#1-1-原理图" class="headerlink" title="1.1 原理图"></a>1.1 原理图</h2><p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220208180516669.png" alt="image-20220208180516669"></p>
<h2 id="1-2-名词解释"><a href="#1-2-名词解释" class="headerlink" title="1.2 名词解释"></a>1.2 名词解释</h2><ul>
<li>docker0<ul>
<li>是一个二层网络设备，即网桥</li>
<li>通过网桥可以将Linux支持的不同的端口连接起来</li>
<li>实现类交换机多对多的通信</li>
</ul>
</li>
<li>veth pair<ul>
<li>虚拟以太网（Ethernet）设备</li>
<li>成对出现,用于解决网络命名空间之间的隔离</li>
<li>一端连接Container network namespace，另一端连接host network namespace</li>
</ul>
</li>
</ul>
<h1 id="二、Docker容器默认网络模型工作原理"><a href="#二、Docker容器默认网络模型工作原理" class="headerlink" title="二、Docker容器默认网络模型工作原理"></a>二、Docker容器默认网络模型工作原理</h1><h2 id="2-1-容器访问外网"><a href="#2-1-容器访问外网" class="headerlink" title="2.1 容器访问外网"></a>2.1 容器访问外网</h2><p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220208190823162.png" alt="image-20220208190823162"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -d --name web1 -p 8081:80 nginx:latest</span></span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -t nat -vnL POSTROUTING</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输出：</span><br><span class="line">Chain POSTROUTING (policy ACCEPT <span class="number">7</span> packets, <span class="number">766</span> bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     source               destination</span><br><span class="line">    <span class="number">0</span>     <span class="number">0</span> MASQUERADE  tcp  --  *      *       <span class="number">172.17</span>.<span class="number">0.2</span>           <span class="number">172.17</span>.<span class="number">0.2</span>           tcp dpt:<span class="number">80</span></span><br></pre></td></tr></table></figure>





<h2 id="2-2-外网访问容器"><a href="#2-2-外网访问容器" class="headerlink" title="2.2 外网访问容器"></a>2.2 外网访问容器</h2><p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220208191400324.png" alt="image-20220208191400324"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -t nat -vnL DOCKER</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输出：</span><br><span class="line">Chain DOCKER (<span class="number">2</span> references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     source               destination</span><br><span class="line">    <span class="number">0</span>     <span class="number">0</span> DNAT       tcp  --  !docker0 *       <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            tcp dpt:<span class="number">8081</span> to:<span class="number">172.17</span>.<span class="number">0.2</span>:<span class="number">80</span></span><br></pre></td></tr></table></figure>





<h1 id="三、Docker容器四种网络模型"><a href="#三、Docker容器四种网络模型" class="headerlink" title="三、Docker容器四种网络模型"></a>三、Docker容器四种网络模型</h1><p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220209120452509.png" alt="image-20220209120452509"></p>
<table>
<thead>
<tr>
<th>模式</th>
<th>使用方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>bridge [桥接式网络(Bridge container A)]</td>
<td>–network    bridge</td>
<td>桥接容器，除了有一块本地回环接口(Loopback interface)外，还有一块私有接口(Private interface)通过容器虚拟接口(Container virtual interface)连接到桥接虚拟接口(Docker bridge virtual interface)，之后通过逻辑主机接口(Logical host interface)连接到主机物理网络(Physical network interface)。<br>桥接网卡默认会分配到172.17.0.0/16的IP地址段。<br>如果我们在创建容器时没有指定网络模型，默认就是(Nat)桥接网络，这也就是为什么我们在登录到一个容器后，发现IP地址段都在172.17.0.0/16网段的原因。</td>
</tr>
<tr>
<td>host  [开放式容器(Open container)]</td>
<td>–network  host</td>
<td>比联盟式网络更开放，我们知道联盟式网络是多个容器共享网络(Net),而开放式容器(Open contaner)就直接共享了宿主机的名称空间。因此物理网卡有多少个，那么该容器就能看到多少网卡信息。我们可以说Open container是联盟式容器的衍生。</td>
</tr>
<tr>
<td>none [封闭式网络(Closed container)]</td>
<td>–network   none</td>
<td>封闭式容器，只有本地回环接口(Loopback interface，和咱们服务器看到的lo接口类似)，无法与外界进行通信。</td>
</tr>
<tr>
<td>container [联盟式网络(Joined container A | Joined container B ]</td>
<td>–network   container:c1(容器名称或容器ID)</td>
<td>每个容器都各有一部分名称空间(Mount,PID,User)，另外一部分名称空间是共享的(UTS,Net,IPC)。<br>由于它们的网络是共享的，因此各个容器可以通过本地回环接口(Loopback interface)进行通信。<br>除了共享同一组本地回环接口(Loopback interface)外，还有一块一块私有接口(Private interface)通过联合容器虚拟接口(Joined container virtual interface)连接到桥接虚拟接口(Docker bridge virtual interface)，之后通过逻辑主机接口(Logical host interface)连接到主机物理网络(Physical network interface)。</td>
</tr>
</tbody></table>
<h1 id="四、Docker容器四种网络模型应用案例"><a href="#四、Docker容器四种网络模型应用案例" class="headerlink" title="四、Docker容器四种网络模型应用案例"></a>四、Docker容器四种网络模型应用案例</h1><h2 id="4-1-查看已有的网络模型"><a href="#4-1-查看已有的网络模型" class="headerlink" title="4.1 查看已有的网络模型"></a>4.1 查看已有的网络模型</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查看已有的网络模型</span><br><span class="line"><span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">a26c79961d8c   bridge    bridge    local</span><br><span class="line">d04ce0d0e6ca   host      host      local</span><br><span class="line">a369d8e58a41   none      null      local</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">查看已有网络模型详细信息</span><br><span class="line"><span class="comment"># docker network inspect bridge</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;a26c79961d8c3a5f66a7de782b773291e4902badc60d0614745e01b18f506907&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2022-02-08T11:45:25.607195911+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;172.17.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;dbac5dd601b960c91bee8fafcabc0a6e6091bff14d5fccfa80ca2c74df8891ad&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;web1&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;2c1d8c66f7f46d6d76e5c384b1729a90441e1398496b3112124ba65d255432a1&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;172.17.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.default_bridge&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.enable_icc&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.enable_ip_masquerade&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.host_binding_ipv4&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.name&quot;</span>: <span class="string">&quot;docker0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.driver.mtu&quot;</span>: <span class="string">&quot;1500&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看docker支持的网络模型</span><br><span class="line"><span class="comment"># docker info | grep Network</span></span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br></pre></td></tr></table></figure>





<h2 id="4-2-创建指定类型的网络模型"><a href="#4-2-创建指定类型的网络模型" class="headerlink" title="4.2 创建指定类型的网络模型"></a>4.2 创建指定类型的网络模型</h2><h3 id="4-2-1-bridge"><a href="#4-2-1-bridge" class="headerlink" title="4.2.1 bridge"></a>4.2.1 bridge</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看创建网络模型的帮助方法</span><br><span class="line"><span class="comment"># docker network create --help</span></span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建一个名称为mybr0的网络</span><br><span class="line"><span class="comment"># docker network create -d bridge --subnet &quot;192.168.100.0/24&quot; --gateway &quot;192.168.100.1&quot; -o com.docker.network.bridge.name=docker1 mybr0</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查看已创建网络</span><br><span class="line"><span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">......</span><br><span class="line">a6a1ad36c3c0   mybr0     bridge    local</span><br><span class="line">......</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在docker host主机上可以看到多了一个网桥docker1</span><br><span class="line"><span class="comment"># ifconfig</span></span><br><span class="line">docker1: flags=<span class="number">4099</span>&lt;UP,BROADCAST,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">192.168</span>.<span class="number">100.1</span>  netmask <span class="number">255.255</span>.<span class="number">255.0</span>  broadcast <span class="number">192.168</span>.<span class="number">100.255</span></span><br><span class="line">        ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">14</span>:aa:f5:<span class="number">04</span>  txqueuelen <span class="number">0</span>  (Ethernet)</span><br><span class="line">        RX packets <span class="number">0</span>  bytes <span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">20</span>  bytes <span class="number">1598</span> (<span class="number">1.5</span> KiB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">启动一个容器并连接到已创建mybr0网络</span><br><span class="line"><span class="comment"># docker run -it --network mybr0 --rm busybox</span></span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">02</span>:<span class="number">42</span>:C0:A8:<span class="number">65</span>:<span class="number">02</span></span><br><span class="line">          inet addr:<span class="number">192.168</span>.<span class="number">100.2</span>  Bcast:<span class="number">192.168</span>.<span class="number">100.255</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">18</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX bytes:<span class="number">2185</span> (<span class="number">2.1</span> KiB)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line">/ <span class="comment"># exit</span></span><br></pre></td></tr></table></figure>



<h3 id="4-2-2-host"><a href="#4-2-2-host" class="headerlink" title="4.2.2 host"></a>4.2.2 host</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查看host类型的网络模型</span><br><span class="line"><span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">......</span><br><span class="line">d04ce0d0e6ca   host      host      local</span><br><span class="line">......</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">查看host网络模型的详细信息</span><br><span class="line"><span class="comment"># docker network inspect host</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;host&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;d04ce0d0e6ca8e6226937f19033ef2c3f05b47ed63e06492d5c3071904fbb80b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2022-01-21T16:12:05.30970114+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;host&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>







<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">创建容器使用host网络模型，并查看其网络信息</span><br><span class="line"><span class="comment"># docker run -it --network host --rm busybox</span></span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">docker0   Link encap:Ethernet  HWaddr <span class="number">02</span>:<span class="number">42</span>:<span class="number">11</span>:B8:<span class="number">9</span>A:C5</span><br><span class="line">          inet addr:<span class="number">172.17</span>.<span class="number">0.1</span>  Bcast:<span class="number">172.17</span>.<span class="number">255.255</span>  Mask:<span class="number">255.255</span>.<span class="number">0.0</span></span><br><span class="line">          inet6 addr: fe80::<span class="number">42</span>:<span class="number">11</span>ff:feb8:<span class="number">9</span>ac5/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">53</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">94</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX bytes:<span class="number">6924</span> (<span class="number">6.7</span> KiB)  TX bytes:<span class="number">7868</span> (<span class="number">7.6</span> KiB)</span><br><span class="line"></span><br><span class="line">docker1   Link encap:Ethernet  HWaddr <span class="number">02</span>:<span class="number">42</span>:<span class="number">14</span>:AA:F5:<span class="number">04</span></span><br><span class="line">          inet addr:<span class="number">192.168</span>.<span class="number">100.1</span>  Bcast:<span class="number">192.168</span>.<span class="number">100.255</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          UP BROADCAST MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ens33     Link encap:Ethernet  HWaddr <span class="number">00</span>:<span class="number">0</span>C:<span class="number">29</span>:AF:<span class="number">89</span>:<span class="number">0</span>B</span><br><span class="line">          inet addr:<span class="number">192.168</span>.<span class="number">255.161</span>  Bcast:<span class="number">192.168</span>.<span class="number">255.255</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          inet6 addr: fe80::<span class="number">44</span><span class="built_in">fc</span>:<span class="number">2662</span>:bfab:<span class="number">2</span>b93/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">157763</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">50865</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">205504721</span> (<span class="number">195.9</span> MiB)  TX bytes:<span class="number">3626119</span> (<span class="number">3.4</span> MiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          inet6 addr: ::<span class="number">1</span>/<span class="number">128</span> Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">88</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">88</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">8196</span> (<span class="number">8.0</span> KiB)  TX bytes:<span class="number">8196</span> (<span class="number">8.0</span> KiB)</span><br><span class="line"></span><br><span class="line">virbr0    Link encap:Ethernet  HWaddr <span class="number">52</span>:<span class="number">54</span>:<span class="number">00</span>:EB:<span class="number">01</span>:E5</span><br><span class="line">          inet addr:<span class="number">192.168</span>.<span class="number">122.1</span>  Bcast:<span class="number">192.168</span>.<span class="number">122.255</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          UP BROADCAST MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line">/ <span class="comment"># exit</span></span><br></pre></td></tr></table></figure>



<p><strong>运行Nginx服务</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建用于运行nginx应用的容器，使用host网络模型</span><br><span class="line"><span class="comment"># docker run -d --network host nginx:latest</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看容器运行状态</span><br><span class="line"><span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">f6677b213271   nginx:latest   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   <span class="number">7</span> seconds ago   Up <span class="number">6</span> seconds             youthful_shtern</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看docker host <span class="number">80</span>端口状态</span><br><span class="line"><span class="comment"># ss -anput | grep &quot;:80&quot;</span></span><br><span class="line">tcp    LISTEN     <span class="number">0</span>      <span class="number">511</span>       *:<span class="number">80</span>                    *:*                   users:((<span class="string">&quot;nginx&quot;</span>,pid=<span class="number">42866</span>,fd=<span class="number">7</span>),(<span class="string">&quot;nginx&quot;</span>,pid=<span class="number">42826</span>,fd=<span class="number">7</span>))</span><br><span class="line">tcp    LISTEN     <span class="number">0</span>      <span class="number">511</span>      :::<span class="number">80</span>                   :::*                   users:((<span class="string">&quot;nginx&quot;</span>,pid=<span class="number">42866</span>,fd=<span class="number">8</span>),(<span class="string">&quot;nginx&quot;</span>,pid=<span class="number">42826</span>,fd=<span class="number">8</span>))</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">使用<span class="built_in">curl</span>命令访问docker host主机IP地址，验证是否可以对nginx进行访问，如可访问，则说明容器与docker host共享网络命名空间</span><br><span class="line"><span class="comment"># curl http://192.168.255.161</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color<span class="literal">-scheme</span>: light dark; &#125;</span><br><span class="line">body &#123; width: <span class="number">35</span>em; margin: <span class="number">0</span> auto;</span><br><span class="line">font<span class="literal">-family</span>: Tahoma, Verdana, Arial, sans<span class="literal">-serif</span>; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;<span class="keyword">If</span> you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;<span class="keyword">For</span> online documentation and support please refer to</span><br><span class="line">&lt;a href=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> <span class="keyword">using</span> nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<img src="/images/Docker/Docker容器网络与通信原理深度解析.assets/image-20220209152555577.png" alt="image-20220209152555577">





<h3 id="4-2-3-none"><a href="#4-2-3-none" class="headerlink" title="4.2.3 none"></a>4.2.3 none</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查看none类型的网络模型</span><br><span class="line"><span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">......</span><br><span class="line">a369d8e58a41   none      null      local</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">查看none网络模型详细信息</span><br><span class="line"><span class="comment"># docker network inspect none</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;a369d8e58a41ce2e3c25f2273b059e984dd561bfa7e79077a0cce9b3a925b9c9&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2022-01-21T16:12:05.217801814+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;null&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: <span class="type">null</span>,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: []</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="type">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">创建容器使用none网络模型，并查看其网络状态</span><br><span class="line"><span class="comment"># docker run -it --network none --rm busybox:latest</span></span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line">/ <span class="comment"># exit</span></span><br></pre></td></tr></table></figure>



<h3 id="4-2-4-联盟网络"><a href="#4-2-4-联盟网络" class="headerlink" title="4.2.4 联盟网络"></a>4.2.4 联盟网络</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">创建c1容器，使用默认网络模型</span><br><span class="line"><span class="comment"># docker run -it --name c1 --rm busybox:latest</span></span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">02</span>:<span class="number">42</span>:<span class="built_in">AC</span>:<span class="number">11</span>:<span class="number">00</span>:<span class="number">02</span></span><br><span class="line">          inet addr:<span class="number">172.17</span>.<span class="number">0.2</span>  Bcast:<span class="number">172.17</span>.<span class="number">255.255</span>  Mask:<span class="number">255.255</span>.<span class="number">0.0</span></span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">16</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX bytes:<span class="number">1916</span> (<span class="number">1.8</span> KiB)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看c1容器状态</span><br><span class="line"><span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE            COMMAND   CREATED          STATUS          PORTS     NAMES</span><br><span class="line"><span class="number">0905</span>bc8ebfb6   busybox:latest   <span class="string">&quot;sh&quot;</span>      <span class="number">13</span> seconds ago   Up <span class="number">11</span> seconds             c1</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">创建c2容器，与c1容器共享网络命名空间</span><br><span class="line"><span class="comment"># docker run -it --name c2 --network container:c1 --rm busybox:latest</span></span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">02</span>:<span class="number">42</span>:<span class="built_in">AC</span>:<span class="number">11</span>:<span class="number">00</span>:<span class="number">02</span></span><br><span class="line">          inet addr:<span class="number">172.17</span>.<span class="number">0.2</span>  Bcast:<span class="number">172.17</span>.<span class="number">255.255</span>  Mask:<span class="number">255.255</span>.<span class="number">0.0</span></span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">22</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX bytes:<span class="number">2574</span> (<span class="number">2.5</span> KiB)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在c2容器中创建文件并开启httpd服务</span><br><span class="line">/ <span class="comment"># echo &quot;hello world&quot; &gt;&gt; /tmp/index.html</span></span><br><span class="line">/ <span class="comment"># ls /tmp</span></span><br><span class="line">index.html</span><br><span class="line">/ <span class="comment"># httpd -h /tmp</span></span><br><span class="line"></span><br><span class="line">验证<span class="number">80</span>端口是否打开</span><br><span class="line">/ <span class="comment"># netstat -npl</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv<span class="literal">-Q</span> <span class="built_in">Send-Q</span> Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> :::<span class="number">80</span>                   :::*                    LISTEN      <span class="number">10</span>/httpd</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在c1容器中进行访问验证</span><br><span class="line"><span class="comment"># docker exec c1 wget -O - -q 127.0.0.1</span></span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看c1容器/tmp目录，发现没有在c2容器中创建的文件，说明c1与c2仅共享了网络命名空间，没有共享文件系统</span><br><span class="line"><span class="comment"># docker exec c1 ls /tmp</span></span><br></pre></td></tr></table></figure>







<h1 id="五、跨Docker-Host容器间通信实现"><a href="#五、跨Docker-Host容器间通信实现" class="headerlink" title="五、跨Docker Host容器间通信实现"></a>五、跨Docker Host容器间通信实现</h1><h2 id="5-1-跨Docker-Host容器间通信必要性"><a href="#5-1-跨Docker-Host容器间通信必要性" class="headerlink" title="5.1  跨Docker Host容器间通信必要性"></a>5.1  跨Docker Host容器间通信必要性</h2><ul>
<li>由于Docker容器运行的环境类似于在局域网中运行服务一样，无法直接被外界访问，如果采用在Docker Host利用端口映射方式会导致端口被严重消耗。</li>
<li>能够实现不同的Docker Host方便访问其它Docker Host之上的容器提供的服务</li>
</ul>
<h2 id="5-2-跨Docker-Host容器间通信实现方案"><a href="#5-2-跨Docker-Host容器间通信实现方案" class="headerlink" title="5.2 跨Docker Host容器间通信实现方案"></a>5.2 跨Docker Host容器间通信实现方案</h2><h3 id="5-2-1-Docker原生方案"><a href="#5-2-1-Docker原生方案" class="headerlink" title="5.2.1 Docker原生方案"></a>5.2.1 Docker原生方案</h3><ul>
<li>overlay<ul>
<li>基于VXLAN封装实现Docker原生overlay网络</li>
</ul>
</li>
<li>macvlan<ul>
<li>Docker主机网卡接口逻辑上分为多个子接口，每个子接口标识一个VLAN，容器接口直接连接Docker Host</li>
</ul>
</li>
<li>网卡接口<ul>
<li>通过路由策略转发到另一台Docker Host</li>
</ul>
</li>
</ul>
<h3 id="5-2-2-第三方方案"><a href="#5-2-2-第三方方案" class="headerlink" title="5.2.2 第三方方案"></a>5.2.2 第三方方案</h3><h4 id="5-2-2-1-隧道方案"><a href="#5-2-2-1-隧道方案" class="headerlink" title="5.2.2.1 隧道方案"></a>5.2.2.1 隧道方案</h4><ul>
<li>Flannel<ul>
<li>支持UDP和VLAN封装传输方式</li>
</ul>
</li>
<li>Weave<ul>
<li>支持UDP和VXLAN</li>
</ul>
</li>
<li>OpenvSwitch<ul>
<li>支持VXLAN和GRE协议</li>
</ul>
</li>
</ul>
<h4 id="5-2-2-2-路由方案"><a href="#5-2-2-2-路由方案" class="headerlink" title="5.2.2.2 路由方案"></a>5.2.2.2 路由方案</h4><ul>
<li>Calico<ul>
<li>支持BGP协议和IPIP隧道</li>
<li>每台宿主机作为虚拟路由，通过BGP协议实现不同主机容器间通信。</li>
</ul>
</li>
</ul>
<h2 id="5-3-Flannel"><a href="#5-3-Flannel" class="headerlink" title="5.3 Flannel"></a>5.3 Flannel</h2><h3 id="5-3-1-overlay-network介绍"><a href="#5-3-1-overlay-network介绍" class="headerlink" title="5.3.1 overlay network介绍"></a>5.3.1 overlay network介绍</h3><p>Overlay网络是指在不改变现有网络基础设施的前提下，通过某种约定通信协议，把二层报文封装在IP报文之上的新的数据格式。这样不但能够充分利用成熟的IP路由协议进程数据分发；而且在Overlay技术中采用扩展的隔离标识位数，能够突破VLAN的4000数量限制支持高达16M的用户，并在必要时可将广播流量转化为组播流量，避免广播数据泛滥。</p>
<p>　　因此，Overlay网络实际上是目前最主流的容器跨节点数据传输和路由方案。</p>
<h3 id="5-3-2-Flannel介绍"><a href="#5-3-2-Flannel介绍" class="headerlink" title="5.3.2 Flannel介绍"></a>5.3.2 Flannel介绍</h3><p>Flannel是 CoreOS 团队针对 Kubernetes 设计的一个覆盖网络（Overlay Network）工具，其目的在于帮助每一个使用 Kuberentes 的 CoreOS 主机拥有一个完整的子网。 Flannel通过给每台宿主机分配一个子网的方式为容器提供虚拟网络，它基于Linux TUN/TAP，使用UDP封装IP包来创建overlay网络，并借助etcd维护网络的分配情况。 Flannel is a simple and easy way to configure a layer 3 network fabric designed for Kubernetes.</p>
<h3 id="5-3-3-Flannel工作原理"><a href="#5-3-3-Flannel工作原理" class="headerlink" title="5.3.3 Flannel工作原理"></a>5.3.3 Flannel工作原理</h3><p>Flannel是CoreOS团队针对Kubernetes设计的一个网络规划服务，简单来说，它的功能是让集群中的不同节点主机创建的Docker容器都具有全集群唯一的虚拟IP地址。但在默认的Docker配置中，每个Node的Docker服务会分别负责所在节点容器的IP分配。Node内部的容器之间可以相互访问,但是跨主机(Node)网络相互间是不能通信。Flannel设计目的就是为集群中所有节点重新规划IP地址的使用规则，从而使得不同节点上的容器能够获得”同属一个内网”且”不重复的”IP地址，并让属于不同节点上的容器能够直接通过内网IP通信。 Flannel 使用etcd存储配置数据和子网分配信息。flannel 启动之后，后台进程首先检索配置和正在使用的子网列表，然后选择一个可用的子网，然后尝试去注册它。etcd也存储这个每个主机对应的ip。flannel 使用etcd的watch机制监视<code>/coreos.com/network/subnets</code>下面所有元素的变化信息，并且根据它来维护一个路由表。为了提高性能，flannel优化了Universal TAP/TUN设备，对TUN和UDP之间的ip分片做了代理。 如下原理图：</p>
<p><img src="/images/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90.assets/image-20220209230459054.png" alt="image-20220209230459054"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、数据从源容器中发出后，经由所在主机的docker0虚拟网卡转发到flannel0虚拟网卡，这是个P2P的虚拟网卡，flanneld服务监听在网卡的另外一端。</span><br><span class="line">2、Flannel通过Etcd服务维护了一张节点间的路由表，该张表里保存了各个节点主机的子网网段信息。</span><br><span class="line">3、源主机的flanneld服务将原本的数据内容UDP封装后根据自己的路由表投递给目的节点的flanneld服务，数据到达以后被解包，然后直接进入目的节点的flannel0虚拟网卡，然后被转发到目的主机的docker0虚拟网卡，最后就像本机容器通信一样的由docker0路由到达目标容器。</span><br></pre></td></tr></table></figure>





<h2 id="5-4-ETCD"><a href="#5-4-ETCD" class="headerlink" title="5.4 ETCD"></a>5.4 ETCD</h2><p>etcd是CoreOS团队于2013年6月发起的开源项目，它的目标是构建一个高可用的分布式键值(key-value)数据库。etcd内部采用<code>raft</code>协议作为一致性算法，etcd基于Go语言实现。</p>
<p>etcd作为服务发现系统，特点：</p>
<ul>
<li>简单：安装配置简单，而且提供了HTTP API进行交互，使用也很简单</li>
<li>安全：支持SSL证书验证</li>
<li>快速：根据官方提供的benchmark数据，单实例支持每秒2k+读操作</li>
<li>可靠：采用raft算法，实现分布式系统数据的可用性和一致性</li>
</ul>
<h2 id="5-5-ETCD部署"><a href="#5-5-ETCD部署" class="headerlink" title="5.5 ETCD部署"></a>5.5 ETCD部署</h2><blockquote>
<p>主机防火墙及SELINUX均关闭。</p>
</blockquote>
<h3 id="5-5-1-主机名称配置"><a href="#5-5-1-主机名称配置" class="headerlink" title="5.5.1  主机名称配置"></a>5.5.1  主机名称配置</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hostnamectl set-hostname node1</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hostnamectl set-hostname node2</span></span><br></pre></td></tr></table></figure>





<h3 id="5-5-2-主机IP地址配置"><a href="#5-5-2-主机IP地址配置" class="headerlink" title="5.5.2 主机IP地址配置"></a>5.5.2 主机IP地址配置</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line"><span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line"><span class="built_in">TYPE</span>=<span class="string">&quot;Ethernet&quot;</span></span><br><span class="line">PROXY_METHOD=<span class="string">&quot;none&quot;</span></span><br><span class="line">BROWSER_ONLY=<span class="string">&quot;no&quot;</span></span><br><span class="line">BOOTPROTO=<span class="string">&quot;none&quot;</span></span><br><span class="line">DEFROUTE=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV4_FAILURE_FATAL=<span class="string">&quot;no&quot;</span></span><br><span class="line">IPV6INIT=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_AUTOCONF=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_DEFROUTE=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_FAILURE_FATAL=<span class="string">&quot;no&quot;</span></span><br><span class="line">IPV6_ADDR_GEN_MODE=<span class="string">&quot;stable-privacy&quot;</span></span><br><span class="line">NAME=<span class="string">&quot;ens33&quot;</span></span><br><span class="line">UUID=<span class="string">&quot;6c020cf7-4c6e-4276-9aa6-0661670da705&quot;</span></span><br><span class="line">DEVICE=<span class="string">&quot;ens33&quot;</span></span><br><span class="line">ONBOOT=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPADDR=<span class="string">&quot;192.168.255.154&quot;</span></span><br><span class="line">PREFIX=<span class="string">&quot;24&quot;</span></span><br><span class="line">GATEWAY=<span class="string">&quot;192.168.255.2&quot;</span></span><br><span class="line">DNS1=<span class="string">&quot;119.29.29.29&quot;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line"><span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span></span><br><span class="line"><span class="built_in">TYPE</span>=<span class="string">&quot;Ethernet&quot;</span></span><br><span class="line">PROXY_METHOD=<span class="string">&quot;none&quot;</span></span><br><span class="line">BROWSER_ONLY=<span class="string">&quot;no&quot;</span></span><br><span class="line">BOOTPROTO=<span class="string">&quot;none&quot;</span></span><br><span class="line">DEFROUTE=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV4_FAILURE_FATAL=<span class="string">&quot;no&quot;</span></span><br><span class="line">IPV6INIT=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_AUTOCONF=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_DEFROUTE=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_FAILURE_FATAL=<span class="string">&quot;no&quot;</span></span><br><span class="line">IPV6_ADDR_GEN_MODE=<span class="string">&quot;stable-privacy&quot;</span></span><br><span class="line">NAME=<span class="string">&quot;ens33&quot;</span></span><br><span class="line">UUID=<span class="string">&quot;6c020cf7-4c6e-4276-9aa6-0661670da705&quot;</span></span><br><span class="line">DEVICE=<span class="string">&quot;ens33&quot;</span></span><br><span class="line">ONBOOT=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPADDR=<span class="string">&quot;192.168.255.155&quot;</span></span><br><span class="line">PREFIX=<span class="string">&quot;24&quot;</span></span><br><span class="line">GATEWAY=<span class="string">&quot;192.168.255.2&quot;</span></span><br><span class="line">DNS1=<span class="string">&quot;119.29.29.29&quot;</span></span><br></pre></td></tr></table></figure>





<h3 id="5-5-3-主机名与IP地址解析"><a href="#5-5-3-主机名与IP地址解析" class="headerlink" title="5.5.3 主机名与IP地址解析"></a>5.5.3 主机名与IP地址解析</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/hosts</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># cat /etc/hosts</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"><span class="number">192.168</span>.<span class="number">255.154</span> node1</span><br><span class="line"><span class="number">192.168</span>.<span class="number">255.155</span> node2</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/hosts</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># cat /etc/hosts</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"><span class="number">192.168</span>.<span class="number">255.154</span> node1</span><br><span class="line"><span class="number">192.168</span>.<span class="number">255.155</span> node2</span><br></pre></td></tr></table></figure>



<h3 id="5-5-4-开启内核转发"><a href="#5-5-4-开启内核转发" class="headerlink" title="5.5.4 开启内核转发"></a>5.5.4 开启内核转发</h3><blockquote>
<p>所有Docker Host</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># cat /etc/sysctl.conf</span></span><br><span class="line">......</span><br><span class="line">net.ipv4.ip_forward=<span class="number">1</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -p</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># cat /etc/sysctl.conf</span></span><br><span class="line">......</span><br><span class="line">net.ipv4.ip_forward=<span class="number">1</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -p</span></span><br></pre></td></tr></table></figure>





<h3 id="5-5-5-etcd安装"><a href="#5-5-5-etcd安装" class="headerlink" title="5.5.5 etcd安装"></a>5.5.5 etcd安装</h3><blockquote>
<p>etcd集群</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># yum -y install etcd</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># yum -y install etcd</span></span><br></pre></td></tr></table></figure>



<h3 id="5-5-6-etcd配置"><a href="#5-5-6-etcd配置" class="headerlink" title="5.5.6 etcd配置"></a>5.5.6 etcd配置</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/etcd/etcd.conf</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># cat /etc/etcd/etcd.conf</span></span><br><span class="line"><span class="comment">#[Member]</span></span><br><span class="line"><span class="comment">#ETCD_CORS=&quot;&quot;</span></span><br><span class="line">ETCD_DATA_DIR=<span class="string">&quot;/var/lib/etcd/node1.etcd&quot;</span></span><br><span class="line"><span class="comment">#ETCD_WAL_DIR=&quot;&quot;</span></span><br><span class="line">ETCD_LISTEN_PEER_URLS=<span class="string">&quot;http://0.0.0.0:2380&quot;</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">&quot;http://0.0.0.0:2379,http://0.0.0.0:4001&quot;</span></span><br><span class="line"><span class="comment">#ETCD_MAX_SNAPSHOTS=&quot;5&quot;</span></span><br><span class="line"><span class="comment">#ETCD_MAX_WALS=&quot;5&quot;</span></span><br><span class="line">ETCD_NAME=<span class="string">&quot;node1&quot;</span></span><br><span class="line"><span class="comment">#ETCD_SNAPSHOT_COUNT=&quot;100000&quot;</span></span><br><span class="line"><span class="comment">#ETCD_HEARTBEAT_INTERVAL=&quot;100&quot;</span></span><br><span class="line"><span class="comment">#ETCD_ELECTION_TIMEOUT=&quot;1000&quot;</span></span><br><span class="line"><span class="comment">#ETCD_QUOTA_BACKEND_BYTES=&quot;0&quot;</span></span><br><span class="line"><span class="comment">#ETCD_MAX_REQUEST_BYTES=&quot;1572864&quot;</span></span><br><span class="line"><span class="comment">#ETCD_GRPC_KEEPALIVE_MIN_TIME=&quot;5s&quot;</span></span><br><span class="line"><span class="comment">#ETCD_GRPC_KEEPALIVE_INTERVAL=&quot;2h0m0s&quot;</span></span><br><span class="line"><span class="comment">#ETCD_GRPC_KEEPALIVE_TIMEOUT=&quot;20s&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#[Clustering]</span></span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="string">&quot;http://192.168.255.154:2380&quot;</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">&quot;http://192.168.255.154:2379,http://192.168.255.155:4001&quot;</span></span><br><span class="line"><span class="comment">#ETCD_DISCOVERY=&quot;&quot;</span></span><br><span class="line"><span class="comment">#ETCD_DISCOVERY_FALLBACK=&quot;proxy&quot;</span></span><br><span class="line"><span class="comment">#ETCD_DISCOVERY_PROXY=&quot;&quot;</span></span><br><span class="line"><span class="comment">#ETCD_DISCOVERY_SRV=&quot;&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER=<span class="string">&quot;node1=http://192.168.255.154:2380,node2=http://192.168.255.155:2380&quot;</span></span><br><span class="line"><span class="comment">#ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span></span><br><span class="line"><span class="comment">#ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span></span><br><span class="line"><span class="comment">#ETCD_STRICT_RECONFIG_CHECK=&quot;true&quot;</span></span><br><span class="line"><span class="comment">#ETCD_ENABLE_V2=&quot;true&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#[Proxy]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/etcd/etcd.conf</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># cat /etc/etcd/etcd.conf</span></span><br><span class="line"><span class="comment">#[Member]</span></span><br><span class="line"><span class="comment">#ETCD_CORS=&quot;&quot;</span></span><br><span class="line">ETCD_DATA_DIR=<span class="string">&quot;/var/lib/etcd/node2.etcd&quot;</span></span><br><span class="line"><span class="comment">#ETCD_WAL_DIR=&quot;&quot;</span></span><br><span class="line">ETCD_LISTEN_PEER_URLS=<span class="string">&quot;http://0.0.0.0:2380&quot;</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">&quot;http://0.0.0.0:2379,http://0.0.0.0:4001&quot;</span></span><br><span class="line"><span class="comment">#ETCD_MAX_SNAPSHOTS=&quot;5&quot;</span></span><br><span class="line"><span class="comment">#ETCD_MAX_WALS=&quot;5&quot;</span></span><br><span class="line">ETCD_NAME=<span class="string">&quot;node2&quot;</span></span><br><span class="line"><span class="comment">#ETCD_SNAPSHOT_COUNT=&quot;100000&quot;</span></span><br><span class="line"><span class="comment">#ETCD_HEARTBEAT_INTERVAL=&quot;100&quot;</span></span><br><span class="line"><span class="comment">#ETCD_ELECTION_TIMEOUT=&quot;1000&quot;</span></span><br><span class="line"><span class="comment">#ETCD_QUOTA_BACKEND_BYTES=&quot;0&quot;</span></span><br><span class="line"><span class="comment">#ETCD_MAX_REQUEST_BYTES=&quot;1572864&quot;</span></span><br><span class="line"><span class="comment">#ETCD_GRPC_KEEPALIVE_MIN_TIME=&quot;5s&quot;</span></span><br><span class="line"><span class="comment">#ETCD_GRPC_KEEPALIVE_INTERVAL=&quot;2h0m0s&quot;</span></span><br><span class="line"><span class="comment">#ETCD_GRPC_KEEPALIVE_TIMEOUT=&quot;20s&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#[Clustering]</span></span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="string">&quot;http://192.168.255.155:2380&quot;</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">&quot;http://192.168.255.155:2379,http://192.168.255.155:4001&quot;</span></span><br><span class="line"><span class="comment">#ETCD_DISCOVERY=&quot;&quot;</span></span><br><span class="line"><span class="comment">#ETCD_DISCOVERY_FALLBACK=&quot;proxy&quot;</span></span><br><span class="line"><span class="comment">#ETCD_DISCOVERY_PROXY=&quot;&quot;</span></span><br><span class="line"><span class="comment">#ETCD_DISCOVERY_SRV=&quot;&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER=<span class="string">&quot;node1=http://192.168.255.154:2380,node2=http://192.168.255.155:2380&quot;</span></span><br><span class="line"><span class="comment">#ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span></span><br><span class="line"><span class="comment">#ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span></span><br><span class="line"><span class="comment">#ETCD_STRICT_RECONFIG_CHECK=&quot;true&quot;</span></span><br><span class="line"><span class="comment">#ETCD_ENABLE_V2=&quot;true&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#[Proxy]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-5-7-启动etcd服务"><a href="#5-5-7-启动etcd服务" class="headerlink" title="5.5.7 启动etcd服务"></a>5.5.7 启动etcd服务</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># systemctl enable etcd</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># systemctl start etcd</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># systemctl enable etcd</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># systemctl start etcd</span></span><br></pre></td></tr></table></figure>





<h3 id="5-5-8-检查端口状态"><a href="#5-5-8-检查端口状态" class="headerlink" title="5.5.8 检查端口状态"></a>5.5.8 检查端口状态</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># netstat -tnlp | grep -E  &quot;4001|2380&quot;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输出结果：</span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">2380</span>                 :::*                    LISTEN      <span class="number">65318</span>/etcd</span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">4001</span>                 :::*                    LISTEN      <span class="number">65318</span>/etcd</span><br></pre></td></tr></table></figure>



<h3 id="5-5-9-检查etcd集群是否健康"><a href="#5-5-9-检查etcd集群是否健康" class="headerlink" title="5.5.9 检查etcd集群是否健康"></a>5.5.9 检查etcd集群是否健康</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># etcdctl -C http://192.168.255.154:2379 cluster-health</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输出：</span><br><span class="line">member <span class="number">5</span>be09658727c5574 is healthy: got healthy result from http://<span class="number">192.168</span>.<span class="number">255.154</span>:<span class="number">2379</span></span><br><span class="line">member c48e6c7a65e5ca43 is healthy: got healthy result from http://<span class="number">192.168</span>.<span class="number">255.155</span>:<span class="number">2379</span></span><br><span class="line">cluster is healthy</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># etcdctl member list</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输出：</span><br><span class="line"><span class="number">5</span>be09658727c5574: name=node1 peerURLs=http://<span class="number">192.168</span>.<span class="number">255.154</span>:<span class="number">2380</span> clientURLs=http://<span class="number">192.168</span>.<span class="number">255.154</span>:<span class="number">2379</span>,http://<span class="number">192.168</span>.<span class="number">255.155</span>:<span class="number">4001</span> isLeader=true</span><br><span class="line">c48e6c7a65e5ca43: name=node2 peerURLs=http://<span class="number">192.168</span>.<span class="number">255.155</span>:<span class="number">2380</span> clientURLs=http://<span class="number">192.168</span>.<span class="number">255.155</span>:<span class="number">2379</span>,http://<span class="number">192.168</span>.<span class="number">255.155</span>:<span class="number">4001</span> isLeader=false</span><br></pre></td></tr></table></figure>





<h2 id="5-6-Flannel部署"><a href="#5-6-Flannel部署" class="headerlink" title="5.6 Flannel部署"></a>5.6 Flannel部署</h2><h3 id="5-6-1-Flannel安装"><a href="#5-6-1-Flannel安装" class="headerlink" title="5.6.1 Flannel安装"></a>5.6.1 Flannel安装</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># yum -y install flannel</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># yum -y install flannel</span></span><br></pre></td></tr></table></figure>



<h3 id="5-6-2-修改Flannel配置文件"><a href="#5-6-2-修改Flannel配置文件" class="headerlink" title="5.6.2 修改Flannel配置文件"></a>5.6.2 修改Flannel配置文件</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># vim /etc/sysconfig/flanneld</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># cat /etc/sysconfig/flanneld</span></span><br><span class="line"><span class="comment"># Flanneld configuration options</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># etcd url location.  Point this to the server where etcd runs</span></span><br><span class="line">FLANNEL_ETCD_ENDPOINTS=<span class="string">&quot;http://192.168.255.154:2379,http://192.168.255.155:2379&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># etcd config key.  This is the configuration key that flannel queries</span></span><br><span class="line"><span class="comment"># For address range assignment</span></span><br><span class="line">FLANNEL_ETCD_PREFIX=<span class="string">&quot;/atomic.io/network&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Any additional options that you want to pass</span></span><br><span class="line"><span class="comment">#FLANNEL_OPTIONS=&quot;&quot;</span></span><br><span class="line">FLANNEL_OPTIONS=<span class="string">&quot;--logtostderr=false --log_dir=/var/log/ --etcd endpoints=http://192.168.255.154:2379,http://192.168.255.155:2379 --iface=ens33&quot;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># vim /etc/sysconfig/flanneld</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># cat /etc/sysconfig/flanneld</span></span><br><span class="line"><span class="comment"># Flanneld configuration options</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># etcd url location.  Point this to the server where etcd runs</span></span><br><span class="line">FLANNEL_ETCD_ENDPOINTS=<span class="string">&quot;http://192.168.255.154:2379,http://192.168.255.155:2379&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># etcd config key.  This is the configuration key that flannel queries</span></span><br><span class="line"><span class="comment"># For address range assignment</span></span><br><span class="line">FLANNEL_ETCD_PREFIX=<span class="string">&quot;/atomic.io/network&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Any additional options that you want to pass</span></span><br><span class="line"><span class="comment">#FLANNEL_OPTIONS=&quot;&quot;</span></span><br><span class="line">FLANNEL_OPTIONS=<span class="string">&quot;--logtostderr=false --log_dir=/var/log/ --etcd-endpoints=http://192.168.255.154:2379,http://192.168.255.155:2379 --iface=ens33&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="5-6-3-配置etcd中关于flannel的key"><a href="#5-6-3-配置etcd中关于flannel的key" class="headerlink" title="5.6.3 配置etcd中关于flannel的key"></a>5.6.3 配置etcd中关于flannel的key</h3><p>Flannel使用Etcd进行配置，来保证多个Flannel实例之间的配置一致性，所以需要在etcd上进行如下配置（**’/<a href="https://link.zhihu.com/?target=http://atomic.io/network/config">http://atomic.io/network/config</a>**’这个key与上面的/etc/sysconfig/flannel中的配置项FLANNEL_ETCD_PREFIX是相对应的，错误的话启动就会出错）</p>
<blockquote>
<p>该ip网段可以任意设定，随便设定一个网段都可以。容器的ip就是根据这个网段进行自动分配的，ip分配后，容器一般是可以对外联网的（网桥模式，只要Docker Host能上网即可。）</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># etcdctl mk /atomic.io/network/config &#x27;&#123;&quot;Network&quot;:&quot;172.21.0.0/16&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;Network&quot;</span>:<span class="string">&quot;172.21.0.0/16&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># etcdctl set /atomic.io/network/config &#x27;&#123;&quot;Network&quot;:&quot;172.21.0.0/16&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;Network&quot;</span>:<span class="string">&quot;172.21.0.0/16&quot;</span>&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># etcdctl get /atomic.io/network/config</span></span><br><span class="line">&#123;<span class="string">&quot;Network&quot;</span>:<span class="string">&quot;172.21.0.0/16&quot;</span>&#125;</span><br></pre></td></tr></table></figure>





<h3 id="5-6-4-启动Flannel服务"><a href="#5-6-4-启动Flannel服务" class="headerlink" title="5.6.4 启动Flannel服务"></a>5.6.4 启动Flannel服务</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># systemctl enable flanneld;systemctl start flanneld</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># systemctl enable flanneld;systemctl start flanneld</span></span><br></pre></td></tr></table></figure>



<h3 id="5-6-5-查看各node中flannel产生的配置信息"><a href="#5-6-5-查看各node中flannel产生的配置信息" class="headerlink" title="5.6.5 查看各node中flannel产生的配置信息"></a>5.6.5 查看各node中flannel产生的配置信息</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># ls /run/flannel/</span></span><br><span class="line">docker  subnet.env</span><br><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># cat /run/flannel/subnet.env</span></span><br><span class="line">FLANNEL_NETWORK=<span class="number">172.21</span>.<span class="number">0.0</span>/<span class="number">16</span></span><br><span class="line">FLANNEL_SUBNET=<span class="number">172.21</span>.<span class="number">31.1</span>/<span class="number">24</span></span><br><span class="line">FLANNEL_MTU=<span class="number">1472</span></span><br><span class="line">FLANNEL_IPMASQ=false</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># ip a s</span></span><br><span class="line">......</span><br><span class="line"><span class="number">5</span>: docker0: &lt;NO<span class="literal">-CARRIER</span>,BROADCAST,MULTICAST,UP&gt; mtu <span class="number">1500</span> qdisc noqueue state DOWN <span class="built_in">group</span> default</span><br><span class="line">    link/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">63</span>:d1:<span class="number">9</span>e:<span class="number">0</span>b brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">172.17</span>.<span class="number">0.1</span>/<span class="number">16</span> brd <span class="number">172.17</span>.<span class="number">255.255</span> scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="number">6</span>: flannel0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu <span class="number">1472</span> qdisc pfifo_fast state UNKNOWN <span class="built_in">group</span> default qlen <span class="number">500</span></span><br><span class="line">    link/none</span><br><span class="line">    inet <span class="number">172.21</span>.<span class="number">31.0</span>/<span class="number">16</span> scope global flannel0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::edfa:d8b0:<span class="number">3351</span>:<span class="number">4126</span>/<span class="number">64</span> scope link flags <span class="number">800</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># ls /run/flannel/</span></span><br><span class="line">docker  subnet.env</span><br><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># cat /run/flannel/subnet.env</span></span><br><span class="line">FLANNEL_NETWORK=<span class="number">172.21</span>.<span class="number">0.0</span>/<span class="number">16</span></span><br><span class="line">FLANNEL_SUBNET=<span class="number">172.21</span>.<span class="number">55.1</span>/<span class="number">24</span></span><br><span class="line">FLANNEL_MTU=<span class="number">1472</span></span><br><span class="line">FLANNEL_IPMASQ=false</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># ip a s</span></span><br><span class="line">......</span><br><span class="line"><span class="number">5</span>: docker0: &lt;NO<span class="literal">-CARRIER</span>,BROADCAST,MULTICAST,UP&gt; mtu <span class="number">1500</span> qdisc noqueue state DOWN <span class="built_in">group</span> default</span><br><span class="line">    link/ether <span class="number">02</span>:<span class="number">42</span>:e1:<span class="number">16</span>:<span class="number">68</span>:de brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">172.17</span>.<span class="number">0.1</span>/<span class="number">16</span> brd <span class="number">172.17</span>.<span class="number">255.255</span> scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="number">6</span>: flannel0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu <span class="number">1472</span> qdisc pfifo_fast state UNKNOWN <span class="built_in">group</span> default qlen <span class="number">500</span></span><br><span class="line">    link/none</span><br><span class="line">    inet <span class="number">172.21</span>.<span class="number">55.0</span>/<span class="number">16</span> scope global flannel0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::f895:<span class="number">9</span>b5a:<span class="number">92</span>b1:<span class="number">78</span>aa/<span class="number">64</span> scope link flags <span class="number">800</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>







<h2 id="5-7-Docker网络配置"><a href="#5-7-Docker网络配置" class="headerlink" title="5.7 Docker网络配置"></a>5.7 Docker网络配置</h2><blockquote>
<p>–bip=172.21.31.1/24 –ip-masq=true –mtu=1472 放置于启动程序后</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># vim /usr/lib/systemd/system/docker.service</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># cat /usr/lib/systemd/system/docker.service</span></span><br><span class="line">[<span class="type">Unit</span>]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network<span class="literal">-online</span>.target firewalld.service containerd.service</span><br><span class="line">Wants=network<span class="literal">-online</span>.target</span><br><span class="line">Requires=docker.socket containerd.service</span><br><span class="line"></span><br><span class="line">[<span class="type">Service</span>]</span><br><span class="line"><span class="built_in">Type</span>=notify</span><br><span class="line"><span class="comment"># the default is not to use systemd for cgroups because the delegate issues still</span></span><br><span class="line"><span class="comment"># exists and systemd currently does not support the cgroup feature set required</span></span><br><span class="line"><span class="comment"># for containers run by docker</span></span><br><span class="line">ExecStart=/usr/bin/dockerd <span class="literal">-H</span> fd:// -<span class="literal">-containerd</span>=/run/containerd/containerd.sock -<span class="literal">-bip</span>=<span class="number">172.21</span>.<span class="number">31.1</span>/<span class="number">24</span> -<span class="literal">-ip</span><span class="literal">-masq</span>=true -<span class="literal">-mtu</span>=<span class="number">1472</span></span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> <span class="literal">-s</span> HUP <span class="variable">$MAINPID</span></span><br><span class="line">TimeoutSec=<span class="number">0</span></span><br><span class="line">RestartSec=<span class="number">2</span></span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd 229.</span></span><br><span class="line"><span class="comment"># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span></span><br><span class="line"><span class="comment"># to make them work for either version of systemd.</span></span><br><span class="line">StartLimitBurst=<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span></span><br><span class="line"><span class="comment"># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span></span><br><span class="line"><span class="comment"># this option work for either version of systemd.</span></span><br><span class="line">StartLimitInterval=<span class="number">60</span>s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span><br><span class="line"><span class="comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"></span><br><span class="line"><span class="comment"># Comment TasksMax if your systemd version does not support it.</span></span><br><span class="line"><span class="comment"># Only systemd 226 and above support this option.</span></span><br><span class="line">TasksMax=infinity</span><br><span class="line"></span><br><span class="line"><span class="comment"># set delegate yes so that systemd does not reset the cgroups of docker containers</span></span><br><span class="line">Delegate=yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># kill only the docker process, not all processes in the cgroup</span></span><br><span class="line">KillMode=<span class="keyword">process</span></span><br><span class="line">OOMScoreAdjust=<span class="literal">-500</span></span><br><span class="line"></span><br><span class="line">[<span class="type">Install</span>]</span><br><span class="line">WantedBy=multi<span class="literal">-user</span>.target</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># vim /usr/lib/systemd/system/docker.service</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># cat /usr/lib/systemd/system/docker.service</span></span><br><span class="line">[<span class="type">Unit</span>]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network<span class="literal">-online</span>.target firewalld.service containerd.service</span><br><span class="line">Wants=network<span class="literal">-online</span>.target</span><br><span class="line">Requires=docker.socket containerd.service</span><br><span class="line"></span><br><span class="line">[<span class="type">Service</span>]</span><br><span class="line"><span class="built_in">Type</span>=notify</span><br><span class="line"><span class="comment"># the default is not to use systemd for cgroups because the delegate issues still</span></span><br><span class="line"><span class="comment"># exists and systemd currently does not support the cgroup feature set required</span></span><br><span class="line"><span class="comment"># for containers run by docker</span></span><br><span class="line">ExecStart=/usr/bin/dockerd <span class="literal">-H</span> fd:// -<span class="literal">-containerd</span>=/run/containerd/containerd.sock -<span class="literal">-bip</span>=<span class="number">172.21</span>.<span class="number">55.1</span>/<span class="number">24</span> -<span class="literal">-ip</span><span class="literal">-masq</span>=true -<span class="literal">-mtu</span>=<span class="number">1472</span></span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> <span class="literal">-s</span> HUP <span class="variable">$MAINPID</span></span><br><span class="line">TimeoutSec=<span class="number">0</span></span><br><span class="line">RestartSec=<span class="number">2</span></span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd 229.</span></span><br><span class="line"><span class="comment"># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span></span><br><span class="line"><span class="comment"># to make them work for either version of systemd.</span></span><br><span class="line">StartLimitBurst=<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span></span><br><span class="line"><span class="comment"># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span></span><br><span class="line"><span class="comment"># this option work for either version of systemd.</span></span><br><span class="line">StartLimitInterval=<span class="number">60</span>s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span><br><span class="line"><span class="comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"></span><br><span class="line"><span class="comment"># Comment TasksMax if your systemd version does not support it.</span></span><br><span class="line"><span class="comment"># Only systemd 226 and above support this option.</span></span><br><span class="line">TasksMax=infinity</span><br><span class="line"></span><br><span class="line"><span class="comment"># set delegate yes so that systemd does not reset the cgroups of docker containers</span></span><br><span class="line">Delegate=yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># kill only the docker process, not all processes in the cgroup</span></span><br><span class="line">KillMode=<span class="keyword">process</span></span><br><span class="line">OOMScoreAdjust=<span class="literal">-500</span></span><br><span class="line"></span><br><span class="line">[<span class="type">Install</span>]</span><br><span class="line">WantedBy=multi<span class="literal">-user</span>.target</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># systemctl daemon-reload</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># systemctl restart docker</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># ip a s</span></span><br><span class="line">......</span><br><span class="line"><span class="number">5</span>: docker0: &lt;NO<span class="literal">-CARRIER</span>,BROADCAST,MULTICAST,UP&gt; mtu <span class="number">1500</span> qdisc noqueue state DOWN <span class="built_in">group</span> default</span><br><span class="line">    link/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">63</span>:d1:<span class="number">9</span>e:<span class="number">0</span>b brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">172.21</span>.<span class="number">31.1</span>/<span class="number">24</span> brd <span class="number">172.21</span>.<span class="number">31.255</span> scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="number">6</span>: flannel0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu <span class="number">1472</span> qdisc pfifo_fast state UNKNOWN <span class="built_in">group</span> default qlen <span class="number">500</span></span><br><span class="line">    link/none</span><br><span class="line">    inet <span class="number">172.21</span>.<span class="number">31.0</span>/<span class="number">16</span> scope global flannel0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::edfa:d8b0:<span class="number">3351</span>:<span class="number">4126</span>/<span class="number">64</span> scope link flags <span class="number">800</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># systemctl daemon-reload</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># systemctl restart docker</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># ip a s</span></span><br><span class="line">......</span><br><span class="line"><span class="number">5</span>: docker0: &lt;NO<span class="literal">-CARRIER</span>,BROADCAST,MULTICAST,UP&gt; mtu <span class="number">1500</span> qdisc noqueue state DOWN <span class="built_in">group</span> default</span><br><span class="line">    link/ether <span class="number">02</span>:<span class="number">42</span>:e1:<span class="number">16</span>:<span class="number">68</span>:de brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet <span class="number">172.21</span>.<span class="number">55.1</span>/<span class="number">24</span> brd <span class="number">172.21</span>.<span class="number">55.255</span> scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="number">6</span>: flannel0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu <span class="number">1472</span> qdisc pfifo_fast state UNKNOWN <span class="built_in">group</span> default qlen <span class="number">500</span></span><br><span class="line">    link/none</span><br><span class="line">    inet <span class="number">172.21</span>.<span class="number">55.0</span>/<span class="number">16</span> scope global flannel0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::f895:<span class="number">9</span>b5a:<span class="number">92</span>b1:<span class="number">78</span>aa/<span class="number">64</span> scope link flags <span class="number">800</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>





<h2 id="5-8-跨Docker-Host容器间通信验证"><a href="#5-8-跨Docker-Host容器间通信验证" class="headerlink" title="5.8 跨Docker Host容器间通信验证"></a>5.8 跨Docker Host容器间通信验证</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node1</span> ~]<span class="comment"># docker run -it --rm busybox:latest</span></span><br><span class="line"></span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">02</span>:<span class="number">42</span>:<span class="built_in">AC</span>:<span class="number">15</span>:<span class="number">1</span>F:<span class="number">02</span></span><br><span class="line">          inet addr:<span class="number">172.21</span>.<span class="number">31.2</span>  Bcast:<span class="number">172.21</span>.<span class="number">31.255</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1472</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">21</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX bytes:<span class="number">2424</span> (<span class="number">2.3</span> KiB)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/ <span class="comment"># ping 172.21.55.2</span></span><br><span class="line">PING <span class="number">172.21</span>.<span class="number">55.2</span> (<span class="number">172.21</span>.<span class="number">55.2</span>): <span class="number">56</span> <span class="keyword">data</span> bytes</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.21</span>.<span class="number">55.2</span>: seq=<span class="number">0</span> ttl=<span class="number">60</span> time=<span class="number">2.141</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.21</span>.<span class="number">55.2</span>: seq=<span class="number">1</span> ttl=<span class="number">60</span> time=<span class="number">1.219</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.21</span>.<span class="number">55.2</span>: seq=<span class="number">2</span> ttl=<span class="number">60</span> time=<span class="number">0.730</span> ms</span><br><span class="line">^C</span><br><span class="line">--- <span class="number">172.21</span>.<span class="number">55.2</span> ping statistics ---</span><br><span class="line"><span class="number">3</span> packets transmitted, <span class="number">3</span> packets received, <span class="number">0</span>% packet loss</span><br><span class="line">round<span class="literal">-trip</span> min/avg/max = <span class="number">0.730</span>/<span class="number">1.363</span>/<span class="number">2.141</span> ms</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">node2</span> ~]<span class="comment"># docker run -it --rm busybox:latest</span></span><br><span class="line"></span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">02</span>:<span class="number">42</span>:<span class="built_in">AC</span>:<span class="number">15</span>:<span class="number">37</span>:<span class="number">02</span></span><br><span class="line">          inet addr:<span class="number">172.21</span>.<span class="number">55.2</span>  Bcast:<span class="number">172.21</span>.<span class="number">55.255</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1472</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">19</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX bytes:<span class="number">2246</span> (<span class="number">2.1</span> KiB)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/ <span class="comment"># ping 172.21.31.2</span></span><br><span class="line">PING <span class="number">172.21</span>.<span class="number">31.2</span> (<span class="number">172.21</span>.<span class="number">31.2</span>): <span class="number">56</span> <span class="keyword">data</span> bytes</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.21</span>.<span class="number">31.2</span>: seq=<span class="number">0</span> ttl=<span class="number">60</span> time=<span class="number">1.286</span> ms</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">172.21</span>.<span class="number">31.2</span>: seq=<span class="number">1</span> ttl=<span class="number">60</span> time=<span class="number">0.552</span> ms</span><br><span class="line">^C</span><br><span class="line">--- <span class="number">172.21</span>.<span class="number">31.2</span> ping statistics ---</span><br><span class="line"><span class="number">2</span> packets transmitted, <span class="number">2</span> packets received, <span class="number">0</span>% packet loss</span><br><span class="line">round<span class="literal">-trip</span> min/avg/max = <span class="number">0.552</span>/<span class="number">0.919</span>/<span class="number">1.286</span> ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>


























  </div>
</article>





    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>  
    <div id="vcomments" class="blog-post-comments"></div>
    <script>        
        new Valine({
            el: '#vcomments',
            visitor: true,
            appId: 'gqmHGHyrnzRPUSxqADLhUzlT-gzGzoHsz',
            appKey: 'q8uQ7rKeukTuQ3L35peaOhkC',
            placeholder: '好哥哥，说几句吧！',
            avatar: 'retro'
        })
    </script>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">一、Docker容器默认网络模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 原理图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 名词解释</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker%E5%AE%B9%E5%99%A8%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">二、Docker容器默认网络模型工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%AE%B9%E5%99%A8%E8%AE%BF%E9%97%AE%E5%A4%96%E7%BD%91"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 容器访问外网</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%A4%96%E7%BD%91%E8%AE%BF%E9%97%AE%E5%AE%B9%E5%99%A8"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 外网访问容器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Docker%E5%AE%B9%E5%99%A8%E5%9B%9B%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">三、Docker容器四种网络模型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Docker%E5%AE%B9%E5%99%A8%E5%9B%9B%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">4.</span> <span class="toc-text">四、Docker容器四种网络模型应用案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%9F%A5%E7%9C%8B%E5%B7%B2%E6%9C%89%E7%9A%84%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 查看已有的网络模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%88%9B%E5%BB%BA%E6%8C%87%E5%AE%9A%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 创建指定类型的网络模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-bridge"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1 bridge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-host"><span class="toc-number">4.2.2.</span> <span class="toc-text">4.2.2 host</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-none"><span class="toc-number">4.2.3.</span> <span class="toc-text">4.2.3 none</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-%E8%81%94%E7%9B%9F%E7%BD%91%E7%BB%9C"><span class="toc-number">4.2.4.</span> <span class="toc-text">4.2.4 联盟网络</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E8%B7%A8Docker-Host%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">五、跨Docker Host容器间通信实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E8%B7%A8Docker-Host%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1%E5%BF%85%E8%A6%81%E6%80%A7"><span class="toc-number">5.1.</span> <span class="toc-text">5.1  跨Docker Host容器间通信必要性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E8%B7%A8Docker-Host%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 跨Docker Host容器间通信实现方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-Docker%E5%8E%9F%E7%94%9F%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.1.</span> <span class="toc-text">5.2.1 Docker原生方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.2.</span> <span class="toc-text">5.2.2 第三方方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-1-%E9%9A%A7%E9%81%93%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.2.1.</span> <span class="toc-text">5.2.2.1 隧道方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-2-%E8%B7%AF%E7%94%B1%E6%96%B9%E6%A1%88"><span class="toc-number">5.2.2.2.</span> <span class="toc-text">5.2.2.2 路由方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-Flannel"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 Flannel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-overlay-network%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.3.1.</span> <span class="toc-text">5.3.1 overlay network介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-Flannel%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.3.2.</span> <span class="toc-text">5.3.2 Flannel介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-Flannel%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">5.3.3.</span> <span class="toc-text">5.3.3 Flannel工作原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-ETCD"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 ETCD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-ETCD%E9%83%A8%E7%BD%B2"><span class="toc-number">5.5.</span> <span class="toc-text">5.5 ETCD部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-1-%E4%B8%BB%E6%9C%BA%E5%90%8D%E7%A7%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">5.5.1.</span> <span class="toc-text">5.5.1  主机名称配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-2-%E4%B8%BB%E6%9C%BAIP%E5%9C%B0%E5%9D%80%E9%85%8D%E7%BD%AE"><span class="toc-number">5.5.2.</span> <span class="toc-text">5.5.2 主机IP地址配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-3-%E4%B8%BB%E6%9C%BA%E5%90%8D%E4%B8%8EIP%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90"><span class="toc-number">5.5.3.</span> <span class="toc-text">5.5.3 主机名与IP地址解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-4-%E5%BC%80%E5%90%AF%E5%86%85%E6%A0%B8%E8%BD%AC%E5%8F%91"><span class="toc-number">5.5.4.</span> <span class="toc-text">5.5.4 开启内核转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-5-etcd%E5%AE%89%E8%A3%85"><span class="toc-number">5.5.5.</span> <span class="toc-text">5.5.5 etcd安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-6-etcd%E9%85%8D%E7%BD%AE"><span class="toc-number">5.5.6.</span> <span class="toc-text">5.5.6 etcd配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-7-%E5%90%AF%E5%8A%A8etcd%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.5.7.</span> <span class="toc-text">5.5.7 启动etcd服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-8-%E6%A3%80%E6%9F%A5%E7%AB%AF%E5%8F%A3%E7%8A%B6%E6%80%81"><span class="toc-number">5.5.8.</span> <span class="toc-text">5.5.8 检查端口状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-9-%E6%A3%80%E6%9F%A5etcd%E9%9B%86%E7%BE%A4%E6%98%AF%E5%90%A6%E5%81%A5%E5%BA%B7"><span class="toc-number">5.5.9.</span> <span class="toc-text">5.5.9 检查etcd集群是否健康</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-Flannel%E9%83%A8%E7%BD%B2"><span class="toc-number">5.6.</span> <span class="toc-text">5.6 Flannel部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-1-Flannel%E5%AE%89%E8%A3%85"><span class="toc-number">5.6.1.</span> <span class="toc-text">5.6.1 Flannel安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-2-%E4%BF%AE%E6%94%B9Flannel%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.6.2.</span> <span class="toc-text">5.6.2 修改Flannel配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-3-%E9%85%8D%E7%BD%AEetcd%E4%B8%AD%E5%85%B3%E4%BA%8Eflannel%E7%9A%84key"><span class="toc-number">5.6.3.</span> <span class="toc-text">5.6.3 配置etcd中关于flannel的key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-4-%E5%90%AF%E5%8A%A8Flannel%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.6.4.</span> <span class="toc-text">5.6.4 启动Flannel服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-5-%E6%9F%A5%E7%9C%8B%E5%90%84node%E4%B8%ADflannel%E4%BA%A7%E7%94%9F%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">5.6.5.</span> <span class="toc-text">5.6.5 查看各node中flannel产生的配置信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-Docker%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">5.7.</span> <span class="toc-text">5.7 Docker网络配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-8-%E8%B7%A8Docker-Host%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1%E9%AA%8C%E8%AF%81"><span class="toc-number">5.8.</span> <span class="toc-text">5.8 跨Docker Host容器间通信验证</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&text=Docker容器网络与通信原理"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&is_video=false&description=Docker容器网络与通信原理"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Docker容器网络与通信原理&body=Check out this article: https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&title=Docker容器网络与通信原理"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://fate-re-zero.github.io/2023/08/06/%E4%BA%91%E5%8E%9F%E7%94%9F/Docker/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86/&name=Docker容器网络与通信原理&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">2025 祥祥要起飞</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>


<script src="/lib/particles/particles.min.js"></script>


<script src="/lib/typing/typing.min.js"></script>


<script src="/js/main.js"></script>


<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


