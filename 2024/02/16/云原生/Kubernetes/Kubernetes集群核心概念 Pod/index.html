<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="一、工作负载(workloads)参考链接：https:&#x2F;&#x2F;kubernetes.io&#x2F;zh&#x2F;docs&#x2F;concepts&#x2F;workloads&#x2F;工作负载（workload）是在kubernetes集群中运行的应用程序。无论你的工作负载是单一服务还是多个一同工作的服务构成，在kubernetes中都可以使用pod来运行它。  workloads分为pod与controllers  pod通过控制器实现">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes集群核心概念 Pod">
<meta property="og:url" content="https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/index.html">
<meta property="og:site_name" content="祥祥要起飞">
<meta property="og:description" content="一、工作负载(workloads)参考链接：https:&#x2F;&#x2F;kubernetes.io&#x2F;zh&#x2F;docs&#x2F;concepts&#x2F;workloads&#x2F;工作负载（workload）是在kubernetes集群中运行的应用程序。无论你的工作负载是单一服务还是多个一同工作的服务构成，在kubernetes中都可以使用pod来运行它。  workloads分为pod与controllers  pod通过控制器实现">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/1">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/workload.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/pod%E8%B0%83%E5%BA%A6.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/pod%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/liveness-httpget.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/liveness-tcp.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/readiness-httpget.png">
<meta property="article:published_time" content="2024-02-16T00:40:46.000Z">
<meta property="article:modified_time" content="2025-04-24T15:02:48.114Z">
<meta property="article:author" content="祥祥要起飞">
<meta property="article:tag" content="Kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/1">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Kubernetes集群核心概念 Pod</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="祥祥要起飞" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2024/02/26/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Controller/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2024/02/13/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4%20kubectl/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&text=Kubernetes集群核心概念 Pod"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&is_video=false&description=Kubernetes集群核心概念 Pod"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kubernetes集群核心概念 Pod&body=Check out this article: https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&name=Kubernetes集群核心概念 Pod&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-workloads"><span class="toc-number">1.</span> <span class="toc-text">一、工作负载(workloads)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81pod%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">二、pod介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-pod%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%88%86%E7%B1%BB"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 pod定义与分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-Pod%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 Pod定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-Pod%E5%88%86%E7%B1%BB"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 Pod分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%9F%A5%E7%9C%8Bpod%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 查看pod方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-pod%E7%9A%84YAML%E8%B5%84%E6%BA%90%E6%B8%85%E5%8D%95%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 pod的YAML资源清单格式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81pod%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%AA%8C%E8%AF%81"><span class="toc-number">3.</span> <span class="toc-text">三、pod创建与验证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BApod-v1-18%E5%8F%98%E5%8C%96"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 命令创建pod(v1.18变化)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BApod-nginx%E7%9A%84pod"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 创建一个名为pod-nginx的pod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E9%AA%8C%E8%AF%81"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-YAML%E5%88%9B%E5%BB%BApod"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 YAML创建pod</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%87%86%E5%A4%87yaml%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 准备yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E6%9F%A5%E7%9C%8Bpod%E4%BF%A1%E6%81%AF"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 查看pod信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%88%A0%E9%99%A4pod"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 删除pod</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E5%8D%95%E4%B8%AApod%E5%88%A0%E9%99%A4"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 单个pod删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E5%A4%9A%E4%B8%AApod%E5%88%A0%E9%99%A4"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 多个pod删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96%E7%AD%96%E7%95%A5"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 镜像拉取策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-pod%E7%9A%84%E6%A0%87%E7%AD%BE"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 pod的标签</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E7%AE%A1%E7%90%86Pod%E6%A0%87%E7%AD%BE"><span class="toc-number">3.5.1.</span> <span class="toc-text">3.5.1 通过命令管理Pod标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-%E9%80%9A%E8%BF%87YAML%E5%88%9B%E5%BB%BAPod%E6%97%B6%E6%B7%BB%E5%8A%A0%E6%A0%87%E7%AD%BE"><span class="toc-number">3.5.2.</span> <span class="toc-text">3.5.2 通过YAML创建Pod时添加标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-pod%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 pod资源限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-pod%E5%8C%85%E5%90%AB%E5%A4%9A%E4%B8%AA%E5%AE%B9%E5%99%A8"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 pod包含多个容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E5%AF%B9pod%E9%87%8C%E7%9A%84%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="toc-number">3.8.</span> <span class="toc-text">3.8 对pod里的容器进行操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-1-%E5%91%BD%E4%BB%A4%E5%B8%AE%E5%8A%A9"><span class="toc-number">3.8.1.</span> <span class="toc-text">3.8.1 命令帮助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-2-%E4%B8%8D%E7%94%A8%E4%BA%A4%E4%BA%92%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.8.2.</span> <span class="toc-text">3.8.2 不用交互直接执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-3-%E5%92%8C%E5%AE%B9%E5%99%A8%E4%BA%A4%E4%BA%92%E6%93%8D%E4%BD%9C"><span class="toc-number">3.8.3.</span> <span class="toc-text">3.8.3 和容器交互操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-9-%E9%AA%8C%E8%AF%81pod%E4%B8%AD%E5%A4%9A%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%85%B1%E4%BA%AB"><span class="toc-number">3.9.</span> <span class="toc-text">3.9 验证pod中多个容器网络共享</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81pod%E8%B0%83%E5%BA%A6"><span class="toc-number">4.</span> <span class="toc-text">四、pod调度</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-pod%E8%B0%83%E5%BA%A6%E6%B5%81%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 pod调度流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E8%B0%83%E5%BA%A6%E7%BA%A6%E6%9D%9F%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 调度约束方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-nodeName"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1  nodeName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-nodeSelector"><span class="toc-number">4.2.2.</span> <span class="toc-text">4.2.2 nodeSelector</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81pod%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">5.</span> <span class="toc-text">五、pod的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Pod%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 Pod生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8"><span class="toc-number">5.1.1.</span> <span class="toc-text">5.1.1 容器启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-%E5%AE%B9%E5%99%A8%E7%BB%88%E6%AD%A2"><span class="toc-number">5.1.2.</span> <span class="toc-text">5.1.2 容器终止</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-%E5%9B%9E%E9%A1%BE%E5%AE%B9%E5%99%A8%E9%87%8D%E5%90%AF%E7%AD%96%E7%95%A5"><span class="toc-number">5.1.3.</span> <span class="toc-text">5.1.3 回顾容器重启策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-HealthCheck%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 HealthCheck健康检查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-Health-Check%E6%96%B9%E5%BC%8F"><span class="toc-number">5.2.1.</span> <span class="toc-text">5.2.1 Health Check方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-Probe%E6%8E%A2%E6%B5%8B%E6%96%B9%E5%BC%8F"><span class="toc-number">5.2.2.</span> <span class="toc-text">5.2.2 Probe探测方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-liveness-exec%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.3.</span> <span class="toc-text">5.2.3 liveness-exec案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95-%E5%AE%B9%E5%99%A8%E9%87%8D%E5%90%AF%E7%AD%96%E7%95%A5%E9%AA%8C%E8%AF%81"><span class="toc-number">5.2.4.</span> <span class="toc-text">拓展: 容器重启策略验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-4-liveness-httpget%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.5.</span> <span class="toc-text">5.2.4  liveness-httpget案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-5-liveness-tcp%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.6.</span> <span class="toc-text">5.2.5  liveness-tcp案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-6-readiness%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.7.</span> <span class="toc-text">5.2.6 readiness案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-7-readiness-liveness%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.8.</span> <span class="toc-text">5.2.7 readiness+liveness综合案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-post-start"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 post-start</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-pre-stop"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 pre-stop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-pod%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="toc-number">5.5.</span> <span class="toc-text">5.5 pod故障排除</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Kubernetes集群核心概念 Pod
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">祥祥要起飞</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-02-16T00:40:46.000Z" itemprop="datePublished">2024-02-16</time>
        
      
    </div>


      <div class="posteye">
    <i class="fas fa-eye"></i>
    <span id="/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/" class="leancloud-visitors" data-flag-title="Kubernetes集群核心概念 Pod" style="display: inline;">
        <span class="leancloud-visitors-count"></span>
    </span>
</div>
      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Kubernetes/" rel="tag">Kubernetes</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="一、工作负载-workloads"><a href="#一、工作负载-workloads" class="headerlink" title="一、工作负载(workloads)"></a>一、工作负载(workloads)</h1><p>参考链接：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/">https://kubernetes.io/zh/docs/concepts/workloads/</a><br>工作负载（workload）是在kubernetes集群中运行的应用程序。无论你的工作负载是单一服务还是多个一同工作的服务构成，在kubernetes中都可以使用pod来运行它。</p>
<p><img src="/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/1" alt="1604285743110"></p>
<p>workloads分为pod与controllers</p>
<ul>
<li>pod通过控制器实现应用的运行，如何伸缩，升级等</li>
<li>controllers 在集群中管理pod</li>
<li>pod与控制器之间通过label-selector相关联，是唯一的关联方式</li>
</ul>
<p><img src="/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/workload.png" alt="1564844640416"></p>
<p>在pod的YAML里指定pod标签</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">定义标签</span><br><span class="line">  labels: </span><br><span class="line">	app: nginx</span><br></pre></td></tr></table></figure>



<p>在控制器的YAML里指定标签选择器匹配标签</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通过标签选择器选择对应的pod</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br></pre></td></tr></table></figure>



<h1 id="二、pod介绍"><a href="#二、pod介绍" class="headerlink" title="二、pod介绍"></a>二、pod介绍</h1><h2 id="2-1-pod定义与分类"><a href="#2-1-pod定义与分类" class="headerlink" title="2.1 pod定义与分类"></a>2.1 pod定义与分类</h2><p>参考链接: <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/pods/">https://kubernetes.io/zh/docs/concepts/workloads/pods/</a></p>
<h3 id="2-1-1-Pod定义"><a href="#2-1-1-Pod定义" class="headerlink" title="2.1.1 Pod定义"></a>2.1.1 Pod定义</h3><ul>
<li>Pod(豌豆荚) 是Kubernetes集群管理（创建、部署）与调度的最小计算单元，表示处于运行状态的一组容器。</li>
<li>Pod不是进程，而是容器运行的环境。</li>
<li>一个Pod可以封装<strong>一个容器或多个容器(主容器或sidecar边车容器)</strong></li>
<li>一个pod内的多个容器之间共享部分命名空间，例如：Net Namespace,UTS Namespace,IPC Namespace及存储资源</li>
<li>用户pod默认会被调度运行在node节点之上(不运行在master节点上，但也有例外情况)</li>
<li>pod内的IP不是固定的，集群外不能直接访问pod</li>
</ul>
<h3 id="2-1-2-Pod分类"><a href="#2-1-2-Pod分类" class="headerlink" title="2.1.2 Pod分类"></a>2.1.2 Pod分类</h3><ul>
<li><strong>静态Pod</strong>    也称之为“无控制器管理的自主式pod”，直接由特定节点上的 <code>kubelet</code> 守护进程管理， 不需要API 服务器看到它们，尽管大多数 Pod 都是通过控制面（例如，Deployment） 来管理的，对于静态 Pod 而言，<code>kubelet</code> 直接监控每个 Pod，并在其失效时重启之。</li>
<li><strong>控制器管理的pod</strong>   控制器可以控制pod的副本数，扩容与裁剪，版本更新与回滚等</li>
</ul>
<h2 id="2-2-查看pod方法"><a href="#2-2-查看pod方法" class="headerlink" title="2.2 查看pod方法"></a>2.2 查看pod方法</h2><p>pod是一种计算资源，可以通过<code>kubectl get pod</code>来查看</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod		# pod或pods都可以，不指定namespace,默认是名为default的namespace</span></span><br><span class="line">	</span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod -n kube-system</span></span><br></pre></td></tr></table></figure>



<h2 id="2-3-pod的YAML资源清单格式"><a href="#2-3-pod的YAML资源清单格式" class="headerlink" title="2.3 pod的YAML资源清单格式"></a>2.3 pod的YAML资源清单格式</h2><p>先看一个yaml格式的pod定义文件解释</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yaml格式的pod定义文件完整内容：</span></span><br><span class="line">apiVersion: v1       <span class="comment">#必选，api版本号，例如v1</span></span><br><span class="line">kind: Pod       	<span class="comment">#必选，Pod</span></span><br><span class="line">metadata:       	<span class="comment">#必选，元数据</span></span><br><span class="line">  name: string       <span class="comment">#必选，Pod名称</span></span><br><span class="line">  namespace: string    <span class="comment">#Pod所属的命名空间,默认在default的namespace</span></span><br><span class="line">  labels:     		 <span class="comment"># 自定义标签</span></span><br><span class="line">    name: string     <span class="comment">#自定义标签名字</span></span><br><span class="line">  annotations:        <span class="comment">#自定义注释列表</span></span><br><span class="line">    name: string</span><br><span class="line">spec:         <span class="comment">#必选，Pod中容器的详细定义(期望)</span></span><br><span class="line">  containers:      <span class="comment">#必选，Pod中容器列表</span></span><br><span class="line">  - name: string     <span class="comment">#必选，容器名称</span></span><br><span class="line">    image: string    <span class="comment">#必选，容器的镜像名称</span></span><br><span class="line">    imagePullPolicy: [<span class="type">Always</span> | <span class="type">Never</span> | <span class="type">IfNotPresent</span>] <span class="comment">#获取镜像的策略 Alawys表示下载镜像 IfnotPresent表示优先使用本地镜像，否则下载镜像，Nerver表示仅使用本地镜像</span></span><br><span class="line">    command: [<span class="built_in">string</span>]    <span class="comment">#容器的启动命令列表，如不指定，使用打包时使用的启动命令</span></span><br><span class="line">    args: [<span class="built_in">string</span>]     <span class="comment">#容器的启动命令参数列表</span></span><br><span class="line">    workingDir: string     <span class="comment">#容器的工作目录</span></span><br><span class="line">    volumeMounts:    <span class="comment">#挂载到容器内部的存储卷配置</span></span><br><span class="line">    - name: string     <span class="comment">#引用pod定义的共享存储卷的名称，需用volumes[]部分定义的的卷名</span></span><br><span class="line">      mountPath: string    <span class="comment">#存储卷在容器内mount的绝对路径，应少于512字符</span></span><br><span class="line">      readOnly: boolean    <span class="comment">#是否为只读模式</span></span><br><span class="line">    ports:       <span class="comment">#需要暴露的端口库号列表</span></span><br><span class="line">    - name: string     <span class="comment">#端口号名称</span></span><br><span class="line">      containerPort: int   <span class="comment">#容器需要监听的端口号</span></span><br><span class="line">      hostPort: int    <span class="comment">#容器所在主机需要监听的端口号，默认与Container相同</span></span><br><span class="line">      protocol: string     <span class="comment">#端口协议，支持TCP和UDP，默认TCP</span></span><br><span class="line">    env:       <span class="comment">#容器运行前需设置的环境变量列表</span></span><br><span class="line">    - name: string     <span class="comment">#环境变量名称</span></span><br><span class="line">      value: string    <span class="comment">#环境变量的值</span></span><br><span class="line">    resources:       <span class="comment">#资源限制和请求的设置</span></span><br><span class="line">      limits:      <span class="comment">#资源限制的设置</span></span><br><span class="line">        cpu: string    <span class="comment">#Cpu的限制，单位为core数，将用于docker run --cpu-shares参数</span></span><br><span class="line">        memory: string     <span class="comment">#内存限制，单位可以为Mib/Gib，将用于docker run --memory参数</span></span><br><span class="line">      requests:      <span class="comment">#资源请求的设置</span></span><br><span class="line">        cpu: string    <span class="comment">#Cpu请求，容器启动的初始可用数量</span></span><br><span class="line">        memory: string     <span class="comment">#内存清求，容器启动的初始可用数量</span></span><br><span class="line">    livenessProbe:     <span class="comment">#对Pod内个容器健康检查的设置，当探测无响应几次后将自动重启该容器，检查方法有exec、httpGet和tcpSocket，对一个容器只需设置其中一种方法即可</span></span><br><span class="line">      exec:      <span class="comment">#对Pod容器内检查方式设置为exec方式</span></span><br><span class="line">        command: [<span class="built_in">string</span>]  <span class="comment">#exec方式需要制定的命令或脚本</span></span><br><span class="line">      httpGet:       <span class="comment">#对Pod内个容器健康检查方法设置为HttpGet，需要制定Path、port</span></span><br><span class="line">        path: string</span><br><span class="line">        port: number</span><br><span class="line">        host: string</span><br><span class="line">        scheme: string</span><br><span class="line">        HttpHeaders:</span><br><span class="line">        - name: string</span><br><span class="line">          value: string</span><br><span class="line">      tcpSocket:     <span class="comment">#对Pod内个容器健康检查方式设置为tcpSocket方式</span></span><br><span class="line">         port: number</span><br><span class="line">       initialDelaySeconds: <span class="number">0</span>  <span class="comment">#容器启动完成后首次探测的时间，单位为秒</span></span><br><span class="line">       timeoutSeconds: <span class="number">0</span>   <span class="comment">#对容器健康检查探测等待响应的超时时间，单位秒，默认1秒</span></span><br><span class="line">       periodSeconds: <span class="number">0</span>    <span class="comment">#对容器监控检查的定期探测时间设置，单位秒，默认10秒一次</span></span><br><span class="line">       successThreshold: <span class="number">0</span></span><br><span class="line">       failureThreshold: <span class="number">0</span></span><br><span class="line">       securityContext:</span><br><span class="line">         privileged:false</span><br><span class="line">    restartPolicy: [<span class="type">Always</span> | <span class="type">Never</span> | <span class="type">OnFailure</span>] <span class="comment"># Pod的重启策略，Always表示一旦不管以何种方式终止运行，kubelet都将重启，OnFailure表示只有Pod以非0退出码退出才重启，Nerver表示不再重启该Pod</span></span><br><span class="line">    nodeSelector: obeject  <span class="comment"># 设置NodeSelector表示将该Pod调度到包含这个label的node上，以key：value的格式指定</span></span><br><span class="line">    imagePullSecrets:    <span class="comment">#Pull镜像时使用的secret名称，以key：secretkey格式指定</span></span><br><span class="line">    - name: string</span><br><span class="line">    hostNetwork: false     <span class="comment">#是否使用主机网络模式，默认为false，如果设置为true，表示使用宿主机网络</span></span><br><span class="line">    volumes:       <span class="comment">#在该pod上定义共享存储卷列表</span></span><br><span class="line">    - name: string     <span class="comment">#共享存储卷名称 （volumes类型有很多种）</span></span><br><span class="line">      emptyDir: &#123;&#125;     <span class="comment">#类型为emtyDir的存储卷，与Pod同生命周期的一个临时目录。为空值</span></span><br><span class="line">      hostPath: string     <span class="comment">#类型为hostPath的存储卷，表示挂载Pod所在宿主机的目录</span></span><br><span class="line">        path: string     <span class="comment">#Pod所在宿主机的目录，将被用于同期中mount的目录</span></span><br><span class="line">      secret:      <span class="comment">#类型为secret的存储卷，挂载集群与定义的secret对象到容器内部</span></span><br><span class="line">        scretname: string  </span><br><span class="line">        items:     </span><br><span class="line">        - key: string</span><br><span class="line">          path: string</span><br><span class="line">      configMap:     <span class="comment">#类型为configMap的存储卷，挂载预定义的configMap对象到容器内部</span></span><br><span class="line">        name: string</span><br><span class="line">        items:</span><br><span class="line">        - key: string</span><br><span class="line">          path: string</span><br></pre></td></tr></table></figure>



<p><strong>YAML格式查找帮助方法回顾</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl explain namespace</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl explain pod</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl explain pod.spec</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl explain pod.spec.containers</span></span><br></pre></td></tr></table></figure>



<h1 id="三、pod创建与验证"><a href="#三、pod创建与验证" class="headerlink" title="三、pod创建与验证"></a>三、pod创建与验证</h1><h2 id="3-1-命令创建pod-v1-18变化"><a href="#3-1-命令创建pod-v1-18变化" class="headerlink" title="3.1 命令创建pod(v1.18变化)"></a>3.1 命令创建pod(v1.18变化)</h2><ul>
<li>k8s之前版本中, kubectl run命令用于创建deployment控制器</li>
<li>在v1.18版本中, kubectl run命令改为创建pod</li>
</ul>
<h3 id="3-1-1-创建一个名为pod-nginx的pod"><a href="#3-1-1-创建一个名为pod-nginx的pod" class="headerlink" title="3.1.1 创建一个名为pod-nginx的pod"></a>3.1.1 创建一个名为pod-nginx的pod</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl run nginx1 --image=nginx:1.15-alpine</span></span><br><span class="line">pod/nginx1 created</span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-验证"><a href="#3-1-2-验证" class="headerlink" title="3.1.2 验证"></a>3.1.2 验证</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods</span></span><br><span class="line">NAME             READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx1           <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">41</span>s</span><br></pre></td></tr></table></figure>





<h2 id="3-2-YAML创建pod"><a href="#3-2-YAML创建pod" class="headerlink" title="3.2 YAML创建pod"></a>3.2 YAML创建pod</h2><h3 id="3-2-1-准备yaml文件"><a href="#3-2-1-准备yaml文件" class="headerlink" title="3.2.1 准备yaml文件"></a>3.2.1 准备yaml文件</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod1.yml</span></span><br><span class="line">apiVersion: v1					<span class="comment"># api版本</span></span><br><span class="line">kind: Pod						<span class="comment"># 资源类型为Pod</span></span><br><span class="line">metadata:						</span><br><span class="line">  name: pod<span class="literal">-stress</span>				<span class="comment"># 自定义pod的名称</span></span><br><span class="line">spec:</span><br><span class="line">  containers:					<span class="comment"># 定义pod里包含的容器</span></span><br><span class="line">  - name: c1					<span class="comment"># 自定义pod中的容器名</span></span><br><span class="line">    image: polinux/stress		<span class="comment"># 启动容器的镜像名</span></span><br><span class="line">    command: [<span class="string">&quot;stress&quot;</span>]			<span class="comment"># 自定义启动容器时要执行的命令(类似dockerfile里的CMD)</span></span><br><span class="line">    args: [<span class="string">&quot;--vm&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;--vm-bytes&quot;</span>, <span class="string">&quot;150M&quot;</span>, <span class="string">&quot;--vm-hang&quot;</span>, <span class="string">&quot;1&quot;</span>] <span class="comment"># 自定义启动容器执行命令的参数</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># polinux/stress这个镜像用于压力测试,在启动容器时传命令与参数就是相当于分配容器运行时需要的压力</span></span><br></pre></td></tr></table></figure>

<p>2, 通过yaml文件创建pod</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod1.yml</span></span><br><span class="line">pod/pod<span class="literal">-stress</span> created</span><br></pre></td></tr></table></figure>



<h3 id="3-2-2-查看pod信息"><a href="#3-2-2-查看pod信息" class="headerlink" title="3.2.2 查看pod信息"></a>3.2.2 查看pod信息</h3><p>查看pod信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod<span class="literal">-stress</span>    <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">45</span>s</span><br></pre></td></tr></table></figure>

<p>查看pod详细信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods -o wide</span></span><br><span class="line">NAME         READY   STATUS    RESTARTS   AGE   IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">pod<span class="literal">-stress</span>   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">71</span>s   <span class="number">10.244</span>.<span class="number">194.72</span>   k8s<span class="literal">-worker1</span>   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>描述pod详细信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl describe pod pod-stress </span></span><br><span class="line">......</span><br><span class="line">Events:</span><br><span class="line">  <span class="built_in">Type</span>    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  <span class="number">102</span>s  default<span class="literal">-scheduler</span>  Successfully assigned default/pod<span class="literal">-stress</span> to k8s<span class="literal">-worker1</span></span><br><span class="line">  Normal  Pulling    <span class="number">102</span>s  kubelet            Pulling image <span class="string">&quot;polinux/stress&quot;</span></span><br><span class="line">  Normal  Pulled     <span class="number">83</span>s   kubelet            Successfully pulled image <span class="string">&quot;polinux/stress&quot;</span> <span class="keyword">in</span> <span class="number">18.944533343</span>s</span><br><span class="line">  Normal  Created    <span class="number">83</span>s   kubelet            Created container c1</span><br><span class="line">  Normal  Started    <span class="number">82</span>s   kubelet            Started container c1</span><br></pre></td></tr></table></figure>



<h2 id="3-3-删除pod"><a href="#3-3-删除pod" class="headerlink" title="3.3 删除pod"></a>3.3 删除pod</h2><h3 id="3-3-1-单个pod删除"><a href="#3-3-1-单个pod删除" class="headerlink" title="3.3.1 单个pod删除"></a>3.3.1 单个pod删除</h3><p>方法1:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl delete pod pod-stress</span></span><br><span class="line">pod <span class="string">&quot;pod-stress&quot;</span> deleted</span><br></pre></td></tr></table></figure>

<p>方法2:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl delete -f pod1.yml</span></span><br></pre></td></tr></table></figure>



<h3 id="3-3-2-多个pod删除"><a href="#3-3-2-多个pod删除" class="headerlink" title="3.3.2 多个pod删除"></a>3.3.2 多个pod删除</h3><p>方法1: 后接多个pod名</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl delete pod pod名1 pod名2 pod名3 ......</span></span><br></pre></td></tr></table></figure>

<p>方法2: 通过awk截取要删除的pod名称，然后管道给xargs</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods |awk &#x27;NR&gt;1 &#123;print $1&#125;&#x27; |xargs kubectl  delete pod</span></span><br></pre></td></tr></table></figure>

<p>方法3: 如果要删除的pod都在同一个非default的命名空间，则可直接删除命名空间</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl delete ns xxxx</span></span><br></pre></td></tr></table></figure>





<h2 id="3-4-镜像拉取策略"><a href="#3-4-镜像拉取策略" class="headerlink" title="3.4 镜像拉取策略"></a>3.4 镜像拉取策略</h2><p>由imagePullPolicy参数控制</p>
<ul>
<li>Always : 不管本地有没有镜像，都要从仓库中下载镜像</li>
<li>Never : 从来不从仓库下载镜像, 只用本地镜像,本地没有就算了</li>
<li>IfNotPresent: 如果本地存在就直接使用, 不存在才从仓库下载</li>
</ul>
<p>默认的策略是：</p>
<ul>
<li>当镜像标签版本是latest，默认策略就是Always</li>
<li>如果指定特定版本默认拉取策略就是IfNotPresent。</li>
</ul>
<p>1, 将上面的pod删除再创建，使用下面命令查看信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod1.yml</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl delete -f pod1.yml</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl describe pod pod-stress</span></span><br><span class="line">......</span><br><span class="line">Events:</span><br><span class="line">  <span class="built_in">Type</span>    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  <span class="number">102</span>s  default<span class="literal">-scheduler</span>  Successfully assigned default/pod<span class="literal">-stress</span> to k8s<span class="literal">-worker1</span></span><br><span class="line">  Normal  Pulling    <span class="number">102</span>s  kubelet            Pulling image <span class="string">&quot;polinux/stress&quot;</span></span><br><span class="line">  Normal  Pulled     <span class="number">83</span>s   kubelet            Successfully pulled image <span class="string">&quot;polinux/stress&quot;</span> <span class="keyword">in</span> <span class="number">18.944533343</span>s</span><br><span class="line">  Normal  Created    <span class="number">83</span>s   kubelet            Created container c1</span><br><span class="line">  Normal  Started    <span class="number">82</span>s   kubelet            Started container c1</span><br></pre></td></tr></table></figure>

<p><strong>说明: 可以看到第二行信息还是<code>pulling image</code>下载镜像</strong></p>
<p>2, 修改YAML</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod1.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: pod<span class="literal">-stress</span></span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: c1</span><br><span class="line">    image: polinux/stress</span><br><span class="line">    command: [<span class="string">&quot;stress&quot;</span>]</span><br><span class="line">    args: [<span class="string">&quot;--vm&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;--vm-bytes&quot;</span>, <span class="string">&quot;150M&quot;</span>, <span class="string">&quot;--vm-hang&quot;</span>, <span class="string">&quot;1&quot;</span>]</span><br><span class="line">    imagePullPolicy: IfNotPresent					<span class="comment">#  增加了这一句</span></span><br></pre></td></tr></table></figure>

<p>3，再次删除再创建</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl describe pod pod-stress</span></span><br><span class="line">......</span><br><span class="line">Events:</span><br><span class="line">  <span class="built_in">Type</span>    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  <span class="number">17</span>s   default<span class="literal">-scheduler</span>  Successfully assigned default/pod<span class="literal">-stress</span> to k8s<span class="literal">-worker1</span></span><br><span class="line">  Normal  Pulled     <span class="number">17</span>s   kubelet            Container image <span class="string">&quot;polinux/stress&quot;</span> already present on machine</span><br><span class="line">  Normal  Created    <span class="number">17</span>s   kubelet            Created container c1</span><br><span class="line">  Normal  Started    <span class="number">17</span>s   kubelet            Started container c1</span><br></pre></td></tr></table></figure>

<p><strong>说明: 第二行信息是说镜像已经存在，直接使用了</strong></p>
<h2 id="3-5-pod的标签"><a href="#3-5-pod的标签" class="headerlink" title="3.5 pod的标签"></a>3.5 pod的标签</h2><ul>
<li>为pod设置label,用于控制器通过label与pod关联</li>
<li>语法与前面学的node标签几乎一致</li>
</ul>
<h3 id="3-5-1-通过命令管理Pod标签"><a href="#3-5-1-通过命令管理Pod标签" class="headerlink" title="3.5.1 通过命令管理Pod标签"></a>3.5.1 通过命令管理Pod标签</h3><ol>
<li>查看pod的标签</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods --show-labels</span></span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">pod<span class="literal">-stress</span>     <span class="number">1</span>/<span class="number">1</span>    Running   <span class="number">0</span>          <span class="number">7</span>m25s   &lt;none&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>打标签,再查看</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl label pod pod-stress region=huanai zone=A env=test bussiness=game</span></span><br><span class="line">pod/pod<span class="literal">-stress</span> labeled</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods --show-labels</span></span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">pod<span class="literal">-stress</span>    <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">8</span>m54s   bussiness=game,env=test,region=huanai,zone=A</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过等值关系标签查询</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods -l zone=A</span></span><br><span class="line">NAME         READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod<span class="literal">-stress</span>   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">9</span>m22s</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>通过集合关系标签查询</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods -l &quot;zone in (A,B,C)&quot;</span></span><br><span class="line">NAME         READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod<span class="literal">-stress</span>   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">9</span>m55s</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>删除标签后再验证</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl label pod pod-stress region- zone- env- bussiness-</span></span><br><span class="line">pod/pod<span class="literal">-stress</span> labeled</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods --show-labels</span></span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">pod<span class="literal">-stress</span>    <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">16</span>m     &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p><strong>小结:</strong></p>
<ul>
<li>pod的label与node的label操作方式几乎相同</li>
<li>node的label用于pod调度到指定label的node节点</li>
<li>pod的label用于controller关联控制的pod</li>
</ul>
<h3 id="3-5-2-通过YAML创建Pod时添加标签"><a href="#3-5-2-通过YAML创建Pod时添加标签" class="headerlink" title="3.5.2 通过YAML创建Pod时添加标签"></a>3.5.2 通过YAML创建Pod时添加标签</h3><p>1, 修改yaml</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod1.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: pod<span class="literal">-stress</span></span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    env: dev</span><br><span class="line">    app: nginx				<span class="comment"># 直接在原来的yaml里加上多个标签</span></span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: c1</span><br><span class="line">    image: polinux/stress</span><br><span class="line">    command: [<span class="string">&quot;stress&quot;</span>]</span><br><span class="line">    args: [<span class="string">&quot;--vm&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;--vm-bytes&quot;</span>, <span class="string">&quot;150M&quot;</span>, <span class="string">&quot;--vm-hang&quot;</span>, <span class="string">&quot;1&quot;</span>]</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br></pre></td></tr></table></figure>

<p>2, 直接apply应用</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod1.yaml</span></span><br><span class="line">pod/pod<span class="literal">-stress1</span> configured			  <span class="comment"># 这里是configured,表示修改了</span></span><br></pre></td></tr></table></figure>

<p>3, 验证</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods --show-labels</span></span><br><span class="line">NAME          READY   STATUS             RESTARTS   AGE     LABELS</span><br><span class="line">pod<span class="literal">-stress</span>   <span class="number">1</span>/<span class="number">1</span>     Running            <span class="number">0</span>          <span class="number">3</span>m5s    app=nginx,env=dev		<span class="comment"># 标签有了</span></span><br></pre></td></tr></table></figure>





<h2 id="3-6-pod资源限制"><a href="#3-6-pod资源限制" class="headerlink" title="3.6 pod资源限制"></a>3.6 pod资源限制</h2><p>准备2个不同限制方式的创建pod的yaml文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod2.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: namespace1</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: pod<span class="literal">-stress2</span></span><br><span class="line">  namespace: namespace1</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: c1</span><br><span class="line">    image: polinux/stress</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    resources:</span><br><span class="line">      limits:</span><br><span class="line">        memory: <span class="string">&quot;200Mi&quot;</span></span><br><span class="line">      requests:</span><br><span class="line">        memory: <span class="string">&quot;100Mi&quot;</span></span><br><span class="line">    command: [<span class="string">&quot;stress&quot;</span>]				    <span class="comment"># 启动容器时执行的命令</span></span><br><span class="line">    args: [<span class="string">&quot;--vm&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;--vm-bytes&quot;</span>, <span class="string">&quot;150M&quot;</span>, <span class="string">&quot;--vm-hang&quot;</span>, <span class="string">&quot;1&quot;</span>]  <span class="comment"># 产生1个进程分配150M内存1秒后释放</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod3.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: namespace1</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: pod<span class="literal">-stress3</span></span><br><span class="line">  namespace: namespace1</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: c1</span><br><span class="line">    image: polinux/stress</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    resources:</span><br><span class="line">      limits:</span><br><span class="line">        memory: <span class="string">&quot;200Mi&quot;</span></span><br><span class="line">      requests:</span><br><span class="line">        memory: <span class="string">&quot;150Mi&quot;</span></span><br><span class="line">    command: [<span class="string">&quot;stress&quot;</span>]</span><br><span class="line">    args: [<span class="string">&quot;--vm&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;--vm-bytes&quot;</span>, <span class="string">&quot;250M&quot;</span>, <span class="string">&quot;--vm-hang&quot;</span>, <span class="string">&quot;1&quot;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod2.yml</span></span><br><span class="line">namespace/namespace1 created</span><br><span class="line">pod/pod<span class="literal">-stress2</span> created</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod3.yml</span></span><br><span class="line">namespace/namespace1 unchanged</span><br><span class="line">pod/pod<span class="literal">-stress3</span> created</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get namespace  |grep namespace1</span></span><br><span class="line">namespace1        Active   <span class="number">1</span>m28s</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod -n namespace1</span></span><br><span class="line">NAME          READY   STATUS      RESTARTS   AGE</span><br><span class="line">pod<span class="literal">-stress2</span>   <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">2</span>m2s</span><br><span class="line">pod<span class="literal">-stress3</span>   <span class="number">0</span>/<span class="number">1</span>     OOMKilled   <span class="number">4</span>          <span class="number">115</span>s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看会发现pod<span class="literal">-stress3</span>这个pod状态变为OOMKilled，因为它是内存不足所以显示Container被杀死</span><br></pre></td></tr></table></figure>

<p>说明:  一旦pod中的容器挂了，容器会有重启策略， 如下：</p>
<ul>
<li><p> Always：表示容器挂了总是重启，这是默认策略 </p>
</li>
<li><p> OnFailures：表容器状态为错误时才重启，也就是容器正常终止时才重启 </p>
</li>
<li><p> Never：表示容器挂了不予重启 </p>
</li>
<li><p> 对于Always这种策略，容器只要挂了，就会立即重启，这样是很耗费资源的。所以Always重启策略是这么做的：第一次容器挂了立即重启，如果再挂了就要延时10s重启，第三次挂了就等20s重启…… 依次类推 </p>
</li>
</ul>
<p>测试完后删除</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl delete ns namespace1</span></span><br></pre></td></tr></table></figure>



<h2 id="3-7-pod包含多个容器"><a href="#3-7-pod包含多个容器" class="headerlink" title="3.7 pod包含多个容器"></a>3.7 pod包含多个容器</h2><p>1, 准备yml文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod4.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: pod<span class="literal">-stress4</span></span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: c1</span><br><span class="line">    image: polinux/stress</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    resources:</span><br><span class="line">      limits:</span><br><span class="line">        memory: <span class="string">&quot;200Mi&quot;</span></span><br><span class="line">      requests:</span><br><span class="line">        memory: <span class="string">&quot;100Mi&quot;</span></span><br><span class="line">    command: [<span class="string">&quot;stress&quot;</span>]</span><br><span class="line">    args: [<span class="string">&quot;--vm&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;--vm-bytes&quot;</span>, <span class="string">&quot;150M&quot;</span>, <span class="string">&quot;--vm-hang&quot;</span>, <span class="string">&quot;1&quot;</span>]</span><br><span class="line">    </span><br><span class="line">  - name: c2</span><br><span class="line">    image: polinux/stress</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    resources:</span><br><span class="line">      limits:</span><br><span class="line">        memory: <span class="string">&quot;200Mi&quot;</span></span><br><span class="line">      requests:</span><br><span class="line">        memory: <span class="string">&quot;100Mi&quot;</span></span><br><span class="line">    command: [<span class="string">&quot;stress&quot;</span>]</span><br><span class="line">    args: [<span class="string">&quot;--vm&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;--vm-bytes&quot;</span>, <span class="string">&quot;150M&quot;</span>, <span class="string">&quot;--vm-hang&quot;</span>, <span class="string">&quot;1&quot;</span>]</span><br></pre></td></tr></table></figure>

<p> 2, 应用yml文件创建pod</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod4.yml</span></span><br><span class="line">pod/pod<span class="literal">-stress4</span> created</span><br></pre></td></tr></table></figure>

<p>3, 查看pod在哪个节点</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods  -o wide</span></span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">pod<span class="literal">-stress4</span>   <span class="number">2</span>/<span class="number">2</span>     Running   <span class="number">0</span>          <span class="number">70</span>s     <span class="number">10.244</span>.<span class="number">159.136</span>   k8s<span class="literal">-master1</span>   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">可以看到有<span class="number">2</span>个容器,运行在k8s<span class="literal">-master1</span>节点</span><br></pre></td></tr></table></figure>

<p>4,在k8s-master1上验证,确实产生了2个容器</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># docker ps -a |grep stress</span></span><br><span class="line">d7827a963f9d        df58d15b053d              <span class="string">&quot;stress --vm 1 --vm-…&quot;</span>   <span class="number">2</span> hours ago         Up <span class="number">2</span> hours                                      k8s_c2_pod<span class="literal">-stress4_default_a534bce1</span><span class="literal">-3ffe</span><span class="literal">-45f5</span><span class="literal">-8128</span><span class="literal">-34657e289b44_0</span></span><br><span class="line">ae8e8f8d095b        df58d15b053d              <span class="string">&quot;stress --vm 1 --vm-…&quot;</span>   <span class="number">2</span> hours ago         Up <span class="number">2</span> hours                                      k8s_c1_pod<span class="literal">-stress4_default_a534bce1</span><span class="literal">-3ffe</span><span class="literal">-45f5</span><span class="literal">-8128</span><span class="literal">-34657e289b44_0</span></span><br><span class="line">e66461900426        easzlab/pa<span class="built_in">use-amd64</span>:<span class="number">3.2</span>   <span class="string">&quot;/pause&quot;</span>                 <span class="number">2</span> hours ago         Up <span class="number">2</span> hours                                      k8s_POD_pod<span class="literal">-stress4_default_a534bce1</span><span class="literal">-3ffe</span><span class="literal">-45f5</span><span class="literal">-8128</span><span class="literal">-34657e289b44_0</span></span><br></pre></td></tr></table></figure>

<p> 或</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># crictl ps</span></span><br><span class="line">CONTAINER           IMAGE               CREATED             STATE               NAME                   ATTEMPT             POD ID</span><br><span class="line"><span class="number">08</span>cd23ac9b416       df58d15b053d1       <span class="number">2</span> hours ago         Running             c2                     <span class="number">0</span>                   <span class="number">2</span>dd084491f019</span><br><span class="line"><span class="number">65</span>f0ecba8dec3       df58d15b053d1       <span class="number">2</span> hours ago         Running             c1                     <span class="number">0</span>                   <span class="number">2</span>dd084491f019</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="3-8-对pod里的容器进行操作"><a href="#3-8-对pod里的容器进行操作" class="headerlink" title="3.8 对pod里的容器进行操作"></a>3.8 对pod里的容器进行操作</h2><h3 id="3-8-1-命令帮助"><a href="#3-8-1-命令帮助" class="headerlink" title="3.8.1 命令帮助"></a>3.8.1 命令帮助</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -h</span></span><br></pre></td></tr></table></figure>

<h3 id="3-8-2-不用交互直接执行命令"><a href="#3-8-2-不用交互直接执行命令" class="headerlink" title="3.8.2 不用交互直接执行命令"></a>3.8.2 不用交互直接执行命令</h3><p>格式为: <code>kubectl exec pod名 -c 容器名 -- 命令</code></p>
<p><strong>注意:</strong> </p>
<ul>
<li>-c 容器名为可选项,如果是1个pod中1个容器,则不用指定;</li>
<li>如果是1个pod中多个容器,不指定默认为第1个。</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec pod-stress4 -c c2  -- touch /111</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec pod-stress4 -c c2  -- ls /111</span></span><br><span class="line">/<span class="number">111</span></span><br></pre></td></tr></table></figure>

<p>不指定容器名,则默认为pod里的第1个容器</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec  pod-stress4  -- touch /222</span></span><br><span class="line">Defaulting container name to c1.</span><br><span class="line">Use <span class="string">&#x27;kubectl describe pod/pod-stress4 -n default&#x27;</span> to see all of the containers <span class="keyword">in</span> this pod.</span><br></pre></td></tr></table></figure>



<h3 id="3-8-3-和容器交互操作"><a href="#3-8-3-和容器交互操作" class="headerlink" title="3.8.3 和容器交互操作"></a>3.8.3 和容器交互操作</h3><p>和docker exec几乎一样</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it pod-stress4 -c c1 -- /bin/bash</span></span><br><span class="line">bash<span class="literal">-5</span>.<span class="number">0</span><span class="comment"># touch /333</span></span><br><span class="line">bash<span class="literal">-5</span>.<span class="number">0</span><span class="comment"># ls</span></span><br><span class="line"><span class="number">222</span>    bin    etc    lib    mnt    proc   run    srv    tmp    var</span><br><span class="line"><span class="number">333</span>    dev    home   media  opt    root   sbin   sys    usr</span><br><span class="line">bash<span class="literal">-5</span>.<span class="number">0</span><span class="comment"># exit</span></span><br><span class="line"><span class="keyword">exit</span>	   </span><br></pre></td></tr></table></figure>





<h2 id="3-9-验证pod中多个容器网络共享"><a href="#3-9-验证pod中多个容器网络共享" class="headerlink" title="3.9 验证pod中多个容器网络共享"></a>3.9 验证pod中多个容器网络共享</h2><p>1, 编写YAML</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod-nginx.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx2</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: c1</span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line"></span><br><span class="line">  - name: c2</span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br></pre></td></tr></table></figure>

<p>2, 应用YAML</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod-nginx.yaml</span></span><br><span class="line">pod/nginx2 created</span><br></pre></td></tr></table></figure>

<p>3, 查看pod信息与状态</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl describe pod nginx2</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">Events:</span><br><span class="line">  <span class="built_in">Type</span>    Reason     Age              From               Message</span><br><span class="line">  ----    ------     ----             ----               -------</span><br><span class="line">  Normal  Scheduled  <span class="number">25</span>s              default<span class="literal">-scheduler</span>  Successfully assigned default/nginx2 to k8s<span class="literal">-worker1</span></span><br><span class="line">  Normal  Pulling    <span class="number">24</span>s              kubelet            Pulling image <span class="string">&quot;nginx:1.15-alpine&quot;</span></span><br><span class="line">  Normal  Pulled     <span class="number">5</span>s               kubelet            Successfully pulled image <span class="string">&quot;nginx:1.15-alpine&quot;</span> <span class="keyword">in</span> <span class="number">18.928009025</span>s</span><br><span class="line">  Normal  Created    <span class="number">5</span>s               kubelet            Created container c1</span><br><span class="line">  Normal  Started    <span class="number">5</span>s               kubelet            Started container c1</span><br><span class="line">  Normal  Pulled     <span class="number">2</span>s (x2 over <span class="number">5</span>s)  kubelet            Container image <span class="string">&quot;nginx:1.15-alpine&quot;</span> already present on machine</span><br><span class="line">  Normal  Created    <span class="number">2</span>s (x2 over <span class="number">5</span>s)  kubelet            Created container c2</span><br><span class="line">  Normal  Started    <span class="number">2</span>s (x2 over <span class="number">5</span>s)  kubelet            Started container c2</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods |grep nginx2</span></span><br><span class="line">nginx2   <span class="number">1</span>/<span class="number">2</span>     CrashLoopBackOff   <span class="number">3</span>          <span class="number">2</span>m40s</span><br><span class="line">有一个启不来，因为一个容器中两个pod是共用网络的，所以不能两个都占用<span class="number">80</span>端口</span><br></pre></td></tr></table></figure>

<p>有一个启不来，因为一个pod中两个容器是共用网络的，所以不能两个都占用80端口</p>
<p>通过查找<code>k8s-worker1</code>上面的容器，然后<code>docker logs或crictl logs containerID</code>查看，得到如下的报错，说明是端口被占用</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">worker1</span> ~]<span class="comment"># docker logs k8s_c2_nginx2_default_51fd8e81-1c4b-4557-9498-9b25ed8a4c99_4</span></span><br><span class="line"><span class="number">2020</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">12</span> [<span class="type">emerg</span>] <span class="number">1</span><span class="comment">#1: bind() to 0.0.0.0:80 failed (98: Address in use)</span></span><br><span class="line">nginx: <span class="function">[<span class="type">emerg</span>] <span class="title">bind</span></span>() to <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">80</span> failed (<span class="number">98</span>: Address <span class="keyword">in</span> use)</span><br><span class="line"><span class="number">2020</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">12</span> [<span class="type">emerg</span>] <span class="number">1</span><span class="comment">#1: bind() to 0.0.0.0:80 failed (98: Address in use)</span></span><br><span class="line">nginx: <span class="function">[<span class="type">emerg</span>] <span class="title">bind</span></span>() to <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">80</span> failed (<span class="number">98</span>: Address <span class="keyword">in</span> use)</span><br><span class="line"><span class="number">2020</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">12</span> [<span class="type">emerg</span>] <span class="number">1</span><span class="comment">#1: bind() to 0.0.0.0:80 failed (98: Address in use)</span></span><br><span class="line">nginx: <span class="function">[<span class="type">emerg</span>] <span class="title">bind</span></span>() to <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">80</span> failed (<span class="number">98</span>: Address <span class="keyword">in</span> use)</span><br><span class="line"><span class="number">2020</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">12</span> [<span class="type">emerg</span>] <span class="number">1</span><span class="comment">#1: bind() to 0.0.0.0:80 failed (98: Address in use)</span></span><br><span class="line">nginx: <span class="function">[<span class="type">emerg</span>] <span class="title">bind</span></span>() to <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">80</span> failed (<span class="number">98</span>: Address <span class="keyword">in</span> use)</span><br><span class="line"><span class="number">2020</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">12</span> [<span class="type">emerg</span>] <span class="number">1</span><span class="comment">#1: bind() to 0.0.0.0:80 failed (98: Address in use)</span></span><br><span class="line">nginx: <span class="function">[<span class="type">emerg</span>] <span class="title">bind</span></span>() to <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">80</span> failed (<span class="number">98</span>: Address <span class="keyword">in</span> use)</span><br><span class="line"><span class="number">2020</span>/<span class="number">11</span>/<span class="number">21</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">12</span> [<span class="type">emerg</span>] <span class="number">1</span><span class="comment">#1: still could not bind()</span></span><br><span class="line">nginx: [<span class="type">emerg</span>] still could not bind()</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="四、pod调度"><a href="#四、pod调度" class="headerlink" title="四、pod调度"></a>四、pod调度</h1><h2 id="4-1-pod调度流程"><a href="#4-1-pod调度流程" class="headerlink" title="4.1 pod调度流程"></a>4.1 pod调度流程</h2><p><img src="/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/pod%E8%B0%83%E5%BA%A6.png" alt="1564985023369"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Step1</span><br><span class="line">通过kubectl命令应用资源清单文件（yaml格式）向api server 发起一个create pod 请求</span><br><span class="line"></span><br><span class="line">Step2</span><br><span class="line">api server接收到pod创建请求后，生成一个包含创建信息资源清单文件</span><br><span class="line"></span><br><span class="line">Step3</span><br><span class="line">apiserver 将资源清单文件中信息写入etcd数据库</span><br><span class="line"></span><br><span class="line">Step4</span><br><span class="line">Scheduler启动后会一直watch API Server，获取 podSpec.NodeName为空的Pod,即判断pod.spec.Node == null? 若为null，表示这个Pod请求是新的，需要创建，因此先进行调度计算（共计<span class="number">2</span>步：<span class="number">1</span>、过滤不满足条件的，<span class="number">2</span>、选择优先级高的），找到合适的node，然后将信息在etcd数据库中更新分配结果：pod.spec.Node = nodeA (设置一个具体的节点)</span><br><span class="line"></span><br><span class="line">Step5</span><br><span class="line">kubelet 通过watch etcd数据库(即不停地看etcd中的记录)，发现有新的Node出现，如果这条记录中的Node与所在节点编号相同，即这个Pod由scheduler分配给自己，则调用node中的Container Runtime，进而创建container，并将创建后的结果返回到给api server用于更新etcd数据库中数据状态。</span><br></pre></td></tr></table></figure>





<h2 id="4-2-调度约束方法"><a href="#4-2-调度约束方法" class="headerlink" title="4.2 调度约束方法"></a>4.2 调度约束方法</h2><p>我们为了实现容器主机资源平衡使用, 可以使用约束把pod调度到指定的node节点</p>
<ul>
<li>nodeName 用于将pod调度到指定的node名称上</li>
<li>nodeSelector 用于将pod调度到匹配Label的node上</li>
</ul>
<h3 id="4-2-1-nodeName"><a href="#4-2-1-nodeName" class="headerlink" title="4.2.1  nodeName"></a>4.2.1  nodeName</h3><p>1, 编写YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod-nodename.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: pod<span class="literal">-nodename</span></span><br><span class="line">spec:</span><br><span class="line">  nodeName: k8s<span class="literal">-worker1</span>                    <span class="comment"># 通过nodeName调度到k8s-worker1节点</span></span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx</span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br></pre></td></tr></table></figure>

<p>2, 应用YAML文件创建pod</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod-nodename.yml</span></span><br><span class="line">pod/pod<span class="literal">-nodename</span> created</span><br></pre></td></tr></table></figure>

<p>3, 验证</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl describe pod pod-nodename |tail -6</span></span><br><span class="line">Events:</span><br><span class="line">  <span class="built_in">Type</span>    Reason   Age    From     Message</span><br><span class="line">  ----    ------   ----   ----     -------</span><br><span class="line">  Normal  Pulled   <span class="number">2</span>m47s  kubelet  Container image <span class="string">&quot;nginx:1.15-alpine&quot;</span> already present on machine</span><br><span class="line">  Normal  Created  <span class="number">2</span>m47s  kubelet  Created container nginx</span><br><span class="line">  Normal  Started  <span class="number">2</span>m47s  kubelet  Started container nginx</span><br><span class="line"></span><br><span class="line">倒数第<span class="number">3</span>行没有使用scheduler,而是直接给运行了,说明nodeName约束生效</span><br></pre></td></tr></table></figure>

<h3 id="4-2-2-nodeSelector"><a href="#4-2-2-nodeSelector" class="headerlink" title="4.2.2 nodeSelector"></a>4.2.2 nodeSelector</h3><p>1, 为k8s-worker1打标签</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl label nodes k8s-worker1 bussiness=game</span></span><br><span class="line">node/k8s<span class="literal">-worker1</span> labeled</span><br></pre></td></tr></table></figure>

<p>2, 编写YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod-nodeselector.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: pod<span class="literal">-nodeselect</span></span><br><span class="line">spec:</span><br><span class="line">  nodeSelector:                         <span class="comment"># nodeSelector节点选择器</span></span><br><span class="line">    bussiness: game                     <span class="comment"># 指定调度到标签为bussiness=game的节点</span></span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx</span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br></pre></td></tr></table></figure>

<p>3,  应用YAML文件创建pod</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod-nodeselector.yml</span></span><br><span class="line">pod/pod<span class="literal">-nodeselect</span> created</span><br></pre></td></tr></table></figure>

<p>4, 验证</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl describe pod pod-nodeselect |tail -6</span></span><br><span class="line"> <span class="built_in">Type</span>    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  <span class="number">20</span>s   default<span class="literal">-scheduler</span>  Successfully assigned default/pod<span class="literal">-nodeselect</span> to k8s<span class="literal">-worker1</span></span><br><span class="line">  Normal  Pulled     <span class="number">19</span>s   kubelet            Container image <span class="string">&quot;nginx:1.15-alpine&quot;</span> already present on machine</span><br><span class="line">  Normal  Created    <span class="number">19</span>s   kubelet            Created container nginx</span><br><span class="line">  Normal  Started    <span class="number">19</span>s   kubelet            Started container nginx</span><br><span class="line"></span><br><span class="line">仍然经过了scheduler,但确实分配到了 k8s<span class="literal">-worker1</span>上</span><br></pre></td></tr></table></figure>

<p>有兴趣可以再删除后再创建,重复几次验证</p>
<h1 id="五、pod的生命周期"><a href="#五、pod的生命周期" class="headerlink" title="五、pod的生命周期"></a>五、pod的生命周期</h1><h2 id="5-1-Pod生命周期"><a href="#5-1-Pod生命周期" class="headerlink" title="5.1 Pod生命周期"></a>5.1 Pod生命周期</h2><ul>
<li>有些pod(比如运行httpd服务),正常情况下会一直运行中,但如果手动删除它,此pod会终止</li>
<li>也有些pod(比如执行计算任务)，任务计算完后就会自动终止</li>
</ul>
<p>上面两种场景中,pod从创建到终止的过程就是pod的生命周期。</p>
<p><img src="/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/pod%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt="pod生命周期"></p>
<h3 id="5-1-1-容器启动"><a href="#5-1-1-容器启动" class="headerlink" title="5.1.1 容器启动"></a>5.1.1 容器启动</h3><ol>
<li><p>pod中的容器在创建前,有初始化容器(init container)来进行初始化环境</p>
</li>
<li><p>初化完后,主容器(main container)开始启动</p>
</li>
<li><p>主容器启动后,有一个<strong>post start</strong>的操作(启动后的触发型操作,或者叫启动后钩子)</p>
</li>
<li><p>post start后,就开始做健康检查</p>
<ul>
<li><p>第一个健康检查叫存活状态检查(liveness probe )，用来检查主容器存活状态的</p>
</li>
<li><p>第二个健康检查叫准备就绪检查(readiness probe)，用来检查主容器是否启动就绪</p>
</li>
</ul>
</li>
</ol>
<h3 id="5-1-2-容器终止"><a href="#5-1-2-容器终止" class="headerlink" title="5.1.2 容器终止"></a>5.1.2 容器终止</h3><ol>
<li>可以在容器终止前设置<strong>pre stop</strong>操作(终止前的触发型操作,或者叫终止前钩子)</li>
<li>当出现特殊情况不能正常销毁pod时,大概等待30秒会强制终止</li>
<li>终止容器后还可能会重启容器(视容器重启策略而定)。</li>
</ol>
<h3 id="5-1-3-回顾容器重启策略"><a href="#5-1-3-回顾容器重启策略" class="headerlink" title="5.1.3 回顾容器重启策略"></a>5.1.3 回顾容器重启策略</h3><ul>
<li><p> Always：表示容器挂了总是重启，这是默认策略 </p>
</li>
<li><p> OnFailures：表示容器状态为错误时才重启，也就是容器正常终止时不重启 </p>
</li>
<li><p> Never：表示容器挂了不予重启 </p>
</li>
<li><p> 对于Always这种策略，容器只要挂了，就会立即重启，这样是很耗费资源的。所以Always重启策略是这么做的：第一次容器挂了立即重启，如果再挂了就要延时10s重启，第三次挂了就等20s重启…… 依次类推 </p>
</li>
</ul>
<h2 id="5-2-HealthCheck健康检查"><a href="#5-2-HealthCheck健康检查" class="headerlink" title="5.2 HealthCheck健康检查"></a>5.2 HealthCheck健康检查</h2><p>当Pod启动时，容器可能会因为某种错误(服务未启动或端口不正确)而无法访问等。</p>
<h3 id="5-2-1-Health-Check方式"><a href="#5-2-1-Health-Check方式" class="headerlink" title="5.2.1 Health Check方式"></a>5.2.1 Health Check方式</h3><p>kubelet拥有两个检测器，它们分别对应不同的触发器(根据触发器的结构执行进一步的动作)</p>
<table>
<thead>
<tr>
<th>方式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Liveness Probe(存活状态探测)</td>
<td>指示容器是否正在运行。如果存活态探测失败，则 kubelet 会杀死容器， 并且容器将根据其<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy">重启策略</a>决定未来。如果容器不提供存活探针， 则默认状态为 <code>Success</code>。</td>
</tr>
<tr>
<td>readiness Probe(就绪型探测)</td>
<td>指示容器是否准备好为请求提供服务。如果就绪态探测失败， 端点控制器将从与 Pod 匹配的所有服务的端点列表中删除该 Pod 的 IP 地址。 初始延迟之前的就绪态的状态值默认为 <code>Failure</code>。 如果容器不提供就绪态探针，则默认状态为 <code>Success</code>。注：检查后不健康，将容器设置为Notready;如果使用service来访问,流量不会转发给此种状态的pod</td>
</tr>
<tr>
<td>startup Probe</td>
<td>指示容器中的应用是否已经启动。如果提供了启动探针，则所有其他探针都会被 禁用，直到此探针成功为止。如果启动探测失败，<code>kubelet</code> 将杀死容器，而容器依其 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy">重启策略</a>进行重启。 如果容器没有提供启动探测，则默认状态为 <code>Success</code>。</td>
</tr>
</tbody></table>
<h3 id="5-2-2-Probe探测方式"><a href="#5-2-2-Probe探测方式" class="headerlink" title="5.2.2 Probe探测方式"></a>5.2.2 Probe探测方式</h3><table>
<thead>
<tr>
<th>方式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Exec</td>
<td>执行命令</td>
</tr>
<tr>
<td>HTTPGet</td>
<td>http请求某一个URL路径</td>
</tr>
<tr>
<td>TCP</td>
<td>tcp连接某一个端口</td>
</tr>
<tr>
<td>gRPC</td>
<td>使用 <a target="_blank" rel="noopener" href="https://grpc.io/">gRPC</a> 执行一个远程过程调用。 目标应该实现 <a target="_blank" rel="noopener" href="https://grpc.io/grpc/core/md_doc_health-checking.html">gRPC健康检查</a>。 如果响应的状态是 “SERVING”，则认为诊断成功。 gRPC 探针是一个 alpha 特性，只有在你启用了 “GRPCContainerProbe” <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/feature-gate/">特性门控</a>时才能使用。</td>
</tr>
</tbody></table>
<h3 id="5-2-3-liveness-exec案例"><a href="#5-2-3-liveness-exec案例" class="headerlink" title="5.2.3 liveness-exec案例"></a>5.2.3 liveness-exec案例</h3><p>1, 准备YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod-liveness-exec.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: liveness<span class="literal">-exec</span></span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: liveness</span><br><span class="line">    image: busybox</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    args:</span><br><span class="line">    - /bin/sh</span><br><span class="line">    - <span class="literal">-c</span></span><br><span class="line">    - touch /tmp/healthy; <span class="built_in">sleep</span> <span class="number">30</span>; <span class="built_in">rm</span> <span class="literal">-rf</span> /tmp/healthy; <span class="built_in">sleep</span> <span class="number">600</span></span><br><span class="line">    livenessProbe:</span><br><span class="line">      exec:</span><br><span class="line">        command:</span><br><span class="line">        - <span class="built_in">cat</span></span><br><span class="line">        - /tmp/healthy</span><br><span class="line">      initialDelaySeconds: <span class="number">5</span> 				<span class="comment"># pod启动延迟5秒后探测</span></span><br><span class="line">      periodSeconds: <span class="number">5</span> 						<span class="comment"># 每5秒探测1次</span></span><br></pre></td></tr></table></figure>

<p>2, 应用YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod-liveness-exec.yml</span></span><br></pre></td></tr></table></figure>

<p>3, 通过下面的命令观察</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl describe pod liveness-exec</span></span><br><span class="line">......</span><br><span class="line">Events:</span><br><span class="line">  <span class="built_in">Type</span>     Reason     Age   From               Message</span><br><span class="line">  ----     ------     ----  ----               -------</span><br><span class="line">  Normal   Scheduled  <span class="number">40</span>s   default<span class="literal">-scheduler</span>  Successfully assigned default/liveness<span class="literal">-exec</span> to k8s<span class="literal">-worker1</span></span><br><span class="line">  Normal   Pulled     <span class="number">38</span>s   kubelet    Container image <span class="string">&quot;busybox&quot;</span> already present on machine</span><br><span class="line">  Normal   Created    <span class="number">37</span>s   kubelet     Created container liveness</span><br><span class="line">  Normal   Started    <span class="number">37</span>s   kubelet     Started container liveness</span><br><span class="line">  Warning  Unhealthy  <span class="number">3</span>s    kubelet     Liveness probe failed: <span class="built_in">cat</span>: can<span class="string">&#x27;t open &#x27;</span>/tmp/healthy<span class="string">&#x27;: No such file or directory</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">看到40s前被调度以k8s-worker1节点,3s前健康检查出问题</span></span><br></pre></td></tr></table></figure>

<p>4, 过几分钟再观察</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl describe pod liveness-exec</span></span><br><span class="line">......</span><br><span class="line">Events:</span><br><span class="line">  <span class="built_in">Type</span>     Reason     Age                  From               Message</span><br><span class="line">  ----     ------     ----                 ----               -------</span><br><span class="line">  Normal   Scheduled  <span class="number">3</span>m42s                default<span class="literal">-scheduler</span>  Successfully assigned default/liveness<span class="literal">-exec</span> to k8s<span class="literal">-worker1</span></span><br><span class="line">  Normal   Pulled     <span class="number">70</span>s (x3 over <span class="number">3</span>m40s)  kubelet     Container image <span class="string">&quot;busybox&quot;</span> already present on machine</span><br><span class="line">  Normal   Created    <span class="number">70</span>s (x3 over <span class="number">3</span>m39s)  kubelet     Created container liveness</span><br><span class="line">  Normal   Started    <span class="number">69</span>s (x3 over <span class="number">3</span>m39s)  kubelet     Started container liveness</span><br><span class="line">  Warning  Unhealthy  <span class="number">26</span>s (x9 over <span class="number">3</span>m5s)   kubelet     Liveness probe failed: <span class="built_in">cat</span>: can<span class="string">&#x27;t open &#x27;</span>/tmp/healthy<span class="string">&#x27;: No such file or directory</span></span><br><span class="line"><span class="string">  Normal   Killing    26s (x3 over 2m55s)  kubelet     Container liveness failed liveness probe, will be restarted</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME            READY   STATUS    RESTARTS   AGE</span><br><span class="line">liveness<span class="literal">-exec</span>   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">3</span>          <span class="number">4</span>m12s</span><br><span class="line"></span><br><span class="line">看到重启<span class="number">3</span>次,慢慢地重启间隔时间会越来越长</span><br></pre></td></tr></table></figure>



<h3 id="拓展-容器重启策略验证"><a href="#拓展-容器重启策略验证" class="headerlink" title="拓展: 容器重启策略验证"></a>拓展: 容器重启策略验证</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: liveness<span class="literal">-exec</span></span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  restartPolicy: Never					<span class="comment"># 把容器重启策略由默认的always改为Never</span></span><br><span class="line">  containers:</span><br><span class="line">  - name: liveness</span><br><span class="line">    image: busybox</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    args:</span><br><span class="line">    - /bin/sh</span><br><span class="line">    - <span class="literal">-c</span></span><br><span class="line">    - touch /tmp/healthy; <span class="built_in">sleep</span> <span class="number">30</span>; <span class="built_in">rm</span> <span class="literal">-rf</span> /tmp/healthy; <span class="built_in">sleep</span> <span class="number">600</span></span><br><span class="line">    livenessProbe:</span><br><span class="line">      exec:</span><br><span class="line">        command:</span><br><span class="line">        - <span class="built_in">cat</span></span><br><span class="line">        - /tmp/healthy</span><br><span class="line">      initialDelaySeconds: <span class="number">5</span>                         </span><br><span class="line">      periodSeconds: <span class="number">5</span>                                 </span><br></pre></td></tr></table></figure>

<p>请自行验证</p>
<p>验证结果为:</p>
<ul>
<li>容器健康检查出现问题后，不再重启，也不会继续sleep 600秒，而是直接关闭了</li>
</ul>
<h3 id="5-2-4-liveness-httpget案例"><a href="#5-2-4-liveness-httpget案例" class="headerlink" title="5.2.4  liveness-httpget案例"></a>5.2.4  liveness-httpget案例</h3><p>1, 编写YMAL文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod-liveness-httpget.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: liveness<span class="literal">-httpget</span></span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: liveness</span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    ports:							    <span class="comment"># 指定容器端口，这一段不写也行，端口由镜像决定 </span></span><br><span class="line">    - name: http						<span class="comment"># 自定义名称，不需要与下面的port: http对应</span></span><br><span class="line">      containerPort: <span class="number">80</span>					<span class="comment"># 类似dockerfile里的expose 80</span></span><br><span class="line">    livenessProbe:</span><br><span class="line">      httpGet:                          <span class="comment"># 使用httpGet方式</span></span><br><span class="line">        port: http                      <span class="comment"># http协议,也可以直接写80端口</span></span><br><span class="line">        path: /index.html               <span class="comment"># 探测家目录下的index.html</span></span><br><span class="line">      initialDelaySeconds: <span class="number">3</span>            <span class="comment"># 延迟3秒开始探测</span></span><br><span class="line">      periodSeconds: <span class="number">5</span>                  <span class="comment"># 每隔5s钟探测一次</span></span><br></pre></td></tr></table></figure>

<p>2, 应用YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod-liveness-httpget.yml</span></span><br></pre></td></tr></table></figure>

<p>3, 验证查看</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods</span></span><br><span class="line">NAME               READY   STATUS             RESTARTS   AGE</span><br><span class="line">liveness<span class="literal">-httpget</span>   <span class="number">1</span>/<span class="number">1</span>     Running            <span class="number">0</span>          <span class="number">9</span>s</span><br></pre></td></tr></table></figure>

<p>4, 交互删除nginx里的主页文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it liveness-httpget -- rm -rf /usr/share/nginx/html/index.html</span></span><br></pre></td></tr></table></figure>

<p>5, 验证查看会发现</p>
<p><img src="/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/liveness-httpget.png" alt="1564975961146"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME               READY   STATUS    RESTARTS   AGE</span><br><span class="line">liveness<span class="literal">-httpget</span>   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">11</span>m</span><br><span class="line"></span><br><span class="line">只restart一次</span><br></pre></td></tr></table></figure>



<h3 id="5-2-5-liveness-tcp案例"><a href="#5-2-5-liveness-tcp案例" class="headerlink" title="5.2.5  liveness-tcp案例"></a>5.2.5  liveness-tcp案例</h3><p>1, 编写YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod-liveness-tcp.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: liveness<span class="literal">-tcp</span></span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: liveness</span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    ports:</span><br><span class="line">    - name: http</span><br><span class="line">      containerPort: <span class="number">80</span></span><br><span class="line">    livenessProbe:</span><br><span class="line">      tcpSocket:                        <span class="comment"># 使用tcp连接方式</span></span><br><span class="line">        port: <span class="number">80</span>                        <span class="comment"># 连接80端口进行探测</span></span><br><span class="line">      initialDelaySeconds: <span class="number">3</span></span><br><span class="line">      periodSeconds: <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>2, 应用YAML文件创建pod</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod-liveness-tcp.yml</span></span><br><span class="line">pod/liveness<span class="literal">-tcp</span> created</span><br></pre></td></tr></table></figure>

<p>3, 查看验证</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME               READY   STATUS             RESTARTS   AGE</span><br><span class="line">liveness<span class="literal">-tcp</span>       <span class="number">1</span>/<span class="number">1</span>     Running            <span class="number">0</span>          <span class="number">14</span>s</span><br></pre></td></tr></table></figure>

<p>4, 交互关闭nginx</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it liveness-tcp -- /usr/sbin/nginx -s stop</span></span><br></pre></td></tr></table></figure>

<p>5, 再次验证查看</p>
<p><img src="/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/liveness-tcp.png" alt="1564976660465"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME               READY   STATUS    RESTARTS   AGE</span><br><span class="line">liveness<span class="literal">-tcp</span>       <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">1</span>          <span class="number">5</span>m13s</span><br><span class="line"></span><br><span class="line">也只重启<span class="number">1</span>次,重启后重新初始化了</span><br></pre></td></tr></table></figure>



<h3 id="5-2-6-readiness案例"><a href="#5-2-6-readiness案例" class="headerlink" title="5.2.6 readiness案例"></a>5.2.6 readiness案例</h3><p>1, 编写YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod-readiness-httpget.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: readiness<span class="literal">-httpget</span></span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: readiness</span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    ports:</span><br><span class="line">    - name: http</span><br><span class="line">      containerPort: <span class="number">80</span></span><br><span class="line">    readinessProbe:                     <span class="comment"># 这里由liveness换成了readiness</span></span><br><span class="line">      httpGet:</span><br><span class="line">        port: http</span><br><span class="line">        path: /index.html</span><br><span class="line">      initialDelaySeconds: <span class="number">3</span></span><br><span class="line">      periodSeconds: <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>2, 应用YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod-readiness-httpget.yml</span></span><br><span class="line">pod/readiness<span class="literal">-httpget</span> created</span><br></pre></td></tr></table></figure>

<p>3, 验证查看</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME                READY   STATUS             RESTARTS   AGE</span><br><span class="line">readiness<span class="literal">-httpget</span>   <span class="number">1</span>/<span class="number">1</span>     Running            <span class="number">0</span>          <span class="number">10</span>s</span><br></pre></td></tr></table></figure>

<p>4, 交互删除nginx主页</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it readiness-httpget -- rm -rf /usr/share/nginx/html/index.html</span></span><br></pre></td></tr></table></figure>

<p>5, 再次验证</p>
<p><img src="/images/Kubernetes/kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5Pod.assets/readiness-httpget.png" alt="1564978173894"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME                READY   STATUS    RESTARTS   AGE</span><br><span class="line">readiness<span class="literal">-httpget</span>   <span class="number">0</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">2</span>m49s</span><br><span class="line"></span><br><span class="line">READY状态为<span class="number">0</span>/<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>6, 交互创建nginx主页文件再验证</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it readiness-httpget -- touch /usr/share/nginx/html/index.html</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME                READY   STATUS             RESTARTS   AGE</span><br><span class="line">readiness<span class="literal">-httpget</span>   <span class="number">1</span>/<span class="number">1</span>     Running            <span class="number">0</span>          <span class="number">3</span>m10s</span><br><span class="line"></span><br><span class="line">READY状态又为<span class="number">1</span>/<span class="number">1</span>了</span><br></pre></td></tr></table></figure>

<h3 id="5-2-7-readiness-liveness综合案例"><a href="#5-2-7-readiness-liveness综合案例" class="headerlink" title="5.2.7 readiness+liveness综合案例"></a>5.2.7 readiness+liveness综合案例</h3><p>1, 编写YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod-readiness-liveiness.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: readiness<span class="literal">-liveness</span><span class="literal">-httpget</span></span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: readiness<span class="literal">-liveness</span></span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    ports:</span><br><span class="line">    - name: http</span><br><span class="line">      containerPort: <span class="number">80</span></span><br><span class="line">    livenessProbe:</span><br><span class="line">      httpGet:</span><br><span class="line">        port: http</span><br><span class="line">        path: /index.html</span><br><span class="line">      initialDelaySeconds: <span class="number">1</span></span><br><span class="line">      periodSeconds: <span class="number">3</span></span><br><span class="line">    readinessProbe:</span><br><span class="line">      httpGet:</span><br><span class="line">        port: http</span><br><span class="line">        path: /index.html</span><br><span class="line">      initialDelaySeconds: <span class="number">5</span></span><br><span class="line">      periodSeconds: <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>2, 应用YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod-readiness-liveiness.yml</span></span><br><span class="line">pod/readiness<span class="literal">-liveness</span><span class="literal">-httpget</span> created</span><br></pre></td></tr></table></figure>

<p>3, 验证</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pod |grep readiness-liveness-httpget</span></span><br><span class="line">NAME                         READY   STATUS             RESTARTS   AGE</span><br><span class="line">readiness<span class="literal">-liveness</span><span class="literal">-httpget</span>   <span class="number">0</span>/<span class="number">1</span>     Running            <span class="number">0</span>          <span class="number">6</span>s</span><br></pre></td></tr></table></figure>





<h2 id="5-3-post-start"><a href="#5-3-post-start" class="headerlink" title="5.3 post-start"></a>5.3 post-start</h2><p>1, 编写YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim pod-poststart.yml</span></span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: poststart</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: poststart</span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    lifecycle:                                       <span class="comment"># 生命周期事件</span></span><br><span class="line">      postStart:</span><br><span class="line">        exec:</span><br><span class="line">          command: [<span class="string">&quot;mkdir&quot;</span>,<span class="string">&quot;-p&quot;</span>,<span class="string">&quot;/usr/share/nginx/html/haha&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>2, 应用YMAL文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f pod-poststart.yml</span></span><br></pre></td></tr></table></figure>

<p>3, 验证</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods</span></span><br><span class="line">NAME                         READY   STATUS             RESTARTS   AGE</span><br><span class="line">poststart                    <span class="number">1</span>/<span class="number">1</span>     Running            <span class="number">0</span>          <span class="number">25</span>s</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it poststart -- ls /usr/share/nginx/html -l</span></span><br><span class="line">total <span class="number">8</span></span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root <span class="number">494</span> Apr <span class="number">16</span> <span class="number">13</span>:<span class="number">08</span> <span class="number">50</span>x.html</span><br><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span> <span class="number">2</span> root root   <span class="number">6</span> Aug  <span class="number">5</span> <span class="number">05</span>:<span class="number">33</span> haha			有创建此目录</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>-- <span class="number">1</span> root root <span class="number">612</span> Apr <span class="number">16</span> <span class="number">13</span>:<span class="number">08</span> index.html</span><br></pre></td></tr></table></figure>

<h2 id="5-4-pre-stop"><a href="#5-4-pre-stop" class="headerlink" title="5.4 pre-stop"></a>5.4 pre-stop</h2><p>容器终止前执行的命令</p>
<p>1, 编写YAML文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim prestop.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: prestop</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: prestop</span><br><span class="line">    image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    lifecycle:                                       <span class="comment"># 生命周期事件</span></span><br><span class="line">      preStop:                                       <span class="comment"># preStop</span></span><br><span class="line">        exec:</span><br><span class="line">          command: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;sleep 60000000&quot;</span>]     <span class="comment"># 容器终止前sleep 60000000秒</span></span><br></pre></td></tr></table></figure>

<p>2, 应用YAML文件创建pod</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f prestop.yml</span></span><br><span class="line">pod/prestop created</span><br></pre></td></tr></table></figure>

<p>3, 删除pod验证</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl delete -f prestop.yml</span></span><br><span class="line">pod <span class="string">&quot;prestop&quot;</span> deleted		会在这一步等待一定的时间(大概<span class="number">30</span>s<span class="literal">-60s</span>左右)才能删除,说明验证成功</span><br></pre></td></tr></table></figure>

<p><strong>结论:</strong> 当出现特殊情况不能正常销毁pod时,大概等待30秒会强制终止</p>
<h2 id="5-5-pod故障排除"><a href="#5-5-pod故障排除" class="headerlink" title="5.5 pod故障排除"></a>5.5 pod故障排除</h2><table>
<thead>
<tr>
<th>状态</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Pending（悬决）</td>
<td>Pod 已被 Kubernetes 系统接受，但有一个或者多个容器尚未创建亦未运行。此阶段包括等待 Pod 被调度的时间和通过网络下载镜像的时间。</td>
</tr>
<tr>
<td>Running（运行中）</td>
<td>pod已经绑定到一个节点，并且已经创建了所有容器。至少有一个容器正在运行中，或正在启动或重新启动。</td>
</tr>
<tr>
<td>completed（完成）</td>
<td>Pod中的所有容器都已成功终止，不会重新启动。</td>
</tr>
<tr>
<td>Failed（失败）</td>
<td>Pod的所有容器均已终止，且至少有一个容器已在故障中终止。也就是说，容器要么以非零状态退出，要么被系统终止。</td>
</tr>
<tr>
<td>Unknown（未知）</td>
<td>由于某种原因apiserver无法获得Pod的状态，通常是由于Master与Pod所在主机kubelet通信时出错。</td>
</tr>
<tr>
<td>CrashLoopBackOff</td>
<td>多见于CMD语句错误或者找不到container入口语句导致了快速退出,可以用kubectl logs 查看日志进行排错</td>
</tr>
</tbody></table>
<ul>
<li>kubectl describe pod  pod名</li>
<li>kubectl logs pod  [-c CONTAINER]</li>
<li>kubectl exec POD [-c CONTAINER] –COMMAND [args…]</li>
</ul>

  </div>
</article>





    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>  
    <div id="vcomments" class="blog-post-comments"></div>
    <script>        
        new Valine({
            el: '#vcomments',
            visitor: true,
            appId: 'gqmHGHyrnzRPUSxqADLhUzlT-gzGzoHsz',
            appKey: 'q8uQ7rKeukTuQ3L35peaOhkC',
            placeholder: '好哥哥，说几句吧！',
            avatar: 'retro'
        })
    </script>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-workloads"><span class="toc-number">1.</span> <span class="toc-text">一、工作负载(workloads)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81pod%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">二、pod介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-pod%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%88%86%E7%B1%BB"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 pod定义与分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-Pod%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 Pod定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-Pod%E5%88%86%E7%B1%BB"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 Pod分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%9F%A5%E7%9C%8Bpod%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 查看pod方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-pod%E7%9A%84YAML%E8%B5%84%E6%BA%90%E6%B8%85%E5%8D%95%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 pod的YAML资源清单格式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81pod%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%AA%8C%E8%AF%81"><span class="toc-number">3.</span> <span class="toc-text">三、pod创建与验证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BApod-v1-18%E5%8F%98%E5%8C%96"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 命令创建pod(v1.18变化)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BApod-nginx%E7%9A%84pod"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 创建一个名为pod-nginx的pod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E9%AA%8C%E8%AF%81"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-YAML%E5%88%9B%E5%BB%BApod"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 YAML创建pod</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%87%86%E5%A4%87yaml%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 准备yaml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E6%9F%A5%E7%9C%8Bpod%E4%BF%A1%E6%81%AF"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 查看pod信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%88%A0%E9%99%A4pod"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 删除pod</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E5%8D%95%E4%B8%AApod%E5%88%A0%E9%99%A4"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 单个pod删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E5%A4%9A%E4%B8%AApod%E5%88%A0%E9%99%A4"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 多个pod删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96%E7%AD%96%E7%95%A5"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 镜像拉取策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-pod%E7%9A%84%E6%A0%87%E7%AD%BE"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 pod的标签</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E7%AE%A1%E7%90%86Pod%E6%A0%87%E7%AD%BE"><span class="toc-number">3.5.1.</span> <span class="toc-text">3.5.1 通过命令管理Pod标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-%E9%80%9A%E8%BF%87YAML%E5%88%9B%E5%BB%BAPod%E6%97%B6%E6%B7%BB%E5%8A%A0%E6%A0%87%E7%AD%BE"><span class="toc-number">3.5.2.</span> <span class="toc-text">3.5.2 通过YAML创建Pod时添加标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-pod%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 pod资源限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-pod%E5%8C%85%E5%90%AB%E5%A4%9A%E4%B8%AA%E5%AE%B9%E5%99%A8"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 pod包含多个容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E5%AF%B9pod%E9%87%8C%E7%9A%84%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="toc-number">3.8.</span> <span class="toc-text">3.8 对pod里的容器进行操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-1-%E5%91%BD%E4%BB%A4%E5%B8%AE%E5%8A%A9"><span class="toc-number">3.8.1.</span> <span class="toc-text">3.8.1 命令帮助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-2-%E4%B8%8D%E7%94%A8%E4%BA%A4%E4%BA%92%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.8.2.</span> <span class="toc-text">3.8.2 不用交互直接执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-3-%E5%92%8C%E5%AE%B9%E5%99%A8%E4%BA%A4%E4%BA%92%E6%93%8D%E4%BD%9C"><span class="toc-number">3.8.3.</span> <span class="toc-text">3.8.3 和容器交互操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-9-%E9%AA%8C%E8%AF%81pod%E4%B8%AD%E5%A4%9A%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%85%B1%E4%BA%AB"><span class="toc-number">3.9.</span> <span class="toc-text">3.9 验证pod中多个容器网络共享</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81pod%E8%B0%83%E5%BA%A6"><span class="toc-number">4.</span> <span class="toc-text">四、pod调度</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-pod%E8%B0%83%E5%BA%A6%E6%B5%81%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 pod调度流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E8%B0%83%E5%BA%A6%E7%BA%A6%E6%9D%9F%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 调度约束方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-nodeName"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1  nodeName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-nodeSelector"><span class="toc-number">4.2.2.</span> <span class="toc-text">4.2.2 nodeSelector</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81pod%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">5.</span> <span class="toc-text">五、pod的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Pod%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 Pod生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8"><span class="toc-number">5.1.1.</span> <span class="toc-text">5.1.1 容器启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-%E5%AE%B9%E5%99%A8%E7%BB%88%E6%AD%A2"><span class="toc-number">5.1.2.</span> <span class="toc-text">5.1.2 容器终止</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-%E5%9B%9E%E9%A1%BE%E5%AE%B9%E5%99%A8%E9%87%8D%E5%90%AF%E7%AD%96%E7%95%A5"><span class="toc-number">5.1.3.</span> <span class="toc-text">5.1.3 回顾容器重启策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-HealthCheck%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 HealthCheck健康检查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-Health-Check%E6%96%B9%E5%BC%8F"><span class="toc-number">5.2.1.</span> <span class="toc-text">5.2.1 Health Check方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-Probe%E6%8E%A2%E6%B5%8B%E6%96%B9%E5%BC%8F"><span class="toc-number">5.2.2.</span> <span class="toc-text">5.2.2 Probe探测方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-liveness-exec%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.3.</span> <span class="toc-text">5.2.3 liveness-exec案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95-%E5%AE%B9%E5%99%A8%E9%87%8D%E5%90%AF%E7%AD%96%E7%95%A5%E9%AA%8C%E8%AF%81"><span class="toc-number">5.2.4.</span> <span class="toc-text">拓展: 容器重启策略验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-4-liveness-httpget%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.5.</span> <span class="toc-text">5.2.4  liveness-httpget案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-5-liveness-tcp%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.6.</span> <span class="toc-text">5.2.5  liveness-tcp案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-6-readiness%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.7.</span> <span class="toc-text">5.2.6 readiness案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-7-readiness-liveness%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.8.</span> <span class="toc-text">5.2.7 readiness+liveness综合案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-post-start"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 post-start</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-pre-stop"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 pre-stop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-pod%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="toc-number">5.5.</span> <span class="toc-text">5.5 pod故障排除</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&text=Kubernetes集群核心概念 Pod"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&is_video=false&description=Kubernetes集群核心概念 Pod"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kubernetes集群核心概念 Pod&body=Check out this article: https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&title=Kubernetes集群核心概念 Pod"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://fate-re-zero.github.io/2024/02/16/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%20Pod/&name=Kubernetes集群核心概念 Pod&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">2025 祥祥要起飞</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>


<script src="/lib/particles/particles.min.js"></script>


<script src="/lib/typing/typing.min.js"></script>


<script src="/js/main.js"></script>


<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


