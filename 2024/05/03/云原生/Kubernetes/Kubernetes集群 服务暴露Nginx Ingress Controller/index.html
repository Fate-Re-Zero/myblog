<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="一、ingress控制器1.1 ingress控制器作用ingress controller可以为kubernetes 集群外用户访问Kubernetes集群内部pod提供代理服务。  提供全局访问代理 访问流程 用户–&gt;ingress controller–&gt;service–&gt;pod      1.2 ingress控制器种类1.2.1 Kubernetes Ingress C">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes集群服务暴露Nginx Ingress Controller">
<meta property="og:url" content="https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/index.html">
<meta property="og:site_name" content="祥祥要起飞">
<meta property="og:description" content="一、ingress控制器1.1 ingress控制器作用ingress controller可以为kubernetes 集群外用户访问Kubernetes集群内部pod提供代理服务。  提供全局访问代理 访问流程 用户–&gt;ingress controller–&gt;service–&gt;pod      1.2 ingress控制器种类1.2.1 Kubernetes Ingress C">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412223010688.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412222951979.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412213345991.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412223933840.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412224751513.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412224823931.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220413013418685.png">
<meta property="og:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220413013457091.png">
<meta property="article:published_time" content="2024-05-03T00:40:46.000Z">
<meta property="article:modified_time" content="2025-04-24T15:08:06.234Z">
<meta property="article:author" content="祥祥要起飞">
<meta property="article:tag" content="Kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fate-re-zero.github.io/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412223010688.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Kubernetes集群服务暴露Nginx Ingress Controller</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="祥祥要起飞" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2024/07/08/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E7%BC%93%E5%AD%98%E4%BF%9D%E9%9A%9C%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E4%BA%94%E7%A7%8D%E5%81%9A%E6%B3%95/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2024/04/21/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/kubernetes%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E5%8D%B7/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&text=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&is_video=false&description=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kubernetes集群服务暴露Nginx Ingress Controller&body=Check out this article: https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&name=Kubernetes集群服务暴露Nginx Ingress Controller&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81ingress%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">一、ingress控制器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-ingress%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%9C%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 ingress控制器作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-ingress%E6%8E%A7%E5%88%B6%E5%99%A8%E7%A7%8D%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 ingress控制器种类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-Kubernetes-Ingress-Controller"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 Kubernetes Ingress Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-NGINX-Ingress-Controller"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 NGINX Ingress Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-Kong-Ingress"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 Kong Ingress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-Traefik"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 Traefik</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-HAProxy-Ingress"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5 HAProxy Ingress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-6-Voyager"><span class="toc-number">1.2.6.</span> <span class="toc-text">1.2.6 Voyager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-7-Contour"><span class="toc-number">1.2.7.</span> <span class="toc-text">1.2.7 Contour</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-8-Istio-Ingress"><span class="toc-number">1.2.8.</span> <span class="toc-text">1.2.8 Istio Ingress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-9-Ambassador"><span class="toc-number">1.2.9.</span> <span class="toc-text">1.2.9 Ambassador</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-10-Gloo"><span class="toc-number">1.2.10.</span> <span class="toc-text">1.2.10 Gloo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-11-Skipper"><span class="toc-number">1.2.11.</span> <span class="toc-text">1.2.11 Skipper</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81nginx-ingress-controller"><span class="toc-number">2.</span> <span class="toc-text">二、nginx ingress controller</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-nginx-ingress-controller%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 nginx ingress controller位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-nginx-ingress-controller%E9%83%A8%E7%BD%B2"><span class="toc-number">2.2.</span> <span class="toc-text">2.2  nginx ingress controller部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E4%B8%8B%E8%BD%BD%E5%B9%B6%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 下载并修改配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E5%BA%94%E7%94%A8%E8%B5%84%E6%BA%90%E6%B8%85%E5%8D%95%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 应用资源清单文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E9%AA%8C%E8%AF%81%E9%83%A8%E7%BD%B2%E7%BB%93%E6%9E%9C"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 验证部署结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-ingress%E5%AF%B9%E8%B1%A1%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 ingress对象应用案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-ingress-http%E6%A1%88%E4%BE%8B"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3 1 ingress-http案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-1-%E5%88%9B%E5%BB%BAdeployment%E6%8E%A7%E5%88%B6%E5%99%A8%E7%B1%BB%E5%9E%8B%E5%BA%94%E7%94%A8"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">2.3.1.1 创建deployment控制器类型应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-2-%E5%88%9B%E5%BB%BAservice"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">2.3.1.2 创建service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-3-%E5%88%9B%E5%BB%BAingress%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">2.3.1.3 创建ingress对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-4-%E6%A8%A1%E6%8B%9F%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE"><span class="toc-number">2.3.1.4.</span> <span class="toc-text">2.3.1.4 模拟客户端访问</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-ingress-http%E6%A1%88%E4%BE%8B%E6%89%A9%E5%B1%95"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 ingress-http案例扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-1-%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">2.3.2.1 创建第一个应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-2-%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%BA%94%E7%94%A8"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">2.3.2.2 创建第二个应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-3-%E5%88%9B%E5%BB%BAingress%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">2.3.2.3 创建ingress对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-4-%E6%A8%A1%E6%8B%9F%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE-1"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">2.3.1.4 模拟客户端访问</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-ingress-https%E6%A1%88%E4%BE%8B"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 ingress-https案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-1-%E5%88%9B%E5%BB%BA%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">2.3.3.1 创建自签证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-2-%E5%B0%86%E8%AF%81%E4%B9%A6%E5%88%9B%E5%BB%BA%E6%88%90secret"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">2.3.3.2 将证书创建成secret</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-3-%E7%BC%96%E6%8E%92YAML%E5%B9%B6%E5%88%9B%E5%BB%BA"><span class="toc-number">2.3.3.3.</span> <span class="toc-text">2.3.3.3 编排YAML并创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-4-%E6%A8%A1%E6%8B%9F%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE"><span class="toc-number">2.3.3.4.</span> <span class="toc-text">2.3.3.4 模拟客户端访问</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-ingress-nodeport%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.3.4 ingress+nodeport服务</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Kubernetes集群服务暴露Nginx Ingress Controller
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">祥祥要起飞</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-05-03T00:40:46.000Z" itemprop="datePublished">2024-05-03</time>
        
      
    </div>


      <div class="posteye">
    <i class="fas fa-eye"></i>
    <span id="/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/" class="leancloud-visitors" data-flag-title="Kubernetes集群服务暴露Nginx Ingress Controller" style="display: inline;">
        <span class="leancloud-visitors-count"></span>
    </span>
</div>
      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Kubernetes/" rel="tag">Kubernetes</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="一、ingress控制器"><a href="#一、ingress控制器" class="headerlink" title="一、ingress控制器"></a>一、ingress控制器</h1><h2 id="1-1-ingress控制器作用"><a href="#1-1-ingress控制器作用" class="headerlink" title="1.1 ingress控制器作用"></a>1.1 ingress控制器作用</h2><p>ingress controller可以为kubernetes 集群外用户访问Kubernetes集群内部pod提供代理服务。</p>
<ul>
<li>提供全局访问代理</li>
<li>访问流程<ul>
<li>用户–&gt;ingress controller–&gt;service–&gt;pod</li>
</ul>
</li>
</ul>
<p><img src="/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412223010688.png" alt="image-20220412223010688"></p>
<p><img src="/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412222951979.png" alt="image-20220412222951979"></p>
<h2 id="1-2-ingress控制器种类"><a href="#1-2-ingress控制器种类" class="headerlink" title="1.2 ingress控制器种类"></a>1.2 ingress控制器种类</h2><h3 id="1-2-1-Kubernetes-Ingress-Controller"><a href="#1-2-1-Kubernetes-Ingress-Controller" class="headerlink" title="1.2.1 Kubernetes Ingress Controller"></a>1.2.1 Kubernetes Ingress Controller</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/nginxinc/kubernetes-ingress">http://github.com/nginxinc/kubernetes-ingress</a></li>
</ul>
<ul>
<li>实现：Go/Lua（nginx 是用 C 写的）</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>Kubernetes 的“官方”控制器（之所以称为官方，是想把它区别于 NGINX 公司的控制器）。这是社区开发的控制器，它基于 nginx Web 服务器，并补充了一组用于实现额外功能的 Lua 插件。</li>
</ul>
<ul>
<li>由于 NGINX 十分流行，再加上把它用作控制器时所需的修改较少，<strong>它对于 K8s 普通工程师来说，可能是最简单和最直接的选择</strong>。</li>
</ul>
<h3 id="1-2-2-NGINX-Ingress-Controller"><a href="#1-2-2-NGINX-Ingress-Controller" class="headerlink" title="1.2.2 NGINX Ingress Controller"></a>1.2.2 NGINX Ingress Controller</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/kubernetes/ingress-nginx">http://github.com/kubernetes/ingress-nginx</a></li>
</ul>
<ul>
<li>实现：Go</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>这是 NGINX 公司开发的官方产品，它也有一个基于 NGINX Plus 的商业版。NGINX 的控制器具有很高的稳定性、持续的向后兼容性，且没有任何第三方模块。</li>
</ul>
<ul>
<li>由于消除了 Lua 代码，和官方控制器相比，它保证了较高的速度，但也因此受到较大限制。相较之下，它的付费版本有更广泛的附加功能，如实时指标、JWT 验证、主动健康检查等。</li>
</ul>
<ul>
<li>NGINX Ingress 重要的优势是对 TCP/UDP 流量的全面支持，最主要缺点是缺乏流量分配功能。</li>
</ul>
<h3 id="1-2-3-Kong-Ingress"><a href="#1-2-3-Kong-Ingress" class="headerlink" title="1.2.3 Kong Ingress"></a>1.2.3 Kong Ingress</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/Kong/kubernetes-ingress-controller">http://github.com/Kong/kubernetes-ingress-controller</a></li>
</ul>
<ul>
<li>实现：Go</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>Kong Ingress 由 Kong Inc 开发，有两个版本：商业版和免费版。它基于 NGINX 构建，并增加了扩展其功能的 Lua 模块。</li>
</ul>
<ul>
<li>最初，Kong Ingress 主要用作 API 网关，用于 API 请求的处理和路由。现在，它已经成为成熟的 Ingress 控制器，<strong>主要优点是拥有大量易于安装和配置的附加模块、插件（包括第三方插件）</strong>。它开启了控制器具备大量附加功能的先河，其内置函数也提供了许多可能性。Kong Ingress 配置是用 CRD 执行的。</li>
</ul>
<ul>
<li>Kong Ingress 的一个重要特性是它只能在一个环境中运行（而不支持跨命名空间）。这是一个颇有争议的话题：有些人认为这是一个缺点，因为必须为每个环境生成实例；而另一些人认为这是一个特殊特性，因为它是更高级别的隔离，控制器故障的影响仅限于其所在的环境。</li>
</ul>
<h3 id="1-2-4-Traefik"><a href="#1-2-4-Traefik" class="headerlink" title="1.2.4 Traefik"></a>1.2.4 Traefik</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/containous/traefik">http://github.com/containous/traefik</a></li>
</ul>
<ul>
<li>实现：Go</li>
</ul>
<ul>
<li>许可证：MIT</li>
</ul>
<ul>
<li>最初，这个代理是为微服务请求及其动态环境的路由而创建的，因此具有许多有用的功能：<strong>连续更新配置（不重新启动）、支持多种负载均衡算法、Web UI、指标导出、对各种服务的支持协议、REST API、Canary 版本</strong>等。</li>
</ul>
<ul>
<li>支持开箱即用的 Let’s Encrypt 是它的另一个不错的功能，但它的主要缺点也很明显，就是为了控制器的高可用性，你必须安装并连接其 Key-value store。</li>
</ul>
<ul>
<li>在 2019 年 9 月发布的 Traefik v2.0 中，虽然它增加许多不错的新功能，如带有 SNI 的 TCP/SSL、金丝雀部署、流量镜像/shadowing 和经过改进的 Web UI，但一些功能（如 WAF 支持）还在策划讨论中。</li>
</ul>
<ul>
<li>与新版本同期推出的还有一个名叫 Mesh 的服务网格，它建在 Traefik 之上，对kubernetes内部服务访问做到受控及被监控。</li>
</ul>
<h3 id="1-2-5-HAProxy-Ingress"><a href="#1-2-5-HAProxy-Ingress" class="headerlink" title="1.2.5 HAProxy Ingress"></a>1.2.5 HAProxy Ingress</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/jcmoraisjr/haproxy-ingress">http://github.com/jcmoraisjr/haproxy-ingress</a></li>
</ul>
<ul>
<li>实现：Go（HAProxy 是用 C 写的）</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>HAProxy 是众所周知的代理服务器和负载均衡器。作为 Kubernetes 集群的一部分，它提供了“软”配置更新（无流量损失）、基于 DNS 的服务发现和通过 API 进行动态配置。 HAProxy 还支持完全自定义配置文件模板（通过替换 ConfigMap）以及在其中使用 Spring Boot 函数。</li>
</ul>
<ul>
<li>通常，工程师会把重点放在已消耗资源的高速、优化和效率上。而 HAProxy 的优点之一正是支持大量负载均衡算法。值得一提的是，在2020年 6 月发布的 v2.0 中，HAProxy 增加了许多新功能，其即将推出的 v2.1 有望带来更多新功能（包括 OpenTracing 支持）。</li>
</ul>
<h3 id="1-2-6-Voyager"><a href="#1-2-6-Voyager" class="headerlink" title="1.2.6 Voyager"></a>1.2.6 Voyager</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/appscode/voyager">http://github.com/appscode/voyager</a></li>
</ul>
<ul>
<li>实现：Go</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>Voyager 基于 HAProxy，并作为一个通用的解决方案提供给大量供应商。它最具代表性的功能包括 L7 和 L4 上的流量负载均衡，其中，<strong>TCP L4 流量负载均衡称得上是该解决方案最关键的功能之一</strong>。</li>
</ul>
<ul>
<li>在2020年早些时候，尽管 Voyager 在 v9.0.0 中推出了对 HTTP/2 和 gRPC 协议的全面支持，但总的来看，对证书管理（Let’s Encrypt 证书）的支持仍是 Voyager 集成的最突出的新功能。</li>
</ul>
<h3 id="1-2-7-Contour"><a href="#1-2-7-Contour" class="headerlink" title="1.2.7 Contour"></a>1.2.7 Contour</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/heptio/contour">http://github.com/heptio/contour</a></li>
</ul>
<ul>
<li>实现：Go</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>Contour 和 Envoy 由同一个作者开发，它基于 Envoy。<strong>它最特别的功能是可以通过 CRD（IngressRoute）管理 Ingress 资源</strong>，对于多团队需要同时使用一个集群的组织来说，这有助于保护相邻环境中的流量，使它们免受 Ingress 资源更改的影响。</li>
</ul>
<ul>
<li>它还提供了一组扩展的负载均衡算法（镜像、自动重复、限制请求率等），以及详细的流量和故障监控。对某些工程师而言，它不支持粘滞会话可能是一个严重缺陷。</li>
</ul>
<h3 id="1-2-8-Istio-Ingress"><a href="#1-2-8-Istio-Ingress" class="headerlink" title="1.2.8 Istio Ingress"></a>1.2.8 Istio Ingress</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://istio.io/docs/tasks/traffic-management/ingress">http://istio.io/docs/tasks/traffic-management/ingress</a></li>
</ul>
<ul>
<li>实现：Go</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>Istio 是 IBM、Google 和 Lyft 的联合开发项目，它是一个全面的服务网格解决方案——<strong>不仅可以管理所有传入的外部流量（作为 Ingress 控制器），还可以控制集群内部的所有流量</strong>。</li>
</ul>
<ul>
<li>Istio 将 Envoy 用作每种服务的辅助代理。从本质上讲，它是一个可以执行几乎所有操作的大型处理器，其中心思想是最大程度的控制、可扩展性、安全性和透明性。</li>
</ul>
<ul>
<li>通过 Istio Ingress，你可以对流量路由、服务之间的访问授权、均衡、监控、金丝雀发布等进行优化。</li>
</ul>
<h3 id="1-2-9-Ambassador"><a href="#1-2-9-Ambassador" class="headerlink" title="1.2.9 Ambassador"></a>1.2.9 Ambassador</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/datawire/ambassador">http://github.com/datawire/ambassador</a></li>
</ul>
<ul>
<li>实现：Python</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>Ambassador 也是一个基于 Envoy 的解决方案，它有免费版和商业版两个版本。</li>
</ul>
<ul>
<li>Ambassador 被称为“Kubernetes 原生 API 微服务网关”，它与 K8s 原语紧密集成，拥有你所期望的从 Ingress controller 获得的功能包，它还可以与各种服务网格解决方案，如 Linkerd、Istio 等一起使用。</li>
</ul>
<ul>
<li>顺便提一下，Ambassador 博客日前发布了一份基准测试结果，比较了 Envoy、HAProxy 和 NGINX 的基础性能。</li>
</ul>
<h3 id="1-2-10-Gloo"><a href="#1-2-10-Gloo" class="headerlink" title="1.2.10 Gloo"></a>1.2.10 Gloo</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/solo-io/gloo">http://github.com/solo-io/gloo</a></li>
</ul>
<ul>
<li>实现：Go</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>Gloo 是在 Envoy 之上构建的新软件（于 2018 年 3 月发布），由于它的作者坚持认为“网关应该从功能而不是服务中构建 API”，它也被称为“功能网关”。其“功能级路由”的意思是它可以为后端实现是微服务、无服务器功能和遗留应用的混合应用路由流量。</li>
</ul>
<ul>
<li>由于拥有可插拔的体系结构，Gloo 提供了工程师期望的大部分功能，但是其中一些功能仅在其商业版本（Gloo Enterprise）中可用。</li>
</ul>
<h3 id="1-2-11-Skipper"><a href="#1-2-11-Skipper" class="headerlink" title="1.2.11 Skipper"></a>1.2.11 Skipper</h3><ul>
<li>参考链接：<a target="_blank" rel="noopener" href="http://github.com/zalando/skipper">http://github.com/zalando/skipper</a></li>
</ul>
<ul>
<li>实现：Go</li>
</ul>
<ul>
<li>许可证：Apache 2.0</li>
</ul>
<ul>
<li>Skipper 是 HTTP 路由器和反向代理，因此不支持各种协议。从技术上讲，它使用 Endpoints API（而不是 Kubernetes Services）将流量路由到 Pod。它的优点在于其丰富的过滤器集所提供的高级 HTTP 路由功能，工程师可以借此创建、更新和删除所有 HTTP 数据。</li>
</ul>
<ul>
<li>Skipper 的路由规则可以在不停机的情况下更新。正如它的作者所述，Skipper 可以很好地与其他解决方案一起使用，比如 AWS ELB。</li>
</ul>
<h1 id="二、nginx-ingress-controller"><a href="#二、nginx-ingress-controller" class="headerlink" title="二、nginx ingress controller"></a>二、nginx ingress controller</h1><h2 id="2-1-nginx-ingress-controller位置"><a href="#2-1-nginx-ingress-controller位置" class="headerlink" title="2.1 nginx ingress controller位置"></a>2.1 nginx ingress controller位置</h2><p><img src="/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412213345991.png" alt="image-20220412213345991"></p>
<ul>
<li>参考链接：<a target="_blank" rel="noopener" href="https://www.nginx.com/products/nginx/kubernetes-ingress-controller">https://www.nginx.com/products/nginx/kubernetes-ingress-controller</a></li>
</ul>
<h2 id="2-2-nginx-ingress-controller部署"><a href="#2-2-nginx-ingress-controller部署" class="headerlink" title="2.2  nginx ingress controller部署"></a>2.2  nginx ingress controller部署</h2><ul>
<li>项目地址：<a target="_blank" rel="noopener" href="https://github.com/kubernetes/ingress-nginx">https://github.com/kubernetes/ingress-nginx</a></li>
</ul>
<h3 id="2-2-1-下载并修改配置文件"><a href="#2-2-1-下载并修改配置文件" class="headerlink" title="2.2.1 下载并修改配置文件"></a>2.2.1 下载并修改配置文件</h3><p><img src="/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412223933840.png" alt="image-20220412223933840"></p>
<p><img src="/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412224751513.png" alt="image-20220412224751513"></p>
<p><img src="/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220412224823931.png" alt="image-20220412224823931"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment">#  curl -k https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/baremetal/deploy.yaml  -o deploy.yaml</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># ls</span></span><br><span class="line">deploy.yaml</span><br></pre></td></tr></table></figure>





<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim deploy.yaml</span></span><br><span class="line">......</span><br><span class="line"><span class="number">323</span> spec:</span><br><span class="line"><span class="number">324</span>   ports:</span><br><span class="line"><span class="number">325</span>   - appProtocol: http</span><br><span class="line"><span class="number">326</span>     name: http</span><br><span class="line"><span class="number">327</span>     port: <span class="number">80</span></span><br><span class="line"><span class="number">328</span>     protocol: TCP</span><br><span class="line"><span class="number">329</span>     targetPort: http</span><br><span class="line"><span class="number">330</span>   - appProtocol: https</span><br><span class="line"><span class="number">331</span>     name: https</span><br><span class="line"><span class="number">332</span>     port: <span class="number">443</span></span><br><span class="line"><span class="number">333</span>     protocol: TCP</span><br><span class="line"><span class="number">334</span>     targetPort: https</span><br><span class="line"><span class="number">335</span>   selector:</span><br><span class="line"><span class="number">336</span>     app.kubernetes.io/component: controller</span><br><span class="line"><span class="number">337</span>     app.kubernetes.io/instance: ingress<span class="literal">-nginx</span></span><br><span class="line"><span class="number">338</span>     app.kubernetes.io/name: ingress<span class="literal">-nginx</span></span><br><span class="line"><span class="number">339</span>   <span class="built_in">type</span>: NodePort</span><br><span class="line"></span><br><span class="line">把<span class="number">339</span>行修改为LoadBalancer</span><br><span class="line"><span class="number">323</span> spec:</span><br><span class="line"><span class="number">324</span>   ports:</span><br><span class="line"><span class="number">325</span>   - appProtocol: http</span><br><span class="line"><span class="number">326</span>     name: http</span><br><span class="line"><span class="number">327</span>     port: <span class="number">80</span></span><br><span class="line"><span class="number">328</span>     protocol: TCP</span><br><span class="line"><span class="number">329</span>     targetPort: http</span><br><span class="line"><span class="number">330</span>   - appProtocol: https</span><br><span class="line"><span class="number">331</span>     name: https</span><br><span class="line"><span class="number">332</span>     port: <span class="number">443</span></span><br><span class="line"><span class="number">333</span>     protocol: TCP</span><br><span class="line"><span class="number">334</span>     targetPort: https</span><br><span class="line"><span class="number">335</span>   selector:</span><br><span class="line"><span class="number">336</span>     app.kubernetes.io/component: controller</span><br><span class="line"><span class="number">337</span>     app.kubernetes.io/instance: ingress<span class="literal">-nginx</span></span><br><span class="line"><span class="number">338</span>     app.kubernetes.io/name: ingress<span class="literal">-nginx</span></span><br><span class="line"><span class="number">339</span>   <span class="built_in">type</span>: LoadBalancer</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="2-2-2-应用资源清单文件"><a href="#2-2-2-应用资源清单文件" class="headerlink" title="2.2.2 应用资源清单文件"></a>2.2.2 应用资源清单文件</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f deploy.yaml</span></span><br><span class="line">namespace/ingress<span class="literal">-nginx</span> created</span><br><span class="line">serviceaccount/ingress<span class="literal">-nginx</span> created</span><br><span class="line">serviceaccount/ingress<span class="literal">-nginx</span><span class="literal">-admission</span> created</span><br><span class="line">role.rbac.authorization.k8s.io/ingress<span class="literal">-nginx</span> created</span><br><span class="line">role.rbac.authorization.k8s.io/ingress<span class="literal">-nginx</span><span class="literal">-admission</span> created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ingress<span class="literal">-nginx</span> created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ingress<span class="literal">-nginx</span><span class="literal">-admission</span> created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/ingress<span class="literal">-nginx</span> created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/ingress<span class="literal">-nginx</span><span class="literal">-admission</span> created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/ingress<span class="literal">-nginx</span> created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/ingress<span class="literal">-nginx</span><span class="literal">-admission</span> created</span><br><span class="line">configmap/ingress<span class="literal">-nginx</span><span class="literal">-controller</span> created</span><br><span class="line">service/ingress<span class="literal">-nginx</span><span class="literal">-controller</span> created</span><br><span class="line">service/ingress<span class="literal">-nginx</span><span class="literal">-controller</span><span class="literal">-admission</span> created</span><br><span class="line">deployment.apps/ingress<span class="literal">-nginx</span><span class="literal">-controller</span> created</span><br><span class="line">job.batch/ingress<span class="literal">-nginx</span><span class="literal">-admission</span><span class="literal">-create</span> created</span><br><span class="line">job.batch/ingress<span class="literal">-nginx</span><span class="literal">-admission</span><span class="literal">-patch</span> created</span><br><span class="line">ingressclass.networking.k8s.io/nginx created</span><br><span class="line">validatingwebhookconfiguration.admissionregistration.k8s.io/ingress<span class="literal">-nginx</span><span class="literal">-admission</span> created</span><br></pre></td></tr></table></figure>



<h3 id="2-2-3-验证部署结果"><a href="#2-2-3-验证部署结果" class="headerlink" title="2.2.3 验证部署结果"></a>2.2.3 验证部署结果</h3><blockquote>
<p>注意镜像较大，可提前下载至集群node节点</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods -n ingress-nginx</span></span><br><span class="line">NAME                                      READY   STATUS      RESTARTS   AGE</span><br><span class="line">ingress<span class="literal">-nginx</span><span class="literal">-admission</span><span class="literal">-create</span><span class="literal">-xdpgp</span>      <span class="number">0</span>/<span class="number">1</span>     Completed   <span class="number">0</span>          <span class="number">91</span>s</span><br><span class="line">ingress<span class="literal">-nginx</span><span class="literal">-admission</span><span class="literal">-patch</span><span class="literal">-lgnxs</span>       <span class="number">0</span>/<span class="number">1</span>     Completed   <span class="number">1</span>          <span class="number">91</span>s</span><br><span class="line">ingress<span class="literal">-nginx</span><span class="literal">-controller</span><span class="literal">-9596689c</span><span class="literal">-j9p9l</span>   <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">91</span>s</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> <span class="type">ng</span>]<span class="comment"># kubectl get all -n ingress-nginx</span></span><br><span class="line">NAME                                          READY   STATUS      RESTARTS   AGE</span><br><span class="line">pod/ingress<span class="literal">-nginx</span><span class="literal">-admission</span><span class="literal">-create</span><span class="literal">-xdpgp</span>      <span class="number">0</span>/<span class="number">1</span>     Completed   <span class="number">0</span>          <span class="number">3</span>m24s</span><br><span class="line">pod/ingress<span class="literal">-nginx</span><span class="literal">-admission</span><span class="literal">-patch</span><span class="literal">-lgnxs</span>       <span class="number">0</span>/<span class="number">1</span>     Completed   <span class="number">1</span>          <span class="number">3</span>m24s</span><br><span class="line">pod/ingress<span class="literal">-nginx</span><span class="literal">-controller</span><span class="literal">-9596689c</span><span class="literal">-j9p9l</span>   <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">3</span>m24s</span><br><span class="line"></span><br><span class="line">NAME                                         <span class="built_in">TYPE</span>           CLUSTER<span class="literal">-IP</span>      EXTERNAL<span class="literal">-IP</span>     PORT(S)                      AGE</span><br><span class="line">service/ingress<span class="literal">-nginx</span><span class="literal">-controller</span>             LoadBalancer   <span class="number">10.96</span>.<span class="number">183.188</span>   <span class="number">192.168</span>.<span class="number">10.91</span>   <span class="number">80</span>:<span class="number">32369</span>/TCP,<span class="number">443</span>:<span class="number">31775</span>/TCP   <span class="number">3</span>m25s</span><br><span class="line">service/ingress<span class="literal">-nginx</span><span class="literal">-controller</span><span class="literal">-admission</span>   ClusterIP      <span class="number">10.96</span>.<span class="number">212.14</span>    &lt;none&gt;          <span class="number">443</span>/TCP                      <span class="number">3</span>m25s</span><br><span class="line"></span><br><span class="line">NAME                                       READY   UP<span class="literal">-TO</span><span class="literal">-DATE</span>   AVAILABLE   AGE</span><br><span class="line">deployment.apps/ingress<span class="literal">-nginx</span><span class="literal">-controller</span>   <span class="number">1</span>/<span class="number">1</span>     <span class="number">1</span>            <span class="number">1</span>           <span class="number">3</span>m24s</span><br><span class="line"></span><br><span class="line">NAME                                                DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/ingress<span class="literal">-nginx</span><span class="literal">-controller</span><span class="literal">-9596689c</span>   <span class="number">1</span>         <span class="number">1</span>         <span class="number">1</span>       <span class="number">3</span>m24s</span><br><span class="line"></span><br><span class="line">NAME                                       COMPLETIONS   DURATION   AGE</span><br><span class="line">job.batch/ingress<span class="literal">-nginx</span><span class="literal">-admission</span><span class="literal">-create</span>   <span class="number">1</span>/<span class="number">1</span>           <span class="number">2</span>s         <span class="number">3</span>m24s</span><br><span class="line">job.batch/ingress<span class="literal">-nginx</span><span class="literal">-admission</span><span class="literal">-patch</span>    <span class="number">1</span>/<span class="number">1</span>           <span class="number">3</span>s         <span class="number">3</span>m24s</span><br></pre></td></tr></table></figure>





<h2 id="2-3-ingress对象应用案例"><a href="#2-3-ingress对象应用案例" class="headerlink" title="2.3 ingress对象应用案例"></a>2.3 ingress对象应用案例</h2><h3 id="2-3-1-ingress-http案例"><a href="#2-3-1-ingress-http案例" class="headerlink" title="2.3 1 ingress-http案例"></a>2.3 1 ingress-http案例</h3><blockquote>
<p>基于名称的负载均衡</p>
</blockquote>
<h4 id="2-3-1-1-创建deployment控制器类型应用"><a href="#2-3-1-1-创建deployment控制器类型应用" class="headerlink" title="2.3.1.1 创建deployment控制器类型应用"></a>2.3.1.1 创建deployment控制器类型应用</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim nginx.yml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">spec:</span><br><span class="line">  replicas: <span class="number">2</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: c1</span><br><span class="line">        image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br></pre></td></tr></table></figure>

<p>应用YAML</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f nginx.yml</span></span><br><span class="line">deployment.extensions/nginx created</span><br></pre></td></tr></table></figure>

<p>验证pod</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods -n ingress-nginx</span></span><br><span class="line">NAME                                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx<span class="literal">-79654d7b8</span><span class="literal">-nhxpm</span>                       <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">12</span>s</span><br><span class="line">nginx<span class="literal">-79654d7b8</span><span class="literal">-tp8wg</span>                       <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">13</span>s</span><br><span class="line">nginx<span class="literal">-ingress</span><span class="literal">-controller</span><span class="literal">-77db54fc46</span><span class="literal">-kwwkt</span>   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>          <span class="number">11</span>m</span><br></pre></td></tr></table></figure>



<h4 id="2-3-1-2-创建service"><a href="#2-3-1-2-创建service" class="headerlink" title="2.3.1.2 创建service"></a>2.3.1.2 创建service</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim nginx-service.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx<span class="literal">-service</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: <span class="number">80</span></span><br><span class="line">    targetPort: <span class="number">80</span></span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br></pre></td></tr></table></figure>

<p>应用YAML</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f nginx-service.yml</span></span><br><span class="line">service/nginx<span class="literal">-service</span> created</span><br></pre></td></tr></table></figure>

<p>验证service</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get svc -n ingress-nginx</span></span><br><span class="line">NAME            <span class="built_in">TYPE</span>        CLUSTER<span class="literal">-IP</span>     EXTERNAL<span class="literal">-IP</span>   PORT(S)   AGE</span><br><span class="line">nginx<span class="literal">-service</span>   ClusterIP   <span class="number">10.2</span>.<span class="number">115.144</span>   &lt;none&gt;        <span class="number">80</span>/TCP    <span class="number">5</span>s</span><br></pre></td></tr></table></figure>



<h4 id="2-3-1-3-创建ingress对象"><a href="#2-3-1-3-创建ingress对象" class="headerlink" title="2.3.1.3 创建ingress对象"></a>2.3.1.3 创建ingress对象</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim ingress-nginx.yaml</span></span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: ingress<span class="literal">-nginx</span>                    <span class="comment">#自定义ingress名称</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">  annotations:</span><br><span class="line">    ingressclass.kubernetes.io/is<span class="literal">-default</span><span class="literal">-class</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">    kubernetes.io/ingress.class: nginx</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: www.kubemsb.com                   <span class="comment"># 自定义域名</span></span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - pathType: Prefix</span><br><span class="line">        path: <span class="string">&quot;/&quot;</span></span><br><span class="line">        backend:</span><br><span class="line">          service:</span><br><span class="line">            name: nginx<span class="literal">-service</span>     <span class="comment"># 对应上面创建的service名称</span></span><br><span class="line">            port:</span><br><span class="line">              number: <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>应用YAML</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f ingress-nginx.yaml</span></span><br><span class="line">ingress.extensions/ingress<span class="literal">-nginx</span> created</span><br></pre></td></tr></table></figure>

<p>验证ingress</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get ingress -n ingress-nginx</span></span><br><span class="line">NAME            <span class="class"><span class="keyword">CLASS</span>    <span class="title">HOSTS</span>             <span class="title">ADDRESS</span>         <span class="title">PORTS</span>   <span class="title">AGE</span></span></span><br><span class="line"><span class="class"><span class="title">ingress</span>-<span class="title">nginx</span>   &lt;<span class="title">none</span>&gt;   <span class="title">www</span>.<span class="title">kubemsb</span>.<span class="title">com</span>   192.168.10.12   80      113<span class="title">s</span></span></span><br></pre></td></tr></table></figure>

<p>描述查看ingress信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl describe ingress ingress-nginx -n ingress-nginx</span></span><br><span class="line">Name:             ingress<span class="literal">-nginx</span></span><br><span class="line">Namespace:        ingress<span class="literal">-nginx</span></span><br><span class="line">Address:          <span class="number">192.168</span>.<span class="number">10.12</span></span><br><span class="line">Default backend:  default<span class="literal">-http</span><span class="literal">-backend</span>:<span class="number">80</span> (&lt;error: endpoints <span class="string">&quot;default-http-backend&quot;</span> not found&gt;)</span><br><span class="line">Rules:</span><br><span class="line">  Host             Path  Backends</span><br><span class="line">  ----             ----  --------</span><br><span class="line">  www.kubemsb.com</span><br><span class="line">                   /   nginx<span class="literal">-service</span>:<span class="number">80</span> (<span class="number">10.244</span>.<span class="number">159.160</span>:<span class="number">80</span>,<span class="number">10.244</span>.<span class="number">194.110</span>:<span class="number">80</span>)</span><br><span class="line">Annotations:       kubernetes.io/ingress.class: nginx</span><br><span class="line">Events:</span><br><span class="line">  <span class="built_in">Type</span>    Reason  Age                 From                      Message</span><br><span class="line">  ----    ------  ----                ----                      -------</span><br><span class="line">  Normal  Sync    <span class="number">2</span>m (x2 over <span class="number">2</span>m56s)  nginx<span class="literal">-ingress</span><span class="literal">-controller</span>  Scheduled <span class="keyword">for</span> sync</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods -o wide -n ingress-nginx</span></span><br><span class="line">NAME                                      READY   STATUS      RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line"></span><br><span class="line">nginx<span class="literal">-646d5c7b67</span><span class="literal">-mpw9r</span>                    <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">4</span>m15s   <span class="number">10.244</span>.<span class="number">194.110</span>   k8s<span class="literal">-worker1</span>   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx<span class="literal">-646d5c7b67</span><span class="literal">-v99gz</span>                    <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">4</span>m15s   <span class="number">10.244</span>.<span class="number">159.160</span>   k8s<span class="literal">-master1</span>   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">可以看到两个pod的IP正好对应ingress域名对应的IP</span><br></pre></td></tr></table></figure>



<p>确认<code>nginx-ingress-controller</code>的podIP为<code>192.168.10.91</code></p>
<h4 id="2-3-1-4-模拟客户端访问"><a href="#2-3-1-4-模拟客户端访问" class="headerlink" title="2.3.1.4 模拟客户端访问"></a>2.3.1.4 模拟客户端访问</h4><p>1, 确认<code>nginx-ingress-controller</code>的podIP, 下面命令查询的结果为<code>192.168.10.91</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get svc -n ingress-nginx  |grep ingress</span></span><br><span class="line">ingress<span class="literal">-nginx</span><span class="literal">-controller</span>             LoadBalancer   <span class="number">10.96</span>.<span class="number">183.188</span>   <span class="number">192.168</span>.<span class="number">10.91</span>   <span class="number">80</span>:<span class="number">32369</span>/TCP,<span class="number">443</span>:<span class="number">31775</span>/TCP   <span class="number">11</span>m</span><br><span class="line">ingress<span class="literal">-nginx</span><span class="literal">-controller</span><span class="literal">-admission</span>   ClusterIP      <span class="number">10.96</span>.<span class="number">212.14</span>    &lt;none&gt;          <span class="number">443</span>/TCP                      <span class="number">11</span>m</span><br></pre></td></tr></table></figure>

<p>2, 在集群之外任一主机中添加上述域名与IP地址解析(模拟公网DNS)</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line"></span><br><span class="line"><span class="number">192.168</span>.<span class="number">10.91</span> www.kubemsb.com</span><br></pre></td></tr></table></figure>

<p>3, 准备pod内容器运行的web主页</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods  -n ingress-nginx </span></span><br><span class="line">nginx<span class="literal">-646d5c7b67</span><span class="literal">-mpw9r</span>                    <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">8</span>m34s</span><br><span class="line">nginx<span class="literal">-646d5c7b67</span><span class="literal">-v99gz</span>                    <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">8</span>m34s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it nginx-646d5c7b67-mpw9r -n ingress-nginx  -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># echo &quot;ingress web1&quot; &gt; /usr/share/nginx/html/index.html</span></span><br><span class="line">/ <span class="comment"># exit</span></span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it nginx-646d5c7b67-v99gz -n ingress-nginx -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># echo &quot;ingress web2&quot; &gt; /usr/share/nginx/html/index.html</span></span><br><span class="line">/ <span class="comment"># exit</span></span><br></pre></td></tr></table></figure>

<p>4, 访问及结果展示</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># curl www.kubemsb.com</span></span><br><span class="line">ingress web1</span><br><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># curl www.kubemsb.com</span></span><br><span class="line">ingress web2</span><br></pre></td></tr></table></figure>



<h3 id="2-3-2-ingress-http案例扩展"><a href="#2-3-2-ingress-http案例扩展" class="headerlink" title="2.3.2 ingress-http案例扩展"></a>2.3.2 ingress-http案例扩展</h3><blockquote>
<p>基于URI的负载均衡</p>
</blockquote>
<h4 id="2-3-2-1-创建第一个应用"><a href="#2-3-2-1-创建第一个应用" class="headerlink" title="2.3.2.1 创建第一个应用"></a>2.3.2.1 创建第一个应用</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim nginx-uri-1.yml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx<span class="literal">-uri</span><span class="literal">-1</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">spec:</span><br><span class="line">  replicas: <span class="number">2</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx<span class="literal">-uri</span><span class="literal">-1</span></span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx<span class="literal">-uri</span><span class="literal">-1</span></span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: c1</span><br><span class="line">        image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim nginx-service-uri-1.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx<span class="literal">-service</span><span class="literal">-uri</span><span class="literal">-1</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">  labels:</span><br><span class="line">    app: nginx<span class="literal">-uri</span><span class="literal">-1</span></span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: <span class="number">80</span></span><br><span class="line">    targetPort: <span class="number">80</span></span><br><span class="line">  selector:</span><br><span class="line">    app: nginx<span class="literal">-uri</span><span class="literal">-1</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl apply -f nginx-uri-1.yaml</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl apply -f nginx-service-uri-1.yaml</span></span><br></pre></td></tr></table></figure>



<h4 id="2-3-2-2-创建第二个应用"><a href="#2-3-2-2-创建第二个应用" class="headerlink" title="2.3.2.2 创建第二个应用"></a>2.3.2.2 创建第二个应用</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim nginx-uri-2.yml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx<span class="literal">-uri</span><span class="literal">-2</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">spec:</span><br><span class="line">  replicas: <span class="number">2</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx<span class="literal">-uri</span><span class="literal">-2</span></span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx<span class="literal">-uri</span><span class="literal">-2</span></span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: c1</span><br><span class="line">        image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim nginx-service-uri-2.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx<span class="literal">-service</span><span class="literal">-uri</span><span class="literal">-2</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">  labels:</span><br><span class="line">    app: nginx<span class="literal">-uri</span><span class="literal">-2</span></span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: <span class="number">80</span></span><br><span class="line">    targetPort: <span class="number">80</span></span><br><span class="line">  selector:</span><br><span class="line">    app: nginx<span class="literal">-uri</span><span class="literal">-2</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl apply -f nginx-uri-2.yaml</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl apply -f nginx-service-uri-2.yaml</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl get svc -n ingress-nginx</span></span><br><span class="line">NAME                                 <span class="built_in">TYPE</span>           CLUSTER<span class="literal">-IP</span>      EXTERNAL<span class="literal">-IP</span>     PORT(S)                      AGE</span><br><span class="line"></span><br><span class="line">nginx<span class="literal">-service</span><span class="literal">-uri</span><span class="literal">-1</span>                  ClusterIP      <span class="number">10.96</span>.<span class="number">171.135</span>   &lt;none&gt;          <span class="number">80</span>/TCP                       <span class="number">7</span>m24s</span><br><span class="line">nginx<span class="literal">-service</span><span class="literal">-uri</span><span class="literal">-2</span>                  ClusterIP      <span class="number">10.96</span>.<span class="number">234.164</span>   &lt;none&gt;          <span class="number">80</span>/TCP                       <span class="number">4</span>m11s</span><br></pre></td></tr></table></figure>





<h4 id="2-3-2-3-创建ingress对象"><a href="#2-3-2-3-创建ingress对象" class="headerlink" title="2.3.2.3 创建ingress对象"></a>2.3.2.3 创建ingress对象</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim ingress-nginx.yaml</span></span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: ingress<span class="literal">-uri</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">  annotations:</span><br><span class="line">    ingressclass.kubernetes.io/is<span class="literal">-default</span><span class="literal">-class</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">    kubernetes.io/ingress.class: nginx</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: www.kubemsburi.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /svc1</span><br><span class="line">        pathType: Prefix</span><br><span class="line">        backend:</span><br><span class="line">          service:</span><br><span class="line">            name: nginx<span class="literal">-service</span><span class="literal">-uri</span><span class="literal">-1</span></span><br><span class="line">            port:</span><br><span class="line">              number: <span class="number">80</span></span><br><span class="line">      - path: /svc2</span><br><span class="line">        pathType: Prefix</span><br><span class="line">        backend:</span><br><span class="line">          service:</span><br><span class="line">            name: nginx<span class="literal">-service</span><span class="literal">-uri</span><span class="literal">-2</span></span><br><span class="line">            port:</span><br><span class="line">              number: <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>应用YAML</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f ingress-nginx-uri.yaml</span></span><br><span class="line">ingress.networking.k8s.io/ingress<span class="literal">-uri</span> created</span><br></pre></td></tr></table></figure>

<p>验证ingress</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">master1</span> ~]<span class="comment"># kubectl get ingress -n ingress-nginx</span></span><br><span class="line">NAME            <span class="class"><span class="keyword">CLASS</span>    <span class="title">HOSTS</span>             <span class="title">ADDRESS</span>         <span class="title">PORTS</span>   <span class="title">AGE</span></span></span><br><span class="line"><span class="class"><span class="title">ingress</span>-<span class="title">uri</span>     &lt;<span class="title">none</span>&gt;   <span class="title">www</span>.<span class="title">kubemsburi</span>.<span class="title">com</span>                   80      13<span class="title">s</span></span></span><br></pre></td></tr></table></figure>

<p>描述查看ingress信息</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">master1</span> ~]<span class="comment"># kubectl describe ingress ingress-uri -n ingress-nginx</span></span><br><span class="line">Name:             ingress<span class="literal">-uri</span></span><br><span class="line">Namespace:        ingress<span class="literal">-nginx</span></span><br><span class="line">Address:          <span class="number">192.168</span>.<span class="number">10.12</span></span><br><span class="line">Default backend:  default<span class="literal">-http</span><span class="literal">-backend</span>:<span class="number">80</span> (&lt;error: endpoints <span class="string">&quot;default-http-backend&quot;</span> not found&gt;)</span><br><span class="line">Rules:</span><br><span class="line">  Host                Path  Backends</span><br><span class="line">  ----                ----  --------</span><br><span class="line">  www.kubemsburi.com</span><br><span class="line">                      /svc1   nginx<span class="literal">-service</span><span class="literal">-uri</span><span class="literal">-1</span>:<span class="number">80</span> (<span class="number">10.244</span>.<span class="number">159.158</span>:<span class="number">80</span>,<span class="number">10.244</span>.<span class="number">194.111</span>:<span class="number">80</span>)</span><br><span class="line">                      /svc2   nginx<span class="literal">-service</span><span class="literal">-uri</span><span class="literal">-2</span>:<span class="number">80</span> (<span class="number">10.244</span>.<span class="number">159.159</span>:<span class="number">80</span>,<span class="number">10.244</span>.<span class="number">194.112</span>:<span class="number">80</span>)</span><br><span class="line">Annotations:          kubernetes.io/ingress.class: nginx</span><br><span class="line">Events:</span><br><span class="line">  <span class="built_in">Type</span>    Reason  Age               From                      Message</span><br><span class="line">  ----    ------  ----              ----                      -------</span><br><span class="line">  Normal  Sync    <span class="number">4</span>s (x2 over <span class="number">32</span>s)  nginx<span class="literal">-ingress</span><span class="literal">-controller</span>  Scheduled <span class="keyword">for</span> sync</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get pods -o wide -n ingress-nginx</span></span><br><span class="line">NAME                                      READY   STATUS      RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line"></span><br><span class="line">nginx<span class="literal">-uri</span><span class="literal">-1</span><span class="literal">-7d7d75f86</span><span class="literal">-dws96</span>               <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">14</span>m   <span class="number">10.244</span>.<span class="number">159.158</span>   k8s<span class="literal">-master1</span>   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx<span class="literal">-uri</span><span class="literal">-1</span><span class="literal">-7d7d75f86</span><span class="literal">-s8js4</span>               <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">14</span>m   <span class="number">10.244</span>.<span class="number">194.111</span>   k8s<span class="literal">-worker1</span>   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx<span class="literal">-uri</span><span class="literal">-2</span><span class="literal">-7cdf7f89b7</span><span class="literal">-8s4mg</span>              <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">10</span>m   <span class="number">10.244</span>.<span class="number">194.112</span>   k8s<span class="literal">-worker1</span>   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx<span class="literal">-uri</span><span class="literal">-2</span><span class="literal">-7cdf7f89b7</span><span class="literal">-gj8x6</span>              <span class="number">1</span>/<span class="number">1</span>     Running     <span class="number">0</span>          <span class="number">10</span>m   <span class="number">10.244</span>.<span class="number">159.159</span>   k8s<span class="literal">-master1</span>   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>确认<code>nginx-ingress-controller</code>的podIP为<code>192.168.10.91</code></p>
<h4 id="2-3-1-4-模拟客户端访问-1"><a href="#2-3-1-4-模拟客户端访问-1" class="headerlink" title="2.3.1.4 模拟客户端访问"></a>2.3.1.4 模拟客户端访问</h4><p>1, 确认<code>nginx-ingress-controller</code>的podIP, 下面命令查询的结果为<code>192.168.10.91</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get svc -n ingress-nginx  |grep ingress</span></span><br><span class="line">ingress<span class="literal">-nginx</span><span class="literal">-controller</span>             LoadBalancer   <span class="number">10.96</span>.<span class="number">183.188</span>   <span class="number">192.168</span>.<span class="number">10.91</span>   <span class="number">80</span>:<span class="number">32369</span>/TCP,<span class="number">443</span>:<span class="number">31775</span>/TCP   <span class="number">11</span>m</span><br><span class="line">ingress<span class="literal">-nginx</span><span class="literal">-controller</span><span class="literal">-admission</span>   ClusterIP      <span class="number">10.96</span>.<span class="number">212.14</span>    &lt;none&gt;          <span class="number">443</span>/TCP                      <span class="number">11</span>m</span><br></pre></td></tr></table></figure>

<p>2, 在集群之外任一主机中添加上述域名与IP地址解析(模拟公网DNS)</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line"></span><br><span class="line"><span class="number">192.168</span>.<span class="number">10.91</span> www.kubemsburi.com</span><br></pre></td></tr></table></figure>

<p>3, 准备pod内容器运行的web主页</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it nginx-uri-1-7d7d75f86-dws96 -n ingress-nginx -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># mkdir /usr/share/nginx/html/svc1</span></span><br><span class="line">/ <span class="comment"># echo &quot;sssvc1&quot; &gt; /usr/share/nginx/html/svc1/index.html</span></span><br><span class="line">/ <span class="comment"># exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it nginx-uri-1-7d7d75f86-s8js4 -n ingress-nginx -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># mkdir /usr/share/nginx/html/svc1</span></span><br><span class="line">/ <span class="comment"># echo &quot;sssvc1&quot; &gt; /usr/share/nginx/html/svc1/index.html</span></span><br><span class="line">/ <span class="comment"># exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it nginx-uri-2-7cdf7f89b7-8s4mg -n ingress-nginx -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># mkdir /usr/share/nginx/html/svc2</span></span><br><span class="line">/ <span class="comment"># echo &quot;sssvc2&quot; &gt; /usr/share/nginx/html/svc1/index.html</span></span><br><span class="line">/ <span class="comment"># exit</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl exec -it nginx-uri-2-7cdf7f89b7-gj8x6 -n ingress-nginx -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># mkdir /usr/share/nginx/html/svc2</span></span><br><span class="line">/ <span class="comment"># echo &quot;sssvc2&quot; &gt; /usr/share/nginx/html/svc1/index.html</span></span><br><span class="line">/ <span class="comment"># exit</span></span><br></pre></td></tr></table></figure>

<p>4, 访问及结果展示</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># curl www.kubemsburi.com/svc1/index.html</span></span><br><span class="line">sssvc1</span><br><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># curl www.kubemsburi.com/svc2/index.html</span></span><br><span class="line">sssvc2</span><br></pre></td></tr></table></figure>







<h3 id="2-3-3-ingress-https案例"><a href="#2-3-3-ingress-https案例" class="headerlink" title="2.3.3 ingress-https案例"></a>2.3.3 ingress-https案例</h3><h4 id="2-3-3-1-创建自签证书"><a href="#2-3-3-1-创建自签证书" class="headerlink" title="2.3.3.1 创建自签证书"></a>2.3.3.1 创建自签证书</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># mkdir ingress-https</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># cd ingress-https/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> <span class="type">ingress</span>-<span class="type">https</span>]<span class="comment"># openssl genrsa -out nginx.key 2048</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> <span class="type">ingress</span>-<span class="type">https</span>]<span class="comment"># openssl req -new -x509 -key nginx.key -out nginx.pem -days 365</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">Country Name (<span class="number">2</span> letter code) [<span class="type">XX</span>]:CN</span><br><span class="line">State or Province Name (full name) []:GD</span><br><span class="line">Locality Name (eg, city) [<span class="type">Default</span> <span class="type">City</span>]:SZ</span><br><span class="line">Organization Name (eg, company) [<span class="type">Default</span> <span class="type">Company</span> <span class="type">Ltd</span>]:IT</span><br><span class="line">Organizational Unit Name (eg, section) []:it</span><br><span class="line">Common Name (eg, your name or your server<span class="string">&#x27;s hostname) []:kubemsbhost</span></span><br><span class="line"><span class="string">Email Address []:admin@kubemsbhost.com</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@k8s-master1 ingress-https]# ls</span></span><br><span class="line"><span class="string">nginx.key  nginx.pem</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-2-将证书创建成secret"><a href="#2-3-3-2-将证书创建成secret" class="headerlink" title="2.3.3.2 将证书创建成secret"></a>2.3.3.2 将证书创建成secret</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> <span class="type">ingress</span>-<span class="type">https</span>]<span class="comment"># kubectl create secret tls nginx-tls-secret --cert=nginx.pem --key=nginx.key -n ingress-nginx</span></span><br><span class="line">secret/nginx<span class="literal">-tls</span><span class="literal">-secret</span> created</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> <span class="type">ingress</span>-<span class="type">https</span>]<span class="comment"># kubectl get secrets -n ingress-nginx |grep nginx-tls-secret</span></span><br><span class="line">nginx<span class="literal">-tls</span><span class="literal">-secret</span>                           kubernetes.io/tls                     <span class="number">2</span>      <span class="number">38</span>s</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-3-编排YAML并创建"><a href="#2-3-3-3-编排YAML并创建" class="headerlink" title="2.3.3.3 编排YAML并创建"></a>2.3.3.3 编排YAML并创建</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> <span class="type">ingress</span>-<span class="type">https</span>]<span class="comment"># vim ingress-https.yml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx2</span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">spec:</span><br><span class="line">  replicas: <span class="number">2</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx2</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: c1</span><br><span class="line">        image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - name: http</span><br><span class="line">          containerPort: <span class="number">80</span></span><br><span class="line">        - name: https</span><br><span class="line">          containerPort: <span class="number">443</span></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx<span class="literal">-service2</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">  labels:</span><br><span class="line">    app: nginx2</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: <span class="number">80</span></span><br><span class="line">    targetPort: <span class="number">80</span></span><br><span class="line">  - name: https</span><br><span class="line">    port: <span class="number">443</span></span><br><span class="line">    targetPort: <span class="number">443</span></span><br><span class="line">  selector:</span><br><span class="line">    app: nginx2</span><br><span class="line">---</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: ingress<span class="literal">-nginx2</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">  annotations:</span><br><span class="line">    ingressclass.kubernetes.io/is<span class="literal">-default</span><span class="literal">-class</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">    kubernetes.io/ingress.class: nginx</span><br><span class="line">spec:</span><br><span class="line">  tls:</span><br><span class="line">  - hosts:</span><br><span class="line">    - www.kubemsbhost.com                                                     <span class="comment"># 域名</span></span><br><span class="line">    secretName: nginx<span class="literal">-tls</span><span class="literal">-secret</span>                                  <span class="comment"># 调用前面创建的secret</span></span><br><span class="line">  rules:</span><br><span class="line">  - host: www.kubemsbhost.com                                                 <span class="comment"># 域名</span></span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - pathType: Prefix</span><br><span class="line">        path: <span class="string">&quot;/&quot;</span></span><br><span class="line">        backend:</span><br><span class="line">          service:</span><br><span class="line">            name: nginx<span class="literal">-service2</span>                     <span class="comment"># 对应服务名</span></span><br><span class="line">            port:</span><br><span class="line">              number: <span class="number">80</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> <span class="type">ingress</span>-<span class="type">https</span>]<span class="comment"># kubectl apply -f ingress-https.yml</span></span><br><span class="line">deployment.apps/nginx2 created</span><br><span class="line">service/nginx<span class="literal">-service2</span> created</span><br><span class="line">ingress.extensions/ingress<span class="literal">-nginx2</span> created</span><br></pre></td></tr></table></figure>

<p>验证</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl get ingress -n ingress-nginx</span></span><br><span class="line">NAME             <span class="class"><span class="keyword">CLASS</span>    <span class="title">HOSTS</span>                 <span class="title">ADDRESS</span>         <span class="title">PORTS</span>     <span class="title">AGE</span></span></span><br><span class="line"><span class="class"><span class="title">ingress</span>-<span class="title">nginx2</span>   &lt;<span class="title">none</span>&gt;   <span class="title">www</span>.<span class="title">kubemsbhost</span>.<span class="title">com</span>   192.168.10.12   80, 443   2<span class="title">m14s</span></span></span><br></pre></td></tr></table></figure>



<h4 id="2-3-3-4-模拟客户端访问"><a href="#2-3-3-4-模拟客户端访问" class="headerlink" title="2.3.3.4 模拟客户端访问"></a>2.3.3.4 模拟客户端访问</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line"></span><br><span class="line"><span class="number">192.168</span>.<span class="number">10.91</span> www.kubemsbhost.com					添加这行模拟DNS</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># firefox https://www.kubemsbhost.com &amp;</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">10892</span></span><br></pre></td></tr></table></figure>



<p><img src="/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220413013418685.png" alt="image-20220413013418685"></p>
<p><img src="/images/Kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2NginxIngressController.assets/image-20220413013457091.png" alt="image-20220413013457091"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关于可信任证书的说明：</span><br><span class="line">如果需要在互联网中访问kubernetes集群中的服务是可信的，建议使用互联网中申请的SSL证书。</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="2-3-4-ingress-nodeport服务"><a href="#2-3-4-ingress-nodeport服务" class="headerlink" title="2.3.4 ingress+nodeport服务"></a>2.3.4 ingress+nodeport服务</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># vim ingress-nodeport.yml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx3</span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">spec:</span><br><span class="line">  replicas: <span class="number">2</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx3</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: c1</span><br><span class="line">        image: nginx:<span class="number">1.15</span><span class="literal">-alpine</span></span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx<span class="literal">-service3</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">  labels:</span><br><span class="line">    app: nginx3</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort						<span class="comment"># NodePort类型服务</span></span><br><span class="line">  ports:</span><br><span class="line">  - port: <span class="number">80</span></span><br><span class="line">    targetPort: <span class="number">80</span></span><br><span class="line">  selector:</span><br><span class="line">    app: nginx3</span><br><span class="line">---</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: ingress<span class="literal">-nginx3</span></span><br><span class="line">  namespace: ingress<span class="literal">-nginx</span></span><br><span class="line">  annotations:</span><br><span class="line">    ingressclass.kubernetes.io/is<span class="literal">-default</span><span class="literal">-class</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">    kubernetes.io/ingress.class: nginx</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: www.kubemsb3.com                                                 <span class="comment"># 域名</span></span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - pathType: Prefix</span><br><span class="line">        path: <span class="string">&quot;/&quot;</span></span><br><span class="line">        backend:</span><br><span class="line">          service:</span><br><span class="line">            name: nginx<span class="literal">-service3</span>                    <span class="comment"># 对应服务名</span></span><br><span class="line">            port:</span><br><span class="line">              number: <span class="number">80</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master1</span> ~]<span class="comment"># kubectl apply -f ingress-nodeport.yml</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@k8s<span class="literal">-master1</span> ~]<span class="comment"># kubectl get svc -n ingress-nginx</span></span><br><span class="line">NAME             <span class="built_in">TYPE</span>        CLUSTER<span class="literal">-IP</span>     EXTERNAL<span class="literal">-IP</span>   PORT(S)          AGE</span><br><span class="line">nginx<span class="literal">-service</span>    ClusterIP   <span class="number">10.2</span>.<span class="number">115.144</span>   &lt;none&gt;        <span class="number">80</span>/TCP           <span class="number">22</span><span class="built_in">h</span></span><br><span class="line">nginx<span class="literal">-service2</span>   ClusterIP   <span class="number">10.2</span>.<span class="number">237.70</span>    &lt;none&gt;        <span class="number">80</span>/TCP,<span class="number">443</span>/TCP   <span class="number">22</span><span class="built_in">h</span></span><br><span class="line">nginx<span class="literal">-service3</span>   NodePort    <span class="number">10.2</span>.<span class="number">75.250</span>    &lt;none&gt;        <span class="number">80</span>:<span class="number">26765</span>/TCP     <span class="number">3</span>m51s</span><br><span class="line">nginx<span class="literal">-service3</span>是nodeport类型</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line"></span><br><span class="line"><span class="number">192.168</span>.<span class="number">10.91</span> www.kubemsb3.com					添加这行模拟DNS</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">otherhost</span> ~]<span class="comment"># curl www.kubemsb3.com</span></span><br></pre></td></tr></table></figure>




  </div>
</article>





    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>  
    <div id="vcomments" class="blog-post-comments"></div>
    <script>        
        new Valine({
            el: '#vcomments',
            visitor: true,
            appId: 'gqmHGHyrnzRPUSxqADLhUzlT-gzGzoHsz',
            appKey: 'q8uQ7rKeukTuQ3L35peaOhkC',
            placeholder: '好哥哥，说几句吧！',
            avatar: 'retro'
        })
    </script>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81ingress%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">一、ingress控制器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-ingress%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%9C%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 ingress控制器作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-ingress%E6%8E%A7%E5%88%B6%E5%99%A8%E7%A7%8D%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 ingress控制器种类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-Kubernetes-Ingress-Controller"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 Kubernetes Ingress Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-NGINX-Ingress-Controller"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 NGINX Ingress Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-Kong-Ingress"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 Kong Ingress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-Traefik"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 Traefik</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-HAProxy-Ingress"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5 HAProxy Ingress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-6-Voyager"><span class="toc-number">1.2.6.</span> <span class="toc-text">1.2.6 Voyager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-7-Contour"><span class="toc-number">1.2.7.</span> <span class="toc-text">1.2.7 Contour</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-8-Istio-Ingress"><span class="toc-number">1.2.8.</span> <span class="toc-text">1.2.8 Istio Ingress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-9-Ambassador"><span class="toc-number">1.2.9.</span> <span class="toc-text">1.2.9 Ambassador</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-10-Gloo"><span class="toc-number">1.2.10.</span> <span class="toc-text">1.2.10 Gloo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-11-Skipper"><span class="toc-number">1.2.11.</span> <span class="toc-text">1.2.11 Skipper</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81nginx-ingress-controller"><span class="toc-number">2.</span> <span class="toc-text">二、nginx ingress controller</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-nginx-ingress-controller%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 nginx ingress controller位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-nginx-ingress-controller%E9%83%A8%E7%BD%B2"><span class="toc-number">2.2.</span> <span class="toc-text">2.2  nginx ingress controller部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E4%B8%8B%E8%BD%BD%E5%B9%B6%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 下载并修改配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E5%BA%94%E7%94%A8%E8%B5%84%E6%BA%90%E6%B8%85%E5%8D%95%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 应用资源清单文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E9%AA%8C%E8%AF%81%E9%83%A8%E7%BD%B2%E7%BB%93%E6%9E%9C"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 验证部署结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-ingress%E5%AF%B9%E8%B1%A1%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 ingress对象应用案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-ingress-http%E6%A1%88%E4%BE%8B"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3 1 ingress-http案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-1-%E5%88%9B%E5%BB%BAdeployment%E6%8E%A7%E5%88%B6%E5%99%A8%E7%B1%BB%E5%9E%8B%E5%BA%94%E7%94%A8"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">2.3.1.1 创建deployment控制器类型应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-2-%E5%88%9B%E5%BB%BAservice"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">2.3.1.2 创建service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-3-%E5%88%9B%E5%BB%BAingress%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">2.3.1.3 创建ingress对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-4-%E6%A8%A1%E6%8B%9F%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE"><span class="toc-number">2.3.1.4.</span> <span class="toc-text">2.3.1.4 模拟客户端访问</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-ingress-http%E6%A1%88%E4%BE%8B%E6%89%A9%E5%B1%95"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 ingress-http案例扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-1-%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">2.3.2.1 创建第一个应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-2-%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%BA%94%E7%94%A8"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">2.3.2.2 创建第二个应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-3-%E5%88%9B%E5%BB%BAingress%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">2.3.2.3 创建ingress对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-4-%E6%A8%A1%E6%8B%9F%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE-1"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">2.3.1.4 模拟客户端访问</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-ingress-https%E6%A1%88%E4%BE%8B"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 ingress-https案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-1-%E5%88%9B%E5%BB%BA%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">2.3.3.1 创建自签证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-2-%E5%B0%86%E8%AF%81%E4%B9%A6%E5%88%9B%E5%BB%BA%E6%88%90secret"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">2.3.3.2 将证书创建成secret</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-3-%E7%BC%96%E6%8E%92YAML%E5%B9%B6%E5%88%9B%E5%BB%BA"><span class="toc-number">2.3.3.3.</span> <span class="toc-text">2.3.3.3 编排YAML并创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-4-%E6%A8%A1%E6%8B%9F%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE"><span class="toc-number">2.3.3.4.</span> <span class="toc-text">2.3.3.4 模拟客户端访问</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-ingress-nodeport%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.3.4 ingress+nodeport服务</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&text=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&is_video=false&description=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kubernetes集群服务暴露Nginx Ingress Controller&body=Check out this article: https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&title=Kubernetes集群服务暴露Nginx Ingress Controller"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://fate-re-zero.github.io/2024/05/03/%E4%BA%91%E5%8E%9F%E7%94%9F/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%20%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2Nginx%20Ingress%20Controller/&name=Kubernetes集群服务暴露Nginx Ingress Controller&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">2025 祥祥要起飞</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>


<script src="/lib/particles/particles.min.js"></script>


<script src="/lib/typing/typing.min.js"></script>


<script src="/js/main.js"></script>


<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


